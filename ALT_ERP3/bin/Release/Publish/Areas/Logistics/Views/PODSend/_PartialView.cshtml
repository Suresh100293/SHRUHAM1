@model TFATERPWebApplication.Areas.Logistics.Models.PODSendVM
@using Common;
@{
    ViewBag.Title = "Delivery";
    Layout = null;
}
<script src="@Url.Content("~/Content/js/jquery.validate.min.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Content/js/jquery.constrain.js")" type="text/javascript"></script>

<style>
    .span6 {
        display: none !important;
    }

    .toggle {
        border-radius: 15px !important;
        margin-top: -35px !important;
    }

        .toggle.btn {
            min-width: 77px !important;
            min-height: 34px;
        }


    fieldset {
        border: 1px solid #ddd !important;
        margin: 0;
        /*xmin-width: 0;*/
        padding: 10px;
        position: relative;
        border-radius: 4px;
        background-color: #f5f5f5;
        padding-left: 5px !important;
    }


    legend {
        /*margin-left: 30%;
        text-align: center;
        font-size: 14px;
        font-weight: bold;
        margin-bottom: 0px;
        width: 35%;
        border: 1px solid #ddd;
        border-radius: 4px;
        padding: 5px 5px 5px 10px;
        background-color: #dec0c0;*/
        margin-left: 1%;
        font-size: 14px;
        font-weight: bold;
        margin-bottom: 0px;
        border: 1px solid #ddd;
        border-radius: 15px;
        padding: 5px 45px 5px 45px;
        background-color: white;
        width: auto;
        color: red;
    }

    .example {
        border: 1px solid #ccc;
        border-collapse: collapse;
        width: max-content;
        font-size: 9px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

        .example th {
            background-color: #F7F7F7;
            font-weight: bold;
        }

        .example th, .example td {
            border: 1px solid #ccc;
            padding: 5px;
            font-size: 12px;
        }

        .example, .example table td {
            border: 0px solid #ccc;
        }
</style>


<script type="text/javascript">
    $(document).ready(function () {

        @*if ('@Model.Mode'!='Add') {
            if ('@Model.Task'=='Branch') {
                $("#Branch").prop("checked", true);
            } else if ('@Model.Task'=='File') {
                $("#File").prop("checked", true);
            } else {
                $("#Customer").prop("checked", true);
            }
        }*@

        if (('@Model.Mode' == "View")||('@Model.Mode' == "Delete")) {
            $('.form-group :input').prop("disabled", true);
        }
        LoadBranch();
        $('#example').DataTable();

        $('#btnDelete').click(function (event) {
            event.preventDefault();
            var result = confirm("Are you sure you want to delete POD ?");
            if (result) {

                var url = '@Url.Action("SaveData")';
                var ModelData = {};
                ModelData["Document"] = $("#Document").val();
                ModelData["Mode"] = '@Model.Mode';
                var DTO = { mModel: ModelData };
                $.ajax({
                    type: "POST",
                    dataType: "json",
                    data: JSON.stringify(DTO),
                    cache: false,
                    url: url,
                    contentType: "application/json; charset=utf-8",
                    beforeSend: function () {
                        $('.spinner').show();
                    },
                    success: function (data) {
                        if (data.Status == 'Success') {
                            $('.spinner').hide();
                            window.location.href = "/Logistics/PODSend/Index?ViewDataId=PODSend&Module=@Model.Module&TableName=@Model.TableName&OptionType=@Model.OptionType&OptionCode=Delivery&Header=Delivery&Controller2=@Model.Controller2&MainType=@Model.MainType";
                            $("#ErrorMessage").hide();
                        }
                        else {
                            $('.spinner').hide();
                            alert(data.Message);
                        }
                    },
                });
            }
        });
         $('#Submit').click(function (event) {
             event.preventDefault();
             
             var Task = $("#TaskOfPODSend").val();
             var RecordList = "";
            if (Task =="Branch") {
                if ($("#BranchCode").val() == '') {
                    $("#ErrorMessage").show();
                    $("#ErrorMessage").text('Please Select Branch......!');
                    return;
                }
                var check = $('#exampleBranch').find('input[type=checkbox]:checked').length;
                if (check == 0) {
                    $("#ErrorMessage").show();
                    $("#ErrorMessage").text('Please Select POD......!');
                    return;
                }
                $("#exampleBranch > tbody  > tr").each(function () {
                    if ($(this).find('input[type=checkbox]').prop("checked") == true) {
                        
                        var LRValue = $(this).find(".Unique").text();
                        RecordList = RecordList + LRValue + ",";
                    }
                });
            } else if (Task == "File") {
                var check = $('#exampleFile').find('input[type=checkbox]:checked').length;
                if (check == 0) {
                    $("#ErrorMessage").show();
                    $("#ErrorMessage").text('Please Select POD......!');
                    return;
                }
                $("#exampleFile > tbody  > tr").each(function () {
                    if ($(this).find('input[type=checkbox]').prop("checked") == true) {
                        
                        var LRValue = $(this).find(".Unique").text();
                        RecordList = RecordList + LRValue + ",";
                    }
                });
            } else {
                var check = $('#exampleCustomer').find('input[type=checkbox]:checked').length;
                if (check == 0) {
                    $("#ErrorMessage").show();
                    $("#ErrorMessage").text('Please Select POD......!');
                    return;
                }
                $("#exampleCustomer > tbody  > tr").each(function () {
                    if ($(this).find('input[type=checkbox]').prop("checked") == true) {
                        
                        var LRValue = $(this).find(".Unique").text();
                        RecordList = RecordList + LRValue + ",";
                    }
                });
            }

            var url = '@Url.Action("SaveData")';
            @* iX9: Data from individual field is passed on to the Model and then to Controller for Saving *@
            var ModelData = {};

             ModelData["Document"] = $("#Document").val();



            ModelData["RecordKey"] = RecordList.substr(0, RecordList.length - 1);
            ModelData["Task"] = Task;
            ModelData["BranchCode"] = $("#BranchCode").val();
            ModelData["PODNo"] = $("#PODNo").val();
            ModelData["Date"] = $("#Date").val();
            ModelData["Time"] = $("#Time").val();

            var DTO = { mModel: ModelData };
            $.ajax({
                type: "POST",
                dataType: "json",
                data: JSON.stringify(DTO),
                cache: false,
                url: url,
                contentType: "application/json; charset=utf-8",
                beforeSend: function () {
                    $('.spinner').show();
                },
                success: function (data) {
                    if (data.Status == 'Success') {
                        $('.spinner').hide();
                        window.location.href = "/DashBoard/TransactionsDashBoard";
                        $("#ErrorMessage").hide();
                    }
                    else {
                        $('.spinner').hide();
                        alert(data.Message);                    }
                },
            });
        });
    });
    function LoadBranch() {
        var url = '@Url.Action("BranchList")'
        $('#BranchCode').select2({
            minimumInputLength: 0,
            placeholder: 'Search',
            ajax: {
                url: url,
                dataType: 'json',
                quietMillis: 100,
                enableFiltering: true,
                allowClear: true,
                minimumInputLength: 0,
                multiple: true,
                width: 300,
                data: function (term, page) {
                    return {
                        types: ["exercise"],
                        limit: -1,
                        term: term
                    };
                },
                results: function (data, page) {
                    clientObj = JSON.stringify(data);
                    return {
                        results: $.map(data, function (item) {
                            return {
                                text: item.Name,
                                id: item.Code
                            }
                        })
                    };
                }
            },

            initSelection: function (element, callback) {
                var data = { id: '@Model.BranchCode', text: '@Model.BranchName' };
                callback(data);
            },

            formatResult: function (exercise) {
                return "<div class='row-fluid'><div class=''><span class='span1'><div style='color:" + exercise.alias + "'>" + exercise.text +
                    "</div></span></div></div>";
            },

            formatSelection: function (exercise) {
                return "<div class='row-fluid'><div class=''><span class='span1'><div style='color:" + exercise.alias + "'>" + exercise.text +
                    "</div></span></div></div>";
            },
        })
    };

</script>



<header class="header fixed-top" style="position:fixed;background-color:lightgray;padding:6px;width:100%;margin-top:5px;">
    <div class="fixhead">
        <b class="CodeSt">@Model.Header</b>

        <span class="tools pull-right">
            <a href="~/Logistics/PODSend/Index?ViewDataId=@Model.ViewDataId&Module=@Model.Module&TableName=@Model.TableName&OptionType=@Model.OptionType&OptionCode=@Model.OptionCode&Header=@Model.Header&Controller2=@Model.Controller2&MainType=@Model.MainType" class="btn btn-danger" style="color:white;font-weight:bolder;font-size:13px;padding:3px 10px;" id="Cancel2">X</a>
        </span>
        <span class="tools pull-right">
            <b class="CodeSt">@Model.Mode Mode</b>
        </span>
        <span class="tools pull-right" style="    margin-right: 15px;">
        </span>
    </div>
</header>

<form class="form-horizontal" id="frmaccountLedger" role="form" style="margin-top:32px;">
    <div id="ErrorMessage" name="ErrorMessage" class="alert alert-danger" style="display: none"></div>
</form>
<section class="panel" style="margin-bottom:10px;">
    <div class="panel-body">
        <div class="form-horizontal " id="LRMaster" role="form" style="">
            <fieldset class=" col-sm-12" style="margin-top: 15px;">
                <legend>@Model.Header</legend>
                <div class="panel panel-default" style="height:470px;">
                    <div class="panel-body " style="padding-left: 0px !important;">
                        <div class="col-sm-12" id="">
                            <div class="form-group">
                                <label class=" bold   col-sm-1  control-label">POD No:</label>
                                <div class="col-sm-1 ">
                                    @Html.TextBoxFor(x => x.PODNo, new { @class = "form-control", @style = "width:100%;", @Value = Model.PODNo, @disabled = "disabled" })
                                </div>
                                <label class=" bold   col-sm-1  control-label">Date:</label>
                                <div class="col-sm-1 ">
                                    @Html.TextBoxFor(x => x.Date, new { @class = "form-control", @style = "width:100%;", @Value = Model.Date, @disabled = "disabled" })
                                </div>
                                <label class=" bold   col-sm-1  control-label">Time:</label>
                                <div class="col-sm-1 ">
                                    @Html.TextBoxFor(x => x.Time, new { @class = "form-control", @type = "time", @style = "width:100%;", @Value = Model.Time, @disabled = "disabled" })
                                </div>
                            </div>
                            <hr />
                            <div class="form-group">
                                <div class="tab">
                                    <button class="tablinks" onclick="openCity(event, 'divLedgerTable')" id="Branch">Branch</button>
                                    <button class="tablinks" onclick="openCity(event, 'divLedgerTable1')" id="File">File</button>
                                    <button class="tablinks" onclick="openCity(event, 'divLedgerTable2')" id="Customer">Customer</button>
                                </div>
                                <div id="divLedgerTable" style="height:350px;overflow: auto;" class="tabcontent">
                                    <div class="form-group">
                                        <label class=" bold   col-sm-1  control-label" style="width:auto;">Branch:</label>
                                        <div class="col-sm-2 " id="">
                                            @Html.TextBoxFor(x => x.BranchCode, new { @class = "input-large-query", @style = "width:100%;", @Value = Model.BranchCode })
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        @if (Model.PODSendList != null)
                                        {
                                            <div class="col-sm-10">
                                                <table id="exampleBranch" class="table-bordered example" style="">
                                                    <thead>
                                                        <tr>
                                                            <th><center><input type="checkbox" id="All" class="LRchk" style="height: 17px;width: 18px;" /></center></th>
                                                            <th>POD NO</th>
                                                            <th>LR NO</th>
                                                            <th>LR Date</th>
                                                            <th>LR Time</th>
                                                            <th>Consingor</th>
                                                            <th>Consignee</th>
                                                            <th>From</th>
                                                            <th>To</th>
                                                            <th>Remark</th>
                                                            <th class="hidden">RecordKey</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        @foreach (var item in Model.PODSendList)
                                                        {
                                                            <tr id="@item.PODNO">
                                                                @if (item.CheckBox)
                                                                {
                                                                    <td class="" style="text-align: center;font-weight: bold;color: #ad225c;width:50px;"><center><input type="checkbox" id="@item.RecordKEy" class="checkbox lRCHK" value=@item.CheckBox style="height: 17px;width: 18px;" checked /></center></td>
                                                                }
                                                                else
                                                                {
                                                                    <td class="" style="text-align: center;font-weight: bold;color: #ad225c;width:50px;"><center><input type="checkbox" id="@item.RecordKEy" class="checkbox lRCHK" value=@item.CheckBox style="height: 17px;width: 18px;" /></center></td>
                                                                }
                                                                <td>@item.PODNO</td>
                                                                <td>@item.Lrno</td>
                                                                <td>@item.LRDate</td>
                                                                <td>@item.LRTime</td>
                                                                <td>@item.ConsignerName</td>
                                                                <td>@item.ConsigneeName</td>
                                                                <td>@item.FromName</td>
                                                                <td>@item.ToName</td>
                                                                <td>@item.Remark</td>
                                                                <td class="hidden Unique">@item.RecordKEy</td>
                                                            </tr>
                                                        }
                                                    </tbody>
                                                </table>
                                            </div>
                                        }
                                    </div>
                                </div>
                                <div id="divLedgerTable1" style="height:350px;overflow: auto;" class="tabcontent">
                                    <div class="form-group">
                                        @if (Model.PODSendList != null)
                                        {
                                            <div class="col-sm-10">
                                                <table id="exampleFile" class="table-bordered example" style="">
                                                    <thead>
                                                        <tr>
                                                            <th><center><input type="checkbox" id="All" class="LRchk" style="height: 17px;width: 18px;" /></center></th>
                                                            <th>POD NO</th>
                                                            <th>LR NO</th>
                                                            <th>LR Date</th>
                                                            <th>LR Time</th>
                                                            <th>Consingor</th>
                                                            <th>Consignee</th>
                                                            <th>From</th>
                                                            <th>To</th>
                                                            <th>Remark</th>
                                                            <th class="hidden">RecordKey</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        @foreach (var item in Model.PODSendList)
                                                        {
                                                            <tr id="@item.PODNO">
                                                                @if (item.CheckBox)
                                                                {
                                                                    <td class="" style="text-align: center;font-weight: bold;color: #ad225c;width:50px;"><center><input type="checkbox" id="@item.RecordKEy" class="checkbox lRCHK" value=@item.CheckBox style="height: 17px;width: 18px;" checked /></center></td>
                                                                }
                                                                else
                                                                {
                                                                    <td class="" style="text-align: center;font-weight: bold;color: #ad225c;width:50px;"><center><input type="checkbox" id="@item.RecordKEy" class="checkbox lRCHK" value=@item.CheckBox style="height: 17px;width: 18px;" /></center></td>
                                                                }
                                                                <td>@item.PODNO</td>
                                                                <td>@item.Lrno</td>
                                                                <td>@item.LRDate</td>
                                                                <td>@item.LRTime</td>
                                                                <td>@item.ConsignerName</td>
                                                                <td>@item.ConsigneeName</td>
                                                                <td>@item.FromName</td>
                                                                <td>@item.ToName</td>
                                                                <td>@item.Remark</td>
                                                                <td class="hidden Unique">@item.RecordKEy</td>
                                                            </tr>
                                                        }
                                                    </tbody>
                                                </table>
                                            </div>
                                        }
                                    </div>
                                </div>
                                <div id="divLedgerTable2" style="height:350px;overflow: auto;" class="tabcontent">
                                    <div class="form-group">
                                        @if (Model.PODSendList != null)
                                        {
                                            <div class="col-sm-10">
                                                <table id="exampleCustomer" class="table-bordered example" style="">
                                                    <thead>
                                                        <tr>
                                                            <th><center><input type="checkbox" id="All" class="LRchk" style="height: 17px;width: 18px;" /></center></th>
                                                            <th>POD NO</th>
                                                            <th>LR NO</th>
                                                            <th>LR Date</th>
                                                            <th>LR Time</th>
                                                            <th>Consingor</th>
                                                            <th>Consignee</th>
                                                            <th>From</th>
                                                            <th>To</th>
                                                            <th>Remark</th>
                                                            <th class="hidden">RecordKey</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        @foreach (var item in Model.PODSendList)
                                                        {
                                                            <tr id="@item.PODNO">
                                                                @if (item.CheckBox)
                                                                {
                                                                    <td class="" style="text-align: center;font-weight: bold;color: #ad225c;width:50px;"><center><input type="checkbox" id="@item.RecordKEy" class="checkbox lRCHK" value=@item.CheckBox style="height: 17px;width: 18px;" checked /></center></td>
                                                                }
                                                                else
                                                                {
                                                                    <td class="" style="text-align: center;font-weight: bold;color: #ad225c;width:50px;"><center><input type="checkbox" id="@item.RecordKEy" class="checkbox lRCHK" value=@item.CheckBox style="height: 17px;width: 18px;" /></center></td>
                                                                }
                                                                <td>@item.PODNO</td>
                                                                <td>@item.Lrno</td>
                                                                <td>@item.LRDate</td>
                                                                <td>@item.LRTime</td>
                                                                <td>@item.ConsignerName</td>
                                                                <td>@item.ConsigneeName</td>
                                                                <td>@item.FromName</td>
                                                                <td>@item.ToName</td>
                                                                <td>@item.Remark</td>
                                                                <td class="hidden Unique">@item.RecordKEy</td>
                                                            </tr>
                                                        }
                                                    </tbody>
                                                </table>
                                            </div>
                                        }
                                    </div>
                                </div>
                                <script>
                                function openCity(evt, cityName) {
                                    
                                    if (cityName =="divLedgerTable") {
                                        $("#TaskOfPODSend").val("Branch");
                                    } else if (cityName =="divLedgerTable1") {
                                        $("#TaskOfPODSend").val("File");
                                    } else {
                                        $("#TaskOfPODSend").val("Customer");
                                    }
                                    var i, tabcontent, tablinks;
                                    tabcontent = document.getElementsByClassName("tabcontent");
                                    for (i = 0; i < tabcontent.length; i++) {
                                        
                                        tabcontent[i].style.display = "none";
                                    }
                                    tablinks = document.getElementsByClassName("tablinks");
                                    for (i = 0; i < tablinks.length; i++) {
                                        
                                        tablinks[i].className = tablinks[i].className.replace(" active", "");
                                    }
                                    document.getElementById(cityName).style.display = "block";
                                    evt.currentTarget.className += " active";
                                }
                                    if ('@Model.Mode' == "Add")
                                    {
                                        
                                    document.getElementById("Branch").click();

                                } else {
                                    if ('@Model.Task' == "Branch") {
                                        document.getElementById("Branch").click();
                                    } else if ('@Model.Task' == "File"){
                                        document.getElementById("File").click();
                                    } else {
                                        document.getElementById("Customer").click();
                                    }
                                }
                                </script>
                            </div>
                        </div>
                    </div>
                </div>
            </fieldset>
        </div>
    </div>




</section>
<footer class="footer-section" style="height:60px;position:fixed;background-color:#4B4A4A;padding:3px;color:white;">
    <div class="row">
        <div class="col-sm-5">
            <div class="pull-left">

                @*<button class="btn btn-danger" data-toggle="modal" data-target="#LockModal" style="font-size: 13px;padding:3px 12px;" id="btnBlock"><i class="glyphicon glyphicon-ban-circle" style="font-size: 2em;"></i><br />Lock</button>*@
                <button class="btn btn-info" style="font-size: 13px;padding:3px 12px;" id="btnListPrint"><i class="glyphicon glyphicon-print" style="font-size: 2em;"></i><br />List Print</button>
                <button class="btn btn-info" style="font-size: 13px;padding:3px 12px;" id="btnShare"><i class="glyphicon glyphicon-share" style="font-size: 2em;"></i><br />Share</button>
                <button class="btn btn-info" style="font-size: 13px;padding:3px 12px;" id="btnDownload"><i class="glyphicon glyphicon-download" style="font-size: 2em;"></i><br />Download</button>
                @*<button class="btn btn-info" style="font-size: 13px;padding:3px 12px;" id="btnAttachment" data-toggle="modal" data-target="#Attachmentmodal"><i class="glyphicon glyphicon-paperclip" style="font-size: 2em;"></i><br />Attachment</button>*@
                <button class="btn btn-info" style="font-size: 13px;padding:3px 12px;" id="btnPrint"><i class="glyphicon glyphicon-print" style="font-size: 2em;"></i><br />Print</button>
                @*<button class="btn btn-info" style="font-size: 13px;padding:3px 12px;" id="SaveDraft"><i class="glyphicon glyphicon-floppy-saved" style="font-size: 2em;"></i><br />Save Draft</button>*@
                <button class="btn btn-info" style="font-size: 13px;padding:3px 12px;" id="" data-toggle="modal" data-target="#Notemodal"><i class="glyphicon glyphicon-file" style="font-size: 2em;"></i><br />Save Note</button>
            </div>
        </div>
        <div class="col-sm-offset-1 col-sm-2" style="">
            <div class="pull-left">

            </div>
        </div>
        <div class="col-sm-4">
            <div class="pull-right">
                @if (Model.Mode == "Delete")
                {
                    <button class="btn btn-danger" style="font-size: 13px;padding:3px 12px;" id="btnDelete"><i class="glyphicon glyphicon-trash" style="font-size: 2em;"></i><br />Delete</button>

                }
                else
                {
                    <button class="btn btn-primary" style="font-size: 13px;padding:3px 12px;" id="Submit"><i class="glyphicon glyphicon-floppy-saved" style="font-size: 2em;"></i><br />Save</button>
                    <button class="btn btn-primary" style="font-size: 13px;padding:3px 12px;" id="SubmitClear"><i class="glyphicon glyphicon-floppy-saved" style="font-size: 2em;"></i>&nbsp;&nbsp;&nbsp;<i class="glyphicon glyphicon-print" style="font-size: 2em;"></i><br />Save And Clear</button>
                }
                @*<button class="btn btn-primary" style="font-size: 13px;padding:3px 12px;" id="Edit" onclick="EditEntry();"><i class="glyphicon glyphicon-edit" style="font-size: 2em;"></i><br /> Edit</button>*@
                @*<button class="btn btn-danger" style="font-size: 13px;padding:3px 12px;" id="btnDelete"><i class="glyphicon glyphicon-trash" style="font-size: 2em;"></i><br />Delete</button>*@
                <a href="~/Logistics/PODSend/Index?ViewDataId=@Model.ViewDataId&Module=@Model.Module&TableName=@Model.TableName&OptionType=@Model.OptionType&OptionCode=@Model.OptionCode&Header=@Model.Header&Controller2=@Model.Controller2&MainType=@Model.MainType" class="btn btn-danger" style="font-size: 13px;padding:3px 12px;" id="Cancel"><i class="glyphicon glyphicon-remove" style="font-size: 2em;"></i><br />Cancel</a>
            </div>
        </div>
    </div>
</footer>



<!--View Modal -->
<div class="example-modal">
    <div id="updTfatsearch1" class="modal modal-default">
        <div class="modal-dialog" style="width:1080px;">
            <div id="updTfatsearchDiv1">
                @*@Html.Partial("ImageView")*@
            </div>
        </div>
    </div>
</div>

@*@Html.HiddenFor(x => x.RecordKey, new { @id = "DeliverLrRecordKey" })*@

@Html.HiddenFor(x => x.Task, new { @id = "TaskOfPODSend" })

