@model TFATERPWebApplication.Areas.Accounts.Models.MasterVM
@using Common
@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_NewLayoutMenu.cshtml";
}

<style>
    .col-sm-2 {
        width: 10.666667%;
    }

    .form-group {
        margin-bottom: 8px;
    }

    .panel-heading .nav {
        margin: -23px;
    }

    .form-horizontal .control-label {
        padding-top: 5px;
        color: black;
        text-align: left;
    }

    .fixhead {
        text-transform: uppercase;
    }

    .tabcontent {
        height: 500px;
    }
</style>
<script src="@Url.Content("~/Content/js/jquery.validate.min.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Content/js/jquery.constrain.js")" type="text/javascript"></script>
<link href="~/Content/bootstrap-multiselect.css" rel="stylesheet" />
<script src="~/Content/bootstrap-multiselect.js"></script>
<script type="text/javascript">
    $(document).ready(function () {
        if ('@Model.Mode' == "View") {
            $("#editaccdata").hide();
            $("#deleteid").hide();
            $("#add").hide();
        }
        if ('@Model.Mode' == "Edit") {
            $("#deleteid").hide();
        }
        if ('@Model.Mode' == "Delete") {
            $("#editaccdata").hide();
            $("#add").hide();
        }

        if ('@Model.Flag' == "L") {
            $("#frmEditRec").hide();
            $("#frmADDRec").hide();
        }
        if ('@Model.Mode' == "Add") {
            if ($('#hdnAutoAccCode').val() == "False") {
                $('#Code').prop('readonly', false);
            }
        }


        $('#add').click(function () {
            event.preventDefault();
            $("#ErrorMessage").hide();
            if ($("#Name").val() == '') {
                $("#ErrorMessage").show();
                $("#ErrorMessage").text('Enter Name.');
                return;
            }
            if ($("#Grp").val() == '') {
                $("#ErrorMessage").show();
                $("#ErrorMessage").text('Select Account Grp.');
                return;
            }
            if ($("#AcType").val() == '') {
                $("#ErrorMessage").show();
                $("#ErrorMessage").text('Select Account Type.');
                return;
            }
            if ($("#hdnBranchCodeArray").val() == '') {
                $("#ErrorMessage").show();
                $("#ErrorMessage").text('Select Applicable Branch.');
                return;
            }
            debugger;
            var url = '@Url.Action("SaveData")';
            $('.selected').each(function () {
                $(this).attr('selected', true);
            });
            var AddonSerial = [];
            $('#addongrid').find('tr[id="datacharge"]').each(function () {
                var $tds = $(this).find('td');
                var myDets = {
                    Fld: $tds.eq(0).text(),
                    ApplCode: ($tds.eq(4).text() == "C" || $tds.eq(4).text() == "M") ? $tds.find(".addontxtfvalue").val() : $tds.find("input[class='addontxtfvalue']").val(),
                    FldType: $tds.eq(4).text()
                }

                AddonSerial.push(myDets);
            });
            var ModelData = {};
            ModelData["Name"] = $("#Name").val();
            ModelData["AcType"] = $("#AcType").val();
            ModelData["ShortName"] = $("#ShortName").val();
            ModelData["Grp"] = $("#Grp").val();

            ModelData["AcHeadCode"] = $("#AcHeadCode").val();

            ModelData["AName"] = $("#AName").val();
            ModelData["CorpID"] = $("#CorpID").val();
            ModelData["Person"] = $("#Person").val();
            ModelData["MailingCategory"] = $("#MailingCategory").val();
            ModelData["UserID"] = $("#UserID").val();
            ModelData["AdminUser"] = $("#AdminUser").val();
            ModelData["www"] = $("#www").val();
            ModelData["CorrespondenceType"] = $("#CorrespondenceType").val();
            ModelData["Password"] = $("#Password").val();
            ModelData["Source"] = $("#Source").val();
            ModelData["Segment"] = $("#Segment").val();
            //ModelData["STaxCode"] = $("#STaxCode").val();
            //ModelData["PTaxCode"] = $("#PTaxCode").val();
            //ModelData["Licence1"] = $("#Licence1").val();
            //ModelData["Licence2"] = $("#Licence2").val();
            //ModelData["PanNo"] = $("#PanNo").val();
            ModelData["RTGS"] = $("#RTGS").val();
            ModelData["CSTNo"] = $("#CSTNo").val();
            ModelData["VATReg"] = $("#VATReg").val();
            //ModelData["TINNo"] = $("#TINNo").val();
            //ModelData["Designation"] = $("#Designation").val();
            //ModelData["Language"] = $("#Language").val();
            //ModelData["Dept"] = $("#Dept").val();
            //ModelData["Religion"] = $("#Religion").val();
            //ModelData["Division"] = $("#Division").val();
            //ModelData["Bdate"] = $("#Bdate").val();
            //ModelData["Anndate"] = $("#Anndate").val();
            //ModelData["SpouseName"] = $("#SpouseName").val();
            //ModelData["SpouseBdate"] = $("#SpouseBdate").val();
            //ModelData["ChildName"] = $("#ChildName").val();
            //ModelData["ChildBdate"] = $("#ChildBdate").val();
            //ModelData["Ticklers"] = $("#Ticklers").val();
            //ModelData["HoldEnquiry"] = $("#HoldEnquiry").is(':checked');
            //ModelData["StrHoldEnquiryDt"] = $("#HoldEnquiryDt").val();
            //ModelData["HoldDespatch"] = $("#HoldDespatch").is(':checked');
            //ModelData["StrHoldDespatchDt"] = $("#HoldDespatchDt").val();
            //ModelData["HoldInvoice"] = $("#HoldInvoice").is(':checked');
            //ModelData["StrHoldInvoiceDt"] = $("#HoldInvoiceDt").val();
            //ModelData["HoldNarr"] = $("#HoldNarr").val();
            ModelData["Mode"] = $("#hdnMode").val();
            //ModelData["FreqOS"] = $("#FreqOS").val();
            //ModelData["FreqForm"] = $("#FreqForm").val();
            //ModelData["EmailParty"] = $("#EmailParty").is(':checked');
            //ModelData["EmailSalesman"] = $("#EmailSalesman").is(':checked');
            //ModelData["EmailTemplate"] = $("#EmailTemplate").is(':checked');
            //ModelData["SMSPartyAlert"] = $("#SMSPartyAlert").is(':checked');
            //ModelData["SMSSalesman"] = $("#SMSSalesman").is(':checked');
            //ModelData["SMSTemplate"] = $("#SMSTemplate").is(':checked');
            ModelData["CurrCode"] = $("#CurrCode").val();
            ModelData["DraweeBank"] = $("#DraweeBank").val();
            ModelData["AcCode"] = $("#AcCode").val();
            ModelData["RTGS"] = $("#RTGS").val();
            //ModelData["Broker"] = $("#Broker").val();
            //ModelData["SalesMan"] = $("#SalesMan").val();
            //ModelData["Transporter"] = $("#Transporter").val();
            //ModelData["ReminderFormat"] = $("#ReminderFormat").val();
            ModelData["Narr"] = $("#Narr").val();
            //ModelData["SalesChannel"] = $("#SalesChannel").val();
            //ModelData["IncoTerms"] = $("#IncoTerms").val();
            //ModelData["CheckCRLimit"] = $("#CheckCRLimit").is(':checked');
            //ModelData["CheckCRDays"] = $("#CheckCRDays").is(':checked');
            //ModelData["UserID"] = $("#UserIDs").val();
            //ModelData["IsPublic"] = $("#IsPublic").is(':checked');
            //ModelData["CashDisc"] = $("#CashDisc").is(':checked');
            //ModelData["DiscDays"] = $("#DiscDays").val();
            //ModelData["DiscPerc"] = $("#DiscPerc").val();
            ModelData["CutTDS"] = $("#CutTDS").is(':checked');
            ModelData["TDSCode"] = $("#TDSCode").val();
            ModelData["CutTCS"] = $("#CutTCS").is(':checked');
            ModelData["IsDifferRate"] = $("#IsDifferRate").is(':checked');
            ModelData["DifferRate"] = $("#DifferRate").val();
            ModelData["DifferRateCertNo"] = $("#DifferRateCertNo").val();
            ModelData["IsForm15H"] = $("#IsForm15H").is(':checked');
            ModelData["StrForm15HDate"] = $("#Form15HDate").val();
            ModelData["StrForm15HCITDate"] = $("#Form15HCITDate").val();
            ModelData["Hide"] = $("#Hide").is(':checked');
            ModelData["NonActive"] = $("#NonActive").is(':checked');
            ModelData["ARAP"] = $("#ARAP").is(':checked');
            ModelData["CCBudget"] = $("#CCBudget").is(':checked');
            ModelData["CCReqd"] = $("#CCReqd").is(':checked');
            ModelData["GstApplicable"] = $("#GstApplicable").is(':checked');
            ModelData["HSN"] = $("#HSN").val();
            ModelData["IGST"] = $("#IGST").val();
            ModelData["SGST"] = $("#SGST").val();
            ModelData["CGST"] = $("#CGST").val();
            ModelData["OptionGstType"] = $("#OptionGstType").val();
            ModelData["TDSPercent"] = $("#TDSPercent").val();
            ModelData["GSTType"] = $("#GSTType").val();
            //ModelData["EmailPartyAlert"] = $("#EmailPartyAlert").is(':checked');
            //ModelData["CrLimit"] = $("#CrLimit").val();
            //ModelData["CRPeriod"] = $("#CRPeriod").val();
            //ModelData["CRLimitTole"] = $("#CRLimitTole").val();
            //ModelData["CRLimitWithTrx"] = $("#CRLimitWithTrx").is(':checked');
            //ModelData["CRLimitWithPO"] = $("#CRLimitWithPO").is(':checked');
            //ModelData["CRDaysWarn"] = $("#CRDaysWarn").val();
            //ModelData["CRLimitWarn"] = $("#CRLimitWarn").val();
            ModelData["Document"] = $("#Code").val();
            ModelData["SMSParty"] = $("#SMSParty").is(':checked');
            ModelData["ItemType"] = $("#ItemType").val();
            ModelData["AddOnList"] = AddonSerial;
            ModelData["BSRCode"] = $("#BSRCode").val();
            ModelData["ODLimit"] = $("#ODLimit").val();

            //if only one address/mail info record
            ModelData["AName"] = $("#AName").val();
            ModelData["CorpID"] = $("#CorpID").val();
            ModelData["Person"] = $("#Person").val();
            ModelData["Adrl1"] = $("#Adrl1").val();
            ModelData["Country"] = $("#Country").val();
            ModelData["Adrl2"] = $("#Adrl2").val();
            ModelData["State"] = $("#State").val();
            ModelData["Adrl3"] = $("#Adrl3").val();
            ModelData["City"] = $("#City").val();
            ModelData["Pin"] = $("#Pin").val();
            ModelData["Area"] = $("#Area").val();
            ModelData["Tel1"] = $("#Tel1").val();
            ModelData["Fax"] = $("#Fax").val();
            ModelData["Mobile"] = $("#Mobile").val();
            ModelData["www"] = $("#www").val();
            ModelData["Email"] = $("#Email").val();
            ModelData["MailingCategory"] = $("#MailingCategory").val();
            ModelData["UserID"] = $("#UserID").val();
            ModelData["www"] = $("#www").val();
            ModelData["CorrespondenceType"] = $("#CorrespondenceType").val();
            ModelData["Password"] = $("#Password").val();
            ModelData["Source"] = $("#Source").val();
            ModelData["Segment"] = $("#Segment").val();
            ModelData["ContactType"] = $("#ContactType").val();
            ModelData["SrNo"] = $("#hdnSrNo1").val();
            ModelData["AppBranch"] = $("#hdnBranchCodeArray").val();
            ModelData["Tel2"] = $("#Tel2").val();
            ModelData["Tel3"] = $("#Tel3").val();
            ModelData["Header"] = '@Model.Header'
            var DTO = { Model: ModelData };
            $.ajax({
                type: "POST",
                dataType: "json",
                data: JSON.stringify(DTO),
                cache: false,
                url: url,
                contentType: "application/json; charset=utf-8",
                beforeSend: function () {
                    $('.spinner').show();
                },
                success: function (data) {
                    if (data.Status == 'Error') {
                        alert(data.Message);
                    }
                    if (data.Status == 'Success') {
                        $('.spinner').hide();
                        //alert("Result save successfully.");
                        window.location.href = "/SetUp/MasterGrid?ViewDataId=@Model.ViewDataId&MainType=@Model.MainType&Module=Finance&TableName=Master&optiontype=M&optioncode=@Model.ViewDataId&Header=@Model.id&Controller2=@Model.Controller2"
                    }
                    else if (data.Status == 'Error') {
                        alert(data.Message);
                        $("#ErrorMessage").show();
                        $("#ErrorMessage").text('Select Atleast One Record For Ledger.');
                    }
                    else {
                        $("#ErrorMessage").show();
                        $("#ErrorMessage").html(data.html);
                    }
                },

            });
        });

        $('#deleteid').click(function () {
            event.preventDefault();
            $("#ErrorMessage").hide();
            if ($("#Code").val() == '') {
                $("#ErrorMessage").show();
                $("#ErrorMessage").text('Missing Account Code');
                return;
            }

            var ModelData = {};
            ModelData["Document"] = $("#Code").val();
            var DTO = { Model: ModelData };
            var url = '@Url.Action("DeleteAccounts")';
            $.ajax({
                type: "POST",
                dataType: "json",
                data: JSON.stringify(DTO),
                cache: false,
                url: url,
                contentType: "application/json; charset=utf-8",
                beforeSend: function () {
                    $('.spinner').show();
                },
                success: function (data) {
                    $('.spinner').hide();
                    if (data.Status == 'Success') {
                        //$('.spinner').hide();
                        window.location.href = "/SetUp/MasterGrid?ViewDataId=@Model.ViewDataId&MainType=@Model.MainType&Module=@Model.Module&TableName=Master&optiontype=M&optioncode=@Model.ViewDataId&Header=@Model.id&Controller2=@Model.Controller2"
                    }
                    else {
                        //$('.spinner').hide();
                        alert(data.Message);
                    }
                },

            });
        });

        $("#btnAddOns").click(function (event) {
            event.preventDefault();
            $('#dialog1').modal('show');

        });

        $("#btnUpdateAddOns").click(function (event) {
            event.preventDefault();
            if ($('#hdnAddOnSaved').val() == "1") {
                $('#dialog1').modal('show');
            }
            else {
                var url = '@Url.Action("GetEditAddOnList")?Code=' + $("#Code").val() + '&TableKey=%Master';
                $.ajax({
                    async: false,
                    cache: false,
                    url: url,
                    type: "GET",
                    dataType: "json",
                    cache: false,
                    contentType: "application/json; charset=utf-8",
                    beforeSend: function () {
                        $('.spinner').show();
                    },
                    success: function (data) {
                        $('.spinner').hide();
                        $('#dialog1').modal('show');
                        $('#Dialog').html(data.Html);
                        $('#controllername').val(data.Controller);
                    },
                });
            }
        });
    });
</script>
<header class="header fixed-top" style="position:fixed;background-color:lightgray;padding:6px;width:100%;margin-top:5px;">
    <div class="fixhead">
        <b class="CodeSt">@Model.Header</b>
        <span class="tools pull-right">
            <a href="~/SetUp/MasterGrid?ViewDataId=@Model.ViewDataId&MainType=@Model.MainType&Module=@Model.Module&TableName=Master&optiontype=M&optioncode=@Model.ViewDataId&Header=@Model.id&Controller2=@Model.Controller2" class="btn btn-danger" style="color:white;font-weight:bolder;font-size:13px;padding:3px 10px;" id="Cancel2">X</a>
        </span>
        <span class="tools pull-right">
            <b class="CodeSt">@Model.Mode Mode</b>
        </span>
    </div>
</header>

<div class="panel">
    <div class="panel-body">
        <br /><br />
        <div id="frmADDRec">
            <div class="tab">
                <button class="tablinks" onclick="openCity(event, 'divLedgerTable')" id="Sales"> General</button>
                <button class="tablinks" onclick="openCity(event, 'divLedgerTable2')"> Mailing Info</button>
                <button class="tablinks" onclick="openCity(event, 'divLedgerTable3')"> Options</button>
            </div>
            <div id="divLedgerTable" class="tabcontent">
                @Html.Partial("ReceivableMaster", Model)
            </div>
            <div id="divLedgerTable2" class="tabcontent">
                <div id="ItemListTable">
                    @Html.Partial("MailingInfo", Model)
                </div>
            </div>
            <div id="divLedgerTable3" class="tabcontent">
                @Html.Partial("Options", Model)
            </div>
        </div>
        <script>
            function openCity(evt, cityName) {
                var i, tabcontent, tablinks;
                tabcontent = document.getElementsByClassName("tabcontent");
                for (i = 0; i < tabcontent.length; i++) {
                    tabcontent[i].style.display = "none";
                }
                tablinks = document.getElementsByClassName("tablinks");
                for (i = 0; i < tablinks.length; i++) {
                    tablinks[i].className = tablinks[i].className.replace(" active", "");
                }
                document.getElementById(cityName).style.display = "block";
                evt.currentTarget.className += " active";
            }
            document.getElementById("Sales").click();
        </script>
    </div>
</div>

<footer class="footer-section" style="height:33px;position:fixed;background-color:#4B4A4A;padding:3px;color:white;">
    <div class="row" style="margin-right:-5px;">
        <div class="col-sm-5">
            <button class="btn btn-warning" type="submit" id="btnAddOns" name="Command">AddOns</button>
            <button class="btn btn-info" type="submit" id="btnAddDoc" name="Command">Add Note</button>
        </div>
        <div class="col-sm-3" style="margin-top:4px;color:white;font-family:Tahoma;">
            T.FAT ERP-iX9 by Suchan Software Private Limited
        </div>
        <div class="col-sm-4">
            <div class="pull-right">
                @if (Model.Mode == "Edit" || Model.Mode == "View" || Model.Mode == "Delete")
                {
                    if (Model.Mode == "Edit")
                    {
                        <button class="btn btn-success" id="add">Save </button>
                    }
                    if (Model.Mode == "Delete")
                    {
                        <button class="btn btn-success" id="deleteid">Delete </button>
                    }
                }
                else
                {
                    <button class="btn btn-success" id="add">Save</button>
                }
                <a href="~/SetUp/MasterGrid?ViewDataId=@Model.ViewDataId&MainType=@Model.MainType&Module=@Model.Module&TableName=Master&optiontype=M&optioncode=@Model.ViewDataId&Header=@Model.id&Controller2=@Model.Controller2" class="btn btn-danger">Cancel</a>
            </div>
        </div>
    </div>
</footer>

<input type="hidden" id="controllername" />
<div class="example-modal">
    <div id="dialog1" class="modal modal-default">
        <div class="modal-dialog modal-lg" style="width:650px;">
            <div id="Dialog">
                @Html.Partial("AddOnGrid")
            </div>
        </div>
    </div>
</div>

@Html.HiddenFor(x => x.SrNo, new { @id = "hdnSrNo", @name = "hdnSrNo" })
@Html.HiddenFor(x => x.Mode, new { @id = "hdnMode", @name = "hdnMode" })
@Html.HiddenFor(x => x.AddOnSaved, new { @Id = "hdnAddOnSaved" })
@Html.HiddenFor(x => x.AutoAccCode, new { @Id = "hdnAutoAccCode" })
