@model TFATERPWebApplication.Areas.Accounts.Models.PurchaseVM
@using Common;

<script>
    $(document).ready(function () {
        loadContainer2();

        $("#btnaddpackinedit").click(function (event) {
            event.preventDefault();

            var myPackingArray = []
            $('#PackingSlipGridEdit tbody tr').each(function () {
                var $tds = $(this).find('td');
                var myDets = {
                    CaseNumber: $tds.eq(0).text(),
                    Container: $tds.find(".packingdrpdwnedt").val(),
                    ContainerNo: $tds.eq(2).text(),
                    Mark: $tds.eq(3).text(),
                    PackQty: $tds.eq(4).text(),
                    PackQty2: $tds.eq(5).text(),
                    GrossWt: $tds.eq(6).text(),
                    NettWt: $tds.eq(7).text(),
                    TareWt: $tds.eq(8).text(),
                    Narr: $tds.eq(9).text(),
                    tempid: $tds.eq(10).text(),
                }

                myPackingArray.push(myDets);
            });

            var ModelData = {};
            ModelData["CaseNumber"] = $('#UpdCaseNumber').val();
            ModelData["Container"] = $('#UpdContainer').val();
            ModelData["ContainerNo"] = $('#UpdContainerNo').val();
            ModelData["Mark"] = $('#UpdMark').val();
            ModelData["PackQty"] = $('#UpdPackQty').val();
            ModelData["PackQty2"] = $('#UpdPackQty2').val();
            ModelData["GrossWt"] = $('#UpdGrossWt').val();
            ModelData["NettWt"] = $('#UpdNettWt').val();
            ModelData["TareWt"] = $('#UpdTareWt').val();
            ModelData["Narr"] = $('#UpdNarr').val();
            ModelData["PackingList"] = myPackingArray;
            ModelData["tempId"] = $('#hdnPacktempId').val();
            var DTO = { Model: ModelData };
            var url = '@Url.Action("SessAddPackingList")';
            $.ajax({
                type: "POST",
                dataType: "json",
                data: JSON.stringify(DTO),
                cache: false,
                url: url,
                contentType: "application/json;charset=utf-8",
                beforesend: function () {
                    $('.spinner').show();
                },
                success: function (data) {
                    $('.spinner').hide();
                    $('#errormessage').hide();
                    $('#packinglistedit').html(data.Html);

                },
                error: function () {
                    $('.spinner').hide();
                    alert("error occured while processing your request.");
                }
            });
        });

        $('button[action|="DeletePack"]').click(function (event) {
            event.preventDefault(event);
            var myPackingArray = []
            $('#PackingSlipGridEdit tbody tr').each(function () {
                var $tds = $(this).find('td');
                var myDets = {
                    CaseNumber: $tds.eq(0).text(),
                    Container: $tds.find(".packingdrpdwnedt").val(),
                    ContainerNo: $tds.eq(2).text(),
                    Mark: $tds.eq(3).text(),
                    PackQty: $tds.eq(4).text(),
                    PackQty2: $tds.eq(5).text(),
                    GrossWt: $tds.eq(6).text(),
                    NettWt: $tds.eq(7).text(),
                    TareWt: $tds.eq(8).text(),
                    Narr: $tds.eq(9).text(),
                    tempid: $tds.eq(10).text(),
                }

                myPackingArray.push(myDets);
            });
            var ModelData = {};
            ModelData["PackingList"] = myPackingArray;
            ModelData["tempId"] = $(this).val();
            ModelData["hdnPacktempId"] = $('#hdnPacktempId').val();
            var DTO = { Model: ModelData };
            var url = '@Url.Action("DeletePackingListInEditMode")';
            $.ajax({
                type: "POST",
                dataType: "json",
                data: JSON.stringify(DTO),
                cache: false,
                url: url,
                contentType: "application/json;charset=utf-8",
                beforeSend: function () {
                    $('.spinner').show();
                },
                success: function (data) {
                    $('.spinner').hide();
                    $('#packinglistedit').html(data.Html);
                },
                error: function () {
                    alert("Error occured while processing your request.");
                }
            });
        });

        $('#SavePackListEdit').click(function (event) {
            event.preventDefault();
            var myPackingArray = []
            $('#PackingSlipGridEdit').find('tr[id="datacharge"]').each(function () {
                var $tds = $(this).find('td');

                var myDets = {

                    CaseNumber: $tds.eq(0).text(),
                    Container: $tds.find(".packingdrpdwnedt").val(),
                    ContainerNo: $tds.eq(2).text(),
                    Mark: $tds.eq(3).text(),
                    PackQty: $tds.eq(4).text(),
                    PackQty2: $tds.eq(5).text(),
                    GrossWt: $tds.eq(6).text(),
                    NettWt: $tds.eq(7).text(),
                    TareWt: $tds.eq(8).text(),
                    Narr: $tds.eq(9).text(),
                    tempid: $tds.eq(10).text(),
                }

                myPackingArray.push(myDets);
            });
            var ModelData = {};
            ModelData["PackingList"] = myPackingArray;
            ModelData["tempId"] = $("#hdnPacktempId").val();
            ModelData["SubType"] = $("#hdnSType").val();
            ModelData["ChangeLog"] = $("#hdnchangelog").val();
            ModelData["MainType"] = $("#hdnMType").val();
            var DTO = { Model: ModelData };
            var url = '@Url.Action("SessFinalPackingList")';
            $.ajax({
                type: "POST",
                dataType: "json",
                data: JSON.stringify(DTO),
                cache: false,
                url: url,
                contentType: "application/json;charset=utf-8",
                beforeSend: function () {
                    $('.spinner').show();
                },
                success: function (data) {
                    $('.spinner').hide();
                    $('#PackingListEdit').modal('hide');

                },
                error: function () {
                    alert("Error occured while processing your request.");
                }
            });
        });


    });

    function loadContainer2() {
        $("#UpdContainer").empty();
        var url = '@Url.Action("GetContainer")';
        $.ajax({
            type: "GET",
            dataType: "json",
            cache: false,
            url: url,
            contentType: "application/json;charset=utf-8",
            beforeSend: function () {

            },
            success: function (result) {
                $.each(result, function (i, item) {
                    $("#UpdContainer").append("<option value='" + item.Value + "'>" + item.Text + "</option>");
                });
                $('#UpdContainer').val('@Model.Container').attr("selected", "selected");
            },
            error: function () {
                $('.spinner').hide();
                alert("An error occurred while processing the request.");
            }
        });
    };
</script>

<div class="modal-content">
    <div class="modal-header" style="background-color:#cccccc">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true"></span></button>
        <h4 class="modal-title">Packing Details</h4>
    </div>
    <div class="modal-body">
        <table id="PackingSlipGridEdit" class="zui-table">
            <thead>
                <tr>

                    <th>CaseNumber</th>

                    <th>Container </th>
                    <th>ContainerNo</th>

                    <th>Mark</th>
                    <th>PackQty </th>
                    <th>PackQty2 </th>
                    <th>GrossWt</th>

                    <th>NettWt </th>
                    <th> TareWt </th>

                    <th>Narr </th>
                    <th colspan="2"></th>
                </tr>
                <tr style="background-color:gainsboro">
                    <td>
                        @Html.TextBoxFor(x => x.CaseNumber, new { @class = "form-control", @style = "text-align:right;", @Name = "UpdCaseNumber", @Id = "UpdCaseNumber" })
                    </td>
                    <td style="text-align:left;">
                        @Html.DropDownListFor(x => x.Container, DropdownHelper.EmptyList(), new { @class = "input-large-query", @style = "width:100%;margin-top:2px;", @id = "UpdContainer", @Name = "UpdContainer" })
                    </td>
                    <td style="text-align:right;">
                        @Html.TextBoxFor(x => x.ContainerNo, new { @class = "form-control", @Name = "UpdContainerNo", @Id = "UpdContainerNo" })
                    </td>
                    <td style="text-align:center;">
                        @Html.TextBoxFor(x => x.Mark, new { @id = "UpdMark", @class = "form-control", @Name = "UpdMark" })
                    </td>

                    <td style="vertical-align:inherit;" colspan="1">
                        @Html.TextBoxFor(x => x.PackQty, new { @id = "UpdPackQty", @style = "text-align:right;", @class = "form-control", @Name = "UpdPackQty" })
                    </td>
                    <td>
                        @Html.TextBoxFor(x => x.PackQty2, new { @id = "UpdPackQty2", @style = "text-align:right;", @class = "form-control", @Name = "UpdPackQty2" })
                    </td>

                    <td style="text-align:right;">
                        @Html.TextBoxFor(x => x.GrossWt, new { @class = "form-control", @style = "text-align:right;", @Name = "UpdGrossWt", @Id = "UpdGrossWt" })
                    </td>
                    <td style="text-align:center;">
                        @Html.TextBoxFor(x => x.NettWt, new { @id = "UpdNettWt", @style = "text-align:right;", @class = "form-control", @Name = "UpdNettWt" })
                    </td>
                    <td>
                        @Html.TextBoxFor(x => x.TareWt, new { @id = "UpdTareWt", @style = "text-align:right;", @class = "form-control", @Name = "UpdTareWt" })
                    </td>
                    <td style="text-align:center;">
                        @Html.TextBoxFor(x => x.Narr, new { @id = "UpdNarr", @class = "form-control", @Name = "UpdNarr" })
                    </td>
                    <td colspan="2"><a id="btnaddpackinedit" href="#" class="btn btn-primary btn-sm" title="Add"><i class="fa fa-plus"></i></a> </td>
                </tr>
            </thead>
            <tbody>
                @if (Model.PackingList != null)
                {
                    foreach (var item in Model.PackingList.Where(x => x.tempIsDeleted == false).ToList())
                    {
                        <tr id="datacharge" style="font-family:Tahoma;font-size:9pt;border: solid 1px lightgray;">
                            <td contenteditable="true">@item.CaseNumber</td>
                            <td>
                                <select class="packingdrpdwnedt" style="width:100%">
                                    @foreach (var item2 in item.ContainerList)
                                    {
                                        <option value="@item2" @(item2 == item.Container ? "selected" : "")>@item2</option>
                                    }
                                </select>
                            </td>
                            <td contenteditable="true">@item.ContainerNo</td>
                            <td contenteditable="true">@item.Mark</td>
                            <td contenteditable="true" style="text-align:right;">@item.PackQty</td>
                            <td contenteditable="true" style="text-align:right;">@item.PackQty2 </td>
                            <td contenteditable="true" style="text-align:right;">@item.GrossWt</td>
                            <td contenteditable="true" style="text-align:right;">@item.NettWt </td>
                            <td contenteditable="true" style="text-align:right;">@item.TareWt </td>
                            <td contenteditable="true">@item.Narr </td>
                            <td hidden="hidden">@item.tempid</td>
                            <td>
                                <button type="button" action="DeletePack" class="btn btn-danger btn-sm" value="@item.tempid" title="Delete"><i class="fa fa-trash-o"></i></button>
                            </td>
                        </tr>
                    }
                }
            </tbody>
        </table>
    </div>
    <div class="modal-footer" style="background-color:#cccccc">
        <button type="button" class="btn btn-success" id="SavePackListEdit">Save</button>
        <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
    </div>
</div>
@Html.HiddenFor(x => x.hdnPacktempId, new { @id = "hdnPacktempId" })