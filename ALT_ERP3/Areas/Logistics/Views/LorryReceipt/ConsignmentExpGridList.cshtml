
@model ALT_ERP3.Areas.Logistics.Models.LRVM
@using Common

<div class="form-horizontal" id="ledgerupdate">
    <div class="col-sm-12" id="SelectedLRTable">
        <table id="lrtabledata" class="zui-table" style="width:60%;word-wrap:break-word">
            <thead>
                <tr>
                    <td style="width:7%;border-right: solid 1px dimgray;border-bottom: solid 1px dimgray;"></td>
                    <td style="width:6%;border-right: solid 1px dimgray;border-bottom: solid 1px dimgray;">
                        Sr.
                    </td>
                    <td style="width:30%;border-right: solid 1px dimgray;border-bottom: solid 1px dimgray;">
                        Expenses Acount
                    </td>
                     <td style="width:30%;border-right: solid 1px dimgray;border-bottom: solid 1px dimgray;">
                        Sub Head
                    </td>
                    <td style="width:20%;border-right: solid 1px dimgray;border-bottom: solid 1px dimgray;">
                        Amount (<label id="lbltxtAmt"></label>)
                    </td>
                    <td style="width:7%"></td>
                </tr>
                <tr role="row" style="font-family:Tahoma;font-size:9pt;width: 100%;">
                    <td style="width:7%">
                        <button type="button" class="btn btn-success" id="btnactivateLRDetails">Add</button>
                    </td>
                    <td style="width:6%">
                        @Html.TextBoxFor(x => x.tempId, new { @class = "form-control", @id = "hdnLRtempid", @Name = "hdnLRtempid", @Value = Model.tempId, @style = "text-align:right;display:none" })
                    </td>
                    <td style="width: 30%">
                        @Html.TextBoxFor(x => x.ExpAcount, new { @class = "input-large search-query", @id = "txtExpAcount", @Name = "txtExpAcount", @Value = Model.ExpAcount, @style = "width:99%;", @disabled = "disabled" })
                    </td>
                    <td style="width: 30%">
                        @Html.TextBoxFor(x => x.SubHeadAcc, new { @class = "form-control", @id = "txtSubHeadAcc", @Name = "txtSubHeadAcc", @Value = Model.SubHeadAcc, @disabled = "disabled" })
                    </td>
                    <td style="width:20%">
                        @Html.TextBoxFor(x => x.ExpAmount, new { @class = "form-control", @id = "txtExpAmount", @Name = "txtExpAmount", @Value = Model.ExpAmount, @style = "text-align:right;", @disabled = "disabled" })
                    </td>
                    <td style="width:7%">
                        <button type="button" class="btn btn-success" id="btnaddLRDetails" style="display:none"><i class="fa fa-save"></i></button>
                        <button type="button" id="EditSaveLRLedger" class="btn btn-warning" title="EditSave" style="display:none"><i class="fa fa-save"></i></button>
                    </td>
                </tr>
            </thead>
            <tbody>
                @if (Model.LRDetailList != null)
                {
                    foreach (var item in @Model.LRDetailList.OrderByDescending(x => x.tempId).ToList())
                    {
                        <tr style="font-family:Tahoma;font-size:9pt;">
                            <td style="vertical-align:inherit;width:7%;">
                                <button type="button" action="EditLRLedger" class="btn btn-warning btn-sm" value="@item.tempId" title="Edit"><i class="fa fa-edit"></i></button>
                                <button type="button" action="DeleteLRLedger" class="btn btn-danger btn-sm" value="@item.tempId" title="Delete"><i class="fa fa-trash-o"></i></button>
                            </td>
                            <td style="vertical-align:inherit;width:6%;">@item.tempId</td>
                            <td class="hidden" style="vertical-align:inherit;width:30%">@item.ExpAcount</td>
                            <td style="vertical-align:inherit;width:30%">@item.ExpAcountName</td>
                            <td style="vertical-align:inherit;width:30%">@item.SubHeadAcc</td>
                            <td style="vertical-align:inherit;width:20%">@item.ExpAmount</td>

                            <td style="width:7%"></td>
                        </tr>
                    }
                }
            </tbody>

        </table>
    </div>
   

</div>

<script>
    $(document).ready(function () {
        LoadExpAc();
        $("#btnactivateLRDetails").click(function (event) {
            $("#txtExpAcount").prop('disabled', false);
            $("#txtSubHeadAcc").prop('disabled', false);
            $("#txtExpAmount").prop('disabled', false);
            $("#btnaddLRDetails").prop('disabled', false);

            $("#txtExpAcount").focus();
            $("#btnaddLRDetails").show();
            $("#EditSaveLRLedger").hide();
        });
        $("#btnaddLRDetails").click(function (event) {
            event.preventDefault();
            debugger;
            var myBatchArray = [];
            $('#lrtabledata tbody tr').each(function () {
                var tds = $(this).find('td');
                var myDets = {
                    tempId: tds.eq(1).text(),
                    ExpAcount: tds.eq(2).text(),
                    ExpAcountName: tds.eq(3).text(),
                    SubHeadAcc: tds.eq(4).text(),
                    ExpAmount: tds.eq(5).text(),
                }
                myBatchArray.push(myDets);
            });
            var ModelData = {};
            ModelData["LRDetailList"] = myBatchArray;
            ModelData["Mode"] = "Add";
            ModelData["ExpAcount"] = $("#txtExpAcount").val();
            ModelData["SubHeadAcc"] = $("#txtSubHeadAcc").val();
            ModelData["ExpAmount"] = $("#txtExpAmount").val();
            var DTO = { Model: ModelData };
            var url = '@Url.Action("AddLRDetails")';
            $.ajax({
                type: "POST",
                dataType: "json",
                data: JSON.stringify(DTO),
                cache: false,
                url: url,
                contentType: "application/json;charset=utf-8",
                beforeSend: function () {
                    $('.spinner').show();
                },
                success: function (data)
                {
                    if (data.Status == "ValidError")
                    {
                        $('.spinner').hide();
                        alert(data.Message)
                        return;
                    }
                    else
                    {
                        $('#lrmodel').modal('show');
                        $('#LRDetailsDialog').html(data.Html);
                        $('#lbltxtAmt').html(data.Amt);
                        $('.spinner').hide();
                    }
                },
                error: function ()
                {
                    alert("Error occured while processing your request.");
                }
            });
        });
        $('button[action|="EditLRLedger"]').click(function (event) {
            event.preventDefault(event);
            var myBatchArray = [];
            $('#lrtabledata tbody tr').each(function () {
                var tds = $(this).find('td');
                var myDets = {
                    tempId: tds.eq(1).text(),
                    ExpAcount: tds.eq(2).text(),
                    ExpAcountName: tds.eq(3).text(),
                    SubHeadAcc: tds.eq(4).text(),
                    ExpAmount: tds.eq(5).text(),
                }
                myBatchArray.push(myDets);
            });
            var ModelData = {};
            ModelData["tempId"] = $(this).val();
            ModelData["LRDetailList"] = myBatchArray;
            ModelData["Mode"] = "Edit";
            var DTO = { Model: ModelData };
            var url = '@Url.Action("GetLRDetails")';
            $.ajax({
                type: "POST",
                dataType: "json",
                data: JSON.stringify(DTO),
                cache: false,
                url: url,
                contentType: "application/json;charset=utf-8",
                beforeSend: function () {
                    $('.spinner').show();
                },
                success: function (data) {
                    $('.spinner').hide();
                    $('#LRDetailsDialog').html(data.Html);
                    $("#btnaddLRDetails").hide();
                    $('#EditSaveLRLedger').show();
                    $("#txtExpAcount").prop('disabled', false);
                    $("#txtSubHeadAcc").prop('disabled', false);
                    $("#txtExpAmount").prop('disabled', false);
                },
                error: function (err) {
                    alert(JSON.stringify(err))
                    alert("Error occured while processing your request.");
                }
            });
        });
        $("#EditSaveLRLedger").click(function (event) {
            event.preventDefault();
            debugger;
            var myBatchArray = [];
            $('#lrtabledata tbody tr').each(function () {
                var tds = $(this).find('td');
                var myDets = {
                    tempId: tds.eq(1).text(),
                    ExpAcount: tds.eq(2).text(),
                    ExpAcountName: tds.eq(3).text(),
                    SubHeadAcc: tds.eq(4).text(),
                    ExpAmount: tds.eq(5).text(),
                }
                myBatchArray.push(myDets);
            });
            var ModelData = {};
            ModelData["LRDetailList"] = myBatchArray;
            ModelData["Mode"] = "Edit";
            ModelData["ExpAcount"] = $("#txtExpAcount").val();
            ModelData["SubHeadAcc"] = $("#txtSubHeadAcc").val();
            ModelData["ExpAmount"] = $("#txtExpAmount").val();
            ModelData["tempId"] = $("#hdnLRtempid").val();
            var DTO = { Model: ModelData };
            var url = '@Url.Action("AddLRDetails")';
            $.ajax({
                type: "POST",
                dataType: "json",
                data: JSON.stringify(DTO),
                cache: false,
                url: url,
                contentType: "application/json;charset=utf-8",
                beforeSend: function () {
                    $('.spinner').show();
                },
                success: function (data)
                {
                    if (data.Status == "ValidError")
                    {
                        $('.spinner').hide();
                        alert(data.Message)
                        return;
                    }
                    else
                    {
                        $('#LRDetailsDialog').html(data.Html);
                        $('#lbltxtAmt').html(data.Amt);
                        $('.spinner').hide();
                        $('#EditSaveLRLedger').hide();
                    }
                },
                error: function () {
                    alert("Error occured while processing your request.");
                }
            });
        });
        $('button[action|="DeleteLRLedger"]').click(function (event) {
            event.preventDefault(event);
            var myBatchArray = [];
            $('#lrtabledata tbody tr').each(function () {
                var tds = $(this).find('td');
                var myDets = {
                    tempId: tds.eq(1).text(),
                    ExpAcount: tds.eq(2).text(),
                    ExpAcountName: tds.eq(3).text(),
                    SubHeadAcc: tds.eq(4).text(),
                    ExpAmount: tds.eq(5).text(),
                }
                myBatchArray.push(myDets);
            });
            var ModelData = {};
            ModelData["LRDetailList"] = myBatchArray;
            ModelData["tempId"] = $(this).val();
            var DTO = { Model: ModelData };
            var url = '@Url.Action("DeleteLRDetails")';
            $.ajax({
                type: "POST",
                dataType: "json",
                data: JSON.stringify(DTO),
                cache: false,
                url: url,
                contentType: "application/json;charset=utf-8",
                beforeSend: function () {
                    $('.spinner').show();
                },
                success: function (data)
                {
                    $('.spinner').hide();
                    $('#LRDetailsDialog').html(data.Html);
                    $('#lbltxtAmt').html(data.Amt);
                },
                error: function () {
                    alert("Error occured while processing your request.");
                }
            });
        });
        
    });
    function LoadExpAc() {
        var url = '@Url.Action("GetExpeAcc")'
        $('#txtExpAcount').select2({
            minimumInputLength: 0,
            placeholder: 'Search',
            ajax: {
            url: url,
            dataType: 'json',
            quietMillis: 100,
            enableFiltering: true,
            allowClear: true,
            minimumInputLength: 0,
            multiple: true,
            width: 300,
            data: function (term, page) {
                return {
                    types: ["exercise"],
                    limit: -1,
                    term: term
                };
            },
            results: function (data, page) {
                clientObj = JSON.stringify(data);
                return {
                    results: $.map(data, function (item) {
                        return {
                            text: item.Name,
                            id: item.Code
                        }
                    })
                };
            }
            },
            initSelection: function (element, callback) {
                var data = { id: '@Model.ExpAcount', text: '@Model.ExpAcountName' };
                callback(data);
            },
            formatResult: function (exercise) {
                return "<div class='row-fluid'><div class=''><span class='span1'><div style='color:" + exercise.alias + "'>" + exercise.text +
                    "</div></span></div></div>";
            },
            formatSelection: function (exercise) {
                LoadCustomerBasedLrType();
                return "<div class='row-fluid'><div class=''><span class='span1'><div style='color:" + exercise.alias + "'>" + exercise.text +
                    "</div></span></div></div>";
            },
        })
    };
</script>

