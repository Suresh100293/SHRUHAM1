@model AdvancePayModel
@using Common



<div class="fixTableHead" id="SelectedledgerTable" style="max-height:330px;min-height:330px;width: auto; overflow: auto;">
    <table id="tabledata" class="zui-table" style="border-color:gray;">
        <thead>
            <tr role="row" style="font-family:Tahoma;font-size:9pt;">
                <th style="width: 3%;vertical-align:inherit;" colspan="2"></th>
                <th style="width: 1%;vertical-align:inherit;">Sr.</th>
                <th style="width: 5%;vertical-align:inherit;">FM No</th>
                <th style="width: 10%;vertical-align:inherit;">FM Branch</th>
                <th style="width: 10%;vertical-align:inherit;">VehicleNo</th>
                <th style="width: 10%;vertical-align:inherit;">Driver</th>
                <th style="width: 10%;vertical-align:inherit;">ChargeRef</th>
                <th style="width: 10%;vertical-align:inherit;">Amount</th>
                <th style="width: 10%;vertical-align:inherit;">TDS Amt</th>
                @if (Model.HeaderList != null)
                {
                    for (int i = 0; i < Model.HeaderList.Count; i++)
                    {
                        <th style="width:10%">@Model.HeaderList[i] (@Model.AddlessList[i]) </th>
                    }
                }
                <th style="width: 10%;vertical-align:inherit;">Narration</th>
                <th class="hidden" style="width: 10%;vertical-align:inherit;">RefKey</th>
            </tr>
        </thead>
        <tbody>
            @if (Model.SelectedLedger != null)
            {
                foreach (var item in @Model.SelectedLedger.ToList())
                {
                    var btnDelete = @item.tempid;
                    <tr style="font-family:Tahoma;font-size:9pt;">
                        @if (Model.Mode != "Delete")
                        {
                            <td style="vertical-align:inherit;">
                                <button type="button" action="EditLedger" class="btn btn-warning btn-sm" value="@item.tempid" title="Edit"><i class="fa fa-edit"></i></button>
                            </td>
                            <td style="vertical-align:inherit;">
                                <button type="button" action="DeleteLedger" class="btn btn-danger btn-sm" value="@item.tempid" title="Delete"><i class="fa fa-trash-o"></i></button>
                            </td>
                        }
                        else
                        {
                            <td style="vertical-align:inherit;"></td>
                            <td style="vertical-align:inherit;"></td>
                        }
                        <td style="vertical-align:inherit;">@item.tempid</td>

                        <td style="vertical-align:inherit;">@item.FMNo</td>
                        <td style="vertical-align:inherit;">@item.BranchName</td>
                        <td style="vertical-align:inherit;">@item.VehicleNO</td>
                        <td style="vertical-align:inherit;">@item.DriverName</td>
                        <td style="vertical-align:inherit;">@item.ChargeRef</td>

                        @if (item.ChgPickupList != null)
                        {
                            foreach (var a in item.ChgPickupList)
                            {
                                <td class="txtentercls" @*contenteditable="true"*@>@a</td>
                            }
                        }
                        <td style="vertical-align:inherit;">@item.Remark</td>
                        <td class="hidden AlertRefTableKey" style="vertical-align:inherit;">@item.RefTableKey</td>

                    </tr>

                }
                <tr>
                    <td colspan="8"> Total:</td>

                    @*<td>@Model.TotalTaxable</td>*@
                    @if (Model.TotalChgPickupList != null)
                    {
                        foreach (var a in Model.TotalChgPickupList)
                        {
                            <td class="txtentercls">@a</td>
                        }
                    }
                    <td></td>
                </tr>
            }

        </tbody>

    </table>
</div>

<div class="example-modal">
    <div id="addcashbank" class="modal modal-primary" style="z-index:2500;">
        <div class="modal-dialog modal-lg">
            <div id="AddCashBank">
                @Html.Partial("AddAdvancePayPopup")
            </div>
        </div>
    </div>
</div>

<script>
    $(document).ready(function () {
        $('button[action|="DeleteLedger"]').click(function (event) {
            event.preventDefault(event);
            var ModelData = {};
            ModelData["tempId"] = $(this).val();
            ModelData["Mode"] = $("#hdnMode").val();
            ModelData["ParentKey"] = $("#hdnParentKey").val();

            ModelData["TDSFlag"] = $("#addTDSFlag").prop('checked');
            ModelData["GSTFlag"] = $("#addGSTNoItc").prop('checked');
            ModelData["TDSRate"] = $("#addTDSRate").val();
            ModelData["IGSTRate"] = $("#addIGSTRate").val();
            ModelData["CGSTRate"] = $("#addCGSTRate").val();
            ModelData["SGSTRate"] = $("#addSGSTRate").val();


            var DTO = { Model: ModelData };
            var url = '@Url.Action("DeleteAdvanceLedger")';
            $.ajax({
                type: "POST",
                dataType: "json",
                data: JSON.stringify(DTO),
                cache: false,
                url: url,
                contentType: "application/json;charset=utf-8",
                beforeSend: function () {
                    $('.spinner').show();
                },
                success: function (data) {
                    $('.spinner').hide();
                    $('#ErrorMessage').hide();
                    debugger;
                    $('#divLedgerTable').html('');
                    $('#divLedgerTable').html(data.Html);

                    $('#NetAmt').val(data.SumAmt);
                    
                },
                error: function () {
                    alert("Error occured while processing your request.");
                }
            });
        });

        $('button[action|="EditLedger"]').click(function (event) {
            event.preventDefault(event);
            var ModelData = {};
            ModelData["tempId"] = $(this).val();
            ModelData["SessionFlag"] = "Edit";
            ModelData["ParentKey"] = $("#hdnParentKey").val();
            var DTO = { Model: ModelData };
            var url = '@Url.Action("GetAdvanceLedger")';
            $.ajax({
                type: "POST",
                dataType: "json",
                data: JSON.stringify(DTO),
                cache: false,
                url: url,
                contentType: "application/json;charset=utf-8",
                beforeSend: function () {
                    $('.spinner').show();
                },
                success: function (data) {
                    $('.spinner').hide();
                    $('#addcashbank').modal('show');
                    $('#AddCashBank').html('');
                    $('#AddCashBank').html(data.Html);
                    $("#pushrecord").hide();
                },
                error: function (err) {
                    alert(JSON.stringify(err))
                    alert("Error occured while processing your request.");
                }
            });
        });
    });
</script>
<style>
    .fixTableHead {
        overflow-y: auto;
        height: 300px;
    }

        .fixTableHead thead th {
            position: sticky;
            top: 0;
        }
</style>