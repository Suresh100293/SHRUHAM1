@model ALT_ERP3.Areas.Vehicles.Models.SparePartTransferVM
@using Common;
<script>
    $(document).ready(function () {
        $('#ItemComboBill').modal({
            backdrop: 'static',
            keyboard: false
        })
        $("#ItemComboBill").modal("hide");
        $("#ItemComboBill").css("display", "none");


        $("#btnGetItemList").click(function (event) {
            var ModelData = {};
            var BillDetails = [];
            $("#list > tbody  > tr").each(function () {
                if ($(this).find('input[type=checkbox]').prop("checked") == true) {
                    var Row = $(this).closest('tr');
                    
                    var myDets = {
                        Tablekey: Row.find('td:eq(4)').text(),
                        VehicleNo: Row.find("#AcType").val(),
                        ProductCode: Row.find('td:eq(12)').text(),
                        ProductName: Row.find('td:eq(6)').text(),
                        ItemCode: Row.find('td:eq(13)').text(),
                        ItemName: Row.find('td:eq(7)').text(),
                        TotalQty: Row.find('td:eq(8)').text(),
                        BalQty: Row.find('td:eq(9)').text(),
                        Qty: Row.find(".LGQty").val(),
                    }
                    BillDetails.push(myDets);
                }
            });

            if (BillDetails.length == 0) {
                alert('Select Altealst One Stock...');
                return;
            }

            ModelData["Mode"] = "Add";
            ModelData["ItemList"] = BillDetails;
            ModelData["Party"] = $("#Party").val();
            var DTO = { Model: ModelData };
            var url = '@Url.Action("AddEditSelectedLedger")';
            $.ajax({
                type: "POST",
                dataType: "json",
                data: JSON.stringify(DTO),
                cache: false,
                url: url,
                contentType: "application/json;charset=utf-8",
                beforeSend: function () {
                    $('.spinner').show();
                },
                success: function (data) {
                    $('.spinner').hide();
                    var BillListDiv = $("#ItemRelatedDialog");
                    BillListDiv.html('');
                    BillListDiv.html(data.Html);
                    $("#ItemComboBill").modal("hide");
                    $("#ItemComboBill").css("display", "none");
                },
                error: function (err) {
                    alert(JSON.stringify(err))
                    alert("Error occured while processing your request.");
                }
            });
        });
        $('button[action|="EditLedger"]').click(function (event) {
            event.preventDefault(event);
            ModelData = {};
            ModelData["Srno"] = $(this).val();
            ModelData["Mode"] = "Edit";
            var DTO = { Model: ModelData };
            var url = '@Url.Action("GetBreakLedger")';
            $.ajax({
                type: "POST",
                dataType: "json",
                data: JSON.stringify(DTO),
                cache: false,
                url: url,
                contentType: "application/json;charset=utf-8",
                beforeSend: function () {
                    $('.spinner').show();
                },
                success: function (data) {
                    $('.spinner').hide();
                    $('#addnewbill').modal('show');
                    $('#AddnNewBillList').html(data.Html);
                },
                error: function (err) {
                    alert(JSON.stringify(err))
                    alert("Error occured while processing your request.");
                }
            });
        });


        $('button[action|="DeleteLedger"]').click(function (event) {
            event.preventDefault(event);
            var ModelData = {};
            ModelData["Srno"] = $(this).val();
            var DTO = { Model: ModelData };
            var url = '@Url.Action("DeleteLedger")';
            $.ajax({
                type: "POST",
                dataType: "json",
                data: JSON.stringify(DTO),
                cache: false,
                url: url,
                contentType: "application/json;charset=utf-8",
                beforeSend: function () {
                    $('.spinner').show();
                },
                success: function (data) {
                    $('.spinner').hide();
                    $('#ItemRelatedDialog').html(data.Html);
                },
                error: function (err) {
                    alert(JSON.stringify(err))
                    alert("Error occured while processing your request.");
                }
            });
        });
        // Search all columns
        $('#Search').keyup(function () {
            var value = $(this).val();
            if (value != "") {
                $("#list > tbody > tr > td ").each(function () {
                    if ($(this).text().toLowerCase().indexOf(value.toLowerCase()) >= 0) {
                        var dd = $(this).text().toLowerCase();
                        $(this).addClass("SearchRow");
                    }
                    else {
                        $(this).removeClass("SearchRow");
                    }
                });
            }
            else
            {
                $('#list td').removeClass('SearchRow');
            }
        });
    });
    function JQGridCheckbox() {
        $('#list tbody tr').each(function () {
            debugger;
            var Row = $(this).closest('tr');
            var CheckBox = $(this).find("input[class='ItemDebitGrid']").is(':checked');
            if (CheckBox) {
                Row.find(".LGQty").val(Row.find('td:eq(9)').text());
                Row.find(".LGQty").prop("disabled", false);
                Row.find(".SearchVehicle").prop("disabled", false);
                
            }
            else {
                Row.find(".LGQty").val("0");
                Row.find(".LGQty").prop("disabled", true);
                Row.find("#select2-chosen-2").text("-- Select --");
                Row.find("#AcType").val("0");
                Row.find(".SearchVehicle").prop("disabled", true);
            }
        });
    }
    function QtyCheck() {
        $('#list tbody tr').each(function () {
            var Row = $(this).closest('tr');
            var CheckBox = $(this).find("input[class='ItemDebitGrid']").is(':checked');
            var Qty = 0, Weight = 0;

            if (CheckBox) {
                debugger;
                var BalQty = Row.find('td:eq(9)').text();
                var LoadQty = Row.find(".LGQty").val();
                if (parseInt(BalQty) >= parseInt(LoadQty)) {
                    Row.find(".LGQty").val(LoadQty);
                }
                else
                {
                    alert("Qty Not Greater Than Bal Qty OF Item Stock.....!");
                    Row.find(".LGQty").val(BalQty);
                }
            }
        });
    }
</script>
<div class="grid" id="SelectedledgerTable" style="max-height:375px; width:100%;margin-left:0%; overflow-y: scroll;">
    @{
        <table id="tabledata" class="zui-table" style="width:80%">
            <thead>
                <tr role="row" style="font-family:Tahoma;font-size:9pt;width:100%">
                    <th style="width:5%">Sr.</th>
                    <th style="width:20%">Product Name</th>
                    <th style="width:20%">Item Name</th>
                    <th style="width:7%">Total Qty</th>
                    <th style="width:7%">Bal Qty</th>
                    <th style="width:7%">Qty</th>
                    <th style="width:10%">Vehicle No</th>
                    <th colspan="4" style="width:10%">
                        <button type="button" id="btnadddata" class="btn btn-primary btn-sm btnadddata" title="Add" onclick="myfunction();" style="margin-left:10px;width:60%;height:25px;border:1px solid black"><i class="fa fa-plus" style="color:black;"></i></button>
                    </th>
                </tr>
            </thead>

            <tbody>
                @{
                    if (Model.ItemList != null)
                    {
                        foreach (var item in @Model.ItemList.ToList())
                        {
                            <tr role="row" style="font-family:Tahoma;font-size:9pt;">
                                <td class="hidden" style="width:1%">@item.Tablekey</td>
                                <td >@item.Srno</td>
                                <td >@item.ProductName</td>
                                <td >@item.ItemName</td>
                                <td >@item.TotalQty</td>
                                <td >@item.BalQty</td>
                                <td style="text-align:right">@item.Qty</td>
                                <td style="text-align:center">@item.VehicleNoN</td>
                                <td colspan="4" style="text-align: center;">
                                    <button type="button" action="EditLedger" class="btn btn-warning btn-sm" value="@item.Srno" title="Edit"><i class="fa fa-edit"></i></button>
                                    <button type="button" action="DeleteLedger" class="btn btn-danger btn-sm" value="@item.Srno" title="Delete"><i class="fa fa-trash-o"></i></button>
                                </td>
                            </tr>
                        }
                    }
                }
            </tbody>
        </table>
    }
</div>



<!--Item Stock List Modal -->
<div class="modal fade" id="ItemComboBill" style="width: 100%;display: block;" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-sm modal-xl" role="document" style="width: auto;margin: auto;margin-top: 5%;">
        <div class="modal-content">
            <div class="modal-header" style="background-color:#cccccc;padding-top:5px;">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <div class="form-group">
                    <div class="col-md-2">
                        <h4 class="modal-title">
                            <b>Spare Parts Stock</b>
                        </h4>
                    </div>
                    <div class="col-md-4">
                        <div class="col-md-4">
                        </div>
                        <div class="col-md-1">
                        </div>
                        <div class="col-md-3">
                        </div>
                        <div class="col-md-1">
                        </div>
                    </div>
                    <div class="col-md-5">
                        <div class="col-md-2">
                        </div>
                        <div class="col-md-3">
                        </div>
                        <div class="col-md-2">
                            <label class=" bold control-label" style="margin-top: 5px;"> Search</label>
                        </div>
                        <div class="col-md-5">
                            <input type="text" id="Search" class="form-control" placeholder="Search Here" />
                        </div>

                    </div>
                </div>
            </div>
            <div class="modal-body" style="padding: 0px !important;">
                <div id="ItemComboBillList" style="height:450px;padding:0px 0px 0px 0px;display:block !important;">

                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" id="btnGetItemList">Submit</button>
            </div>
        </div>
    </div>
</div>

<!--Single Item Stock Edit Mode Modal -->
<div class="example-modal">
    <div id="addnewbill" class="modal modal-default" style="margin-top:4%;">
        <div class="modal-dialog modal-lg" style="width:1040px;overflow:unset">
            <div id="AddnNewBillList">
                @Html.Partial("EditSingleItemStock")
            </div>
        </div>
    </div>
</div>




