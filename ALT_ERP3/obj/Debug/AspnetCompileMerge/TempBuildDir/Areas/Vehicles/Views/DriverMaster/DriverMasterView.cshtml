@model TFATERPWebApplication.Areas.Vehicles.Models.DriverMasterVM
@using Common;

<script src="~/Content/js/iCheck/jquery.icheck.js"></script>
<script src="~/Content/js/icheck-init.js"></script>

<script type="text/javascript">
    $(document).ready(function () {
        LoadZone();
        LoadBranch();

        $('#Licence_Exp_Date').datepicker({
            format: 'dd/mm/yyyy',
            changeMonth: true,
            changeYear: true,
            yearRange: "-60:+0",
            autoclose: true,
            //startDate: "+0d",
        });

        $('#btnDelete').click(function (event) {
            event.preventDefault();
            //if ($("#StateMaster").validate().form() == false)
            //    return;
            var result = confirm("Are you sure you want to delete?");
            if (result) {


            var url = '@Url.Action("SaveData")';
            @* iX9: Data from individual field is passed on to the Model and then to Controller for Saving *@
            var ModelData = {};
            ModelData["Document"] = $("#Document").val();
            ModelData["Mode"] = '@Model.Mode';
            var DTO = { mModel: ModelData };
            $.ajax({
                type: "POST",
                dataType: "json",
                data: JSON.stringify(DTO),
                cache: false,
                url: url,
                contentType: "application/json; charset=utf-8",
                beforeSend: function () {
                    $('.spinner').show();
                },
                success: function (data) {
                    if (data.Status == 'Success') {
                        $('.spinner').hide();
                        window.location.href = "/Vehicles/MasterGrid/Index?ViewDataId=@Model.ViewDataId&Module=@Model.Module&TableName=@Model.TableName&OptionType=@Model.OptionType&OptionCode=@Model.OptionCode&Header=@Model.Header&Controller2=@Model.Controller2&MainType=@Model.MainType";
                        $("#ErrorMessage").hide();
                    }
                    else {
                        $('.spinner').hide();
                        alert(data.Message);                    }
                },
            });
            } else {
                $('.spinner').hide();
                window.location.href = "/Vehicles/MasterGrid/Index?ViewDataId=@Model.ViewDataId&Module=@Model.Module&TableName=@Model.TableName&OptionType=@Model.OptionType&OptionCode=@Model.OptionCode&Header=@Model.Header&Controller2=@Model.Controller2&MainType=@Model.MainType";
                        $("#ErrorMessage").hide();
            }


        });

        $('#Submit').click(function (event) {
            event.preventDefault();
            var TruckStatus = "";
            //if ($("#StateMaster").validate().form() == false)
            //    return;

            if ($("#ZoneCode").val() == null || $("#ZoneCode").val() == '')
            {
                $("#ErrorMessage").show();
                $("#ErrorMessage").text('Please Select Zone..');
                return;
            }
            if ($("#Name").val() == null || $("#Name").val() == '')
            {
                $("#ErrorMessage").show();
                $("#ErrorMessage").text('Name is Required..');
                return;
            }

            if ($("#MobileNo1").val() == null || $("#MobileNo1").val() == '')
            {
                $("#ErrorMessage").show();
                $("#ErrorMessage").text( 'Atleast One MobileNo Required..');
                return;
            }

            if ($("#LicenceNo").val() == null || $("#LicenceNo").val() == '')
            {
                $("#ErrorMessage").show();
                $("#ErrorMessage").text( 'LicenceNo Required..');
                return;
            }

            if ($("#Licence_Exp_Date").val() == null || $("#Licence_Exp_Date").val() == '')
            {
                $("#ErrorMessage").show();
                $("#ErrorMessage").text( 'Licence_Exp_Date Required..');
                return;
            }

            if ($("#ValidProof").val() == null || $("#ValidProof").val() == '')
            {
                $("#ErrorMessage").show();
                $("#ErrorMessage").text( 'ValidProof Required..');
                return;
            }

            if ($("#ProofNo").val() == null || $("#ProofNo").val() == '')
            {
                $("#ErrorMessage").show();
                $("#ErrorMessage").text( 'ProofNo Required..');
                return;
            }
           

            var url = '@Url.Action("SaveData")';
            @* iX9: Data from individual field is passed on to the Model and then to Controller for Saving *@
            var ModelData = {};
            ModelData["Document"] = $("#Document").val();

            ModelData["Name"] = $("#Name").val();
            ModelData["Nick_Name"] = $("#Nick_Name").val();
            ModelData["MobileNo1"] = $("#MobileNo1").val();
            ModelData["MobileNo2"] = $("#MobileNo2").val();
            ModelData["Guaranter"] = $("#Guaranter").val();
            ModelData["LicenceNo"] = $("#LicenceNo").val();
            ModelData["Licence_Exp_Date"] = $("#Licence_Exp_Date").val();
            ModelData["ValidProof"] = $("#ValidProof").val();
            ModelData["ProofNo"] = $("#ProofNo").val();
            ModelData["VehicleNo"] = $("#VehicleNo").val();
            ModelData["Active"] = $("#Active").val();
            ModelData["ZoneCode"] = $("#ZoneCode").val();
            ModelData["BranchCode"] = $("#BranchCode").val();


            ModelData["Mode"] = '@Model.Mode';
            var DTO = { mModel: ModelData };
            $.ajax({
                type: "POST",
                dataType: "json",
                data: JSON.stringify(DTO),
                cache: false,
                url: url,
                contentType: "application/json; charset=utf-8",
                beforeSend: function () {
                    $('.spinner').show();
                },
                success: function (data) {
                    if (data.Status == 'Success') {
                        $('.spinner').hide();
                        window.location.href = "/Vehicles/MasterGrid/Index?ViewDataId=@Model.ViewDataId&Module=@Model.Module&TableName=@Model.TableName&OptionType=@Model.OptionType&OptionCode=@Model.OptionCode&Header=@Model.Header&Controller2=@Model.Controller2&MainType=@Model.MainType";
                        $("#ErrorMessage").hide();
                    }
                    else {
                        $('.spinner').hide();
                        alert(data.Message);                    }
                },
            });
        });

    });
    function LoadZone() {
        var url = '@Url.Action("GetZone")'
        $('#ZoneCode').select2({
            minimumInputLength: 0,
            placeholder: 'Search',
            ajax: {
                url: url,
                dataType: 'json',
                quietMillis: 100,
                enableFiltering: true,
                allowClear: true,
                minimumInputLength: 0,
                multiple: true,
                width: 300,
                data: function (term, page) {
                    return {
                        types: ["exercise"],
                        limit: -1,
                        term: term
                    };
                },
                results: function (data, page) {
                    clientObj = JSON.stringify(data);
                    return {
                        results: $.map(data, function (item) {
                            return {
                                text: item.Name,
                                id: item.Code
                            }
                        })
                    };
                }
            },

            initSelection: function (element, callback) {
                var data = { id: '@Model.ZoneCode', text: '@Model.ZoneName' };
                callback(data);
            },

            formatResult: function (exercise) {
                return "<div class='row-fluid'><div class=''><span class='span1'><div style='color:" + exercise.alias + "'>" + exercise.text +
                    "</div></span></div></div>";
            },

            formatSelection: function (exercise) {
                LoadBranch();
                $("#BranchCode").prop('disabled', false);
                return "<div class='row-fluid'><div class=''><span class='span1'><div style='color:" + exercise.alias + "'>" + exercise.text +
                    "</div></span></div></div>";
            },
        })
    };
    function LoadBranch() {
        var url = '@Url.Action("GetBranch")'
        $('#BranchCode').select2({
            minimumInputLength: 0,
            placeholder: 'Search',
            ajax: {
                url: url,
                dataType: 'json',
                quietMillis: 100,
                enableFiltering: true,
                allowClear: true,
                minimumInputLength: 0,
                multiple: true,
                width: 300,
                data: function (term, page) {
                    return {
                        types: ["exercise"],
                        limit: -1,
                        term: term,
                        ZoneCode: $("#ZoneCode").val()
                    };
                },
                results: function (data, page) {
                    clientObj = JSON.stringify(data);
                    return {
                        results: $.map(data, function (item) {
                            return {
                                text: item.Name,
                                id: item.Code
                            }
                        })
                    };
                }
            },

            initSelection: function (element, callback) {
                var data = { id: '@Model.BranchCode', text: '@Model.BranchName' };
                callback(data);
            },

            formatResult: function (exercise) {
                return "<div class='row-fluid'><div class=''><span class='span1'><div style='color:" + exercise.alias + "'>" + exercise.text +
                    "</div></span></div></div>";
            },

            formatSelection: function (exercise) {
                return "<div class='row-fluid'><div class=''><span class='span1'><div style='color:" + exercise.alias + "'>" + exercise.text +
                    "</div></span></div></div>";
            },
        })
    };
</script>
<style>
    .red {
        color: red;
    }
</style>
<div class="form-horizontal" id="Rmaster" role="form" style="margin-top:15px; overflow-x:hidden; ">
    <div class="form-group">
        <label class="col-sm-2 control-label">System Code:</label>
        <div class="col-sm-2">
            @Html.TextBoxFor(x => x.Code, new { @class = "input-large-query form-control", @readonly = "readonly", @Value = Model.Code })
        </div>
        <div class="col-sm-1"></div>

        <div class="col-sm-4">
            @*@Html.TextBoxFor(x => x.Name, new { @class = "form-control", @Name = "Name", @Id = "Name", @Value = Model.Name, @MaxLength = "70" })*@
        </div>
    </div>

    @*<div class="form-group">
            <label class="col-sm-2 control-label">Current Address:<span class="red">*</span></label>
            <div class="col-sm-4">
                @Html.TextAreaFor(x => x.Current_Address, new { @class = "form-control", @rows = 4, @Value = Model.Current_Address })
            </div>
            <label class="col-sm-2 control-label">Permanent Address:<span class="red">*</span></label>
            <div class="col-sm-4" style="display: flex;">
                @Html.TextAreaFor(x => x.Permanent_Address, new { @class = "form-control", @rows = 4, @Value = Model.Permanent_Address })
                @Html.CheckBox("CopyAddre", new { @id = "Hide", @name = "Hide", @class = "form-control", @style = "height:20px;width:21px;margin: 33px 0px 0px 3px;" })
            </div>
        </div>
        <div class="form-group">
            <label class="col-sm-2 control-label">Current City:<span class="red">*</span></label>
            <div class="col-sm-4">
                @Html.TextBoxFor(x => x.Current_City, new { @class = "form-control", @Value = Model.Current_City })
            </div>
            <label class="col-sm-2 control-label">Permanent City:<span class="red">*</span></label>
            <div class="col-sm-4">
                @Html.TextBoxFor(x => x.Permanent_City, new { @class = "form-control", @Value = Model.Permanent_City })
            </div>
        </div>
        <div class="form-group">
            <label class="col-sm-2 control-label">Current Pin:<span class="red">*</span></label>
            <div class="col-sm-4">
                @Html.TextBoxFor(x => x.Current_Pin, new { @class = "form-control", @Value = Model.Current_Pin })
            </div>
            <label class="col-sm-2 control-label">Permanent Pin:<span class="red">*</span></label>
            <div class="col-sm-4">
                @Html.TextBoxFor(x => x.Permanent_Pin, new { @class = "form-control", @Value = Model.Permanent_Pin })
            </div>
        </div>
        <div class="form-group">
            <label class="col-sm-2 control-label">Current State:<span class="red">*</span></label>
            <div class="col-sm-4">
                @Html.TextBoxFor(x => x.Current_State, new { @class = "form-control", @Value = Model.Current_State })
            </div>
            <label class="col-sm-2 control-label">Permanent State:<span class="red">*</span></label>
            <div class="col-sm-4">
                @Html.TextBoxFor(x => x.Permanent_State, new { @class = "form-control", @Value = Model.Permanent_State })
            </div>
        </div>*@

    @*<div class="form-group">
            <label class="col-sm-2 control-label">Phone No:</label>
            <div class="col-sm-2">
                @Html.TextBoxFor(x => x.PhoneNo, new { @class = "form-control", @Value = Model.PhoneNo })
            </div>
            <div class="col-sm-4">
            </div>
        </div>*@
    <div class="form-group">
        <label class="col-sm-2 control-label">Zone:<span class="red">*</span></label>
        <div class="col-sm-3">
            @Html.TextBoxFor(x => x.ZoneCode, new { @class = "input-large-query", @style = "width:60%;", @Value = Model.ZoneCode })

            @*@Html.TextBoxFor(x => x.ZoneCode, new { @class = "input-large-query form-control", @Value = Model.ZoneCode })*@
        </div>
        <div class="col-sm-1"></div>
        <label class="col-sm-2 control-label">Branch:</label>
        <div class="col-sm-3">
            @Html.TextBoxFor(x => x.BranchCode, new { @class = "input-large-query", @style = "width:60%;", @Value = Model.BranchCode, @disabled = "disabled" })

            @*@Html.TextBoxFor(x => x.BranchCode, new { @class = "form-control", @Value = Model.BranchCode })*@
        </div>

    </div>
    <div class="form-group">
        <label class="col-sm-2 control-label">Driver Name:<span class="red">*</span></label>
        <div class="col-sm-3">
            @Html.TextBoxFor(x => x.Name, new { @class = "input-large-query form-control", @Value = Model.Name })
        </div>
        <div class="col-sm-1"></div>
        <label class="col-sm-2 control-label">Short Name (Alias):</label>
        <div class="col-sm-2">
            @Html.TextBoxFor(x => x.Nick_Name, new { @class = "form-control", @Value = Model.Nick_Name })
        </div>

    </div>
    <div class="form-group">
        <label class="col-sm-2 control-label">Mobile No:<span class="red">*</span></label>
        <div class="col-sm-3">
            @Html.TextBoxFor(x => x.MobileNo1, new { @class = "form-control", @Value = Model.MobileNo1, @style = "width: 170px;" })
        </div>
        <div class="col-sm-1"></div>

        <label class="col-sm-2 control-label">Alternate Mobile No:</label>
        <div class="col-sm-3">
            @Html.TextBoxFor(x => x.MobileNo2, new { @class = "form-control", @Value = Model.MobileNo2, @style = "width: 170px;" })
        </div>
        <div class="col-sm-1"></div>
    </div>

    <div class="form-group">
        <label class="col-sm-2 control-label">LicenceNo:<span class="red">*</span></label>
        <div class="col-sm-4">
            @Html.TextBoxFor(x => x.LicenceNo, new { @class = "form-control", @Value = Model.LicenceNo, @style = "width:170px;" })
        </div>
        <label class="col-sm-2 control-label">Licence Exp Date:<span class="red">*</span></label>
        <div class="col-sm-4">
            @Html.TextBoxFor(x => x.Licence_Exp_Date, new { @class = "form-control", @Value = Model.Licence_Exp_Date, @style = "width:170px;" })
        </div>
    </div>

    <div class="form-group">
        <label class="col-sm-2 control-label">Guaranter:</label>
        <div class="col-sm-3">
            @Html.TextBoxFor(x => x.Guaranter, new { @class = "form-control", @Value = Model.Guaranter })
        </div>
        <div class="col-sm-1"></div>
        <label class="col-sm-2 control-label">Vehicle No:</label>
        <div class="col-sm-2">
            @Html.TextBoxFor(x => x.VehicleNo, new { @class = "form-control", @Value = Model.VehicleNo, @readonly = "readonly" })
        </div>
    </div>

    <div class="form-group">
        <label class="col-sm-2 control-label">Valid Proof:<span class="red">*</span></label>
        <div class="col-sm-4">
            @Html.DropDownListFor(m => m.ValidProof, Model.ValidProoflist, new { @class = "form-control", @style = "width:210px;" })
        </div>
        <label class="col-sm-2 control-label">Proof No:<span class="red">*</span></label>
        <div class="col-sm-4">
            @Html.TextBoxFor(x => x.ProofNo, new { @class = "form-control", @Value = Model.ProofNo, @style = "width:170px;" })
        </div>
    </div>
    <div class="form-group">
        <label class="col-sm-2 control-label">Active / InActive:</label>
        <div class="col-sm-3">

            @Html.CheckBoxFor(x => x.Active, new { @class = "checkbox", @style = "width:20px;", @Value = Model.Active })
        </div>
        <div class="col-sm-2"></div>
    </div>

    @*<div class="form-group" >
            <label class="col-sm-2 control-label">Vehicle No:<span class="red">*</span></label>
            <div class="col-sm-4">
                @Html.TextBoxFor(x => x.VehicleNo, new { @class = "form-control", @Value = Model.VehicleNo, @readonly = "readonly" })
            </div>
            <div class="col-sm-4">
            </div>
        </div>*@



</div>
@Html.HiddenFor(x => x.Document)