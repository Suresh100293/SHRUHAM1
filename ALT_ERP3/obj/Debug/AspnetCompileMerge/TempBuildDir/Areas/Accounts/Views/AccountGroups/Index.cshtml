
@model TFATERPWebApplication.Areas.Accounts.Models.AccountGroupsVM
@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_NewLayoutMenu.cshtml";
}



<script src="@Url.Content("~/Content/js/jquery.validate.min.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Content/js/jquery.constrain.js")" type="text/javascript"></script>
<script src="~/Scripts/jquery.jstree.js"></script>

<script type="text/javascript">
    $(document).ready(function ()
    {
        FillTreeView();

        @* iX9: Validation rules for the fields where AllowBlank is False in Definition *@
        $('#AccountGroups').validate({
            onfocusout: false,
            errorLabelContainer: $('#ErrorMessage'),
            wrapper: "li",
            rules: {
                //MasterGroups_Code: { required: true,},
                MasterGroups_Name: { required: true,},
                MasterGroups_Grp: { required: true,},
                MasterGroups_BaseGr: { required: true,},
                MasterGroups_Prefix: { required: true,},
            },
            messages: {
                //MasterGroups_Code: { required: 'Code is Required',},
                MasterGroups_Name: { required: 'Name is Required',},
                MasterGroups_Grp: { required: 'Grp is Required',},
                MasterGroups_BaseGr: { required: 'BaseGr is Required',},
                MasterGroups_Prefix: { required: 'Prefix is Required',},
            }
        });

        @* iX9: Input Contraints to limit the inputs to required Input Type i.e. String, Numeric etc. *@
        $("#MasterGroups_Code").constrain({ allow: { regex: "[a-zA-Z0-9()#!%$\/*,.: ]" } });
        $("#MasterGroups_Name").constrain({ allow: { regex: "[a-zA-Z0-9()#!%$\/*,.: ]" } });
        $("#MasterGroups_Grp").constrain({ allow: { regex: "[a-zA-Z0-9()#!%$\/*,.: ]" } });
        $("#MasterGroups_BaseGr").constrain({ allow: { regex: "[a-zA-Z0-9()#!%$\/*,.: ]" } });
        $("#MasterGroups_Seq").constrain({ allow: { regex: "[0-9.-]" } });
        $("#MasterGroups_Prefix").constrain({ allow: { regex: "[a-zA-Z0-9()#!%$\/*,.: ]" } });
        $("#MasterGroups_DisplayOrder").constrain({ allow: { regex: "[0-9.-]" } });

        @* iX9: Input Contraints to limit the inputs to required Input Type i.e. String, Numeric etc. *@
        $('#treeviewcontrol').click(function (event) {
            event.preventDefault();
            $("#ErrorMessage").hide();
            var divId = [];
            $("#treeviewcontrol").jstree("get_selected").each(function (key, value) {
                divId.push(this.id);
            });
            if (divId == '') { return; }
            var url = '@Url.Action("TreeNodeClick")?MasterGroups_RECORDKEY=' + divId.toString();
            $.ajax({
                type: "POST",
                dataType: "json",
                cache: false,
                url: url,
                contentType: "application/json; charset=utf-8",
                beforeSend: function () {
                    $('.spinner').show();
                },
                success: function (data) {
                    $('.spinner').hide();
                    $('#adddiv').html(data.Html);
                },
            });
        });

        @* iX9: Executed when Save/Submit button is Pressed *@
        $('#SubmitData').click(function (event) {
            event.preventDefault();
            //if ($("#AccountGroups").validate().form() == false)
            //    return;

            //if ($("#MasterGroups_Code").val() == null || $("#MasterGroups_Code").val() == '')
            //{
            //    $("#ErrorMessage").show();
            //    $("#ErrorMessage").text('Code is Required..');
            //    return;
            //}
            if ($("#MasterGroups_Name").val() == null || $("#MasterGroups_Name").val() == '')
            {
                $("#ErrorMessage").show();
                $("#ErrorMessage").text('Name is Required..');
                return;
            }
            if ($("#MasterGroups_Grp").val() == null || $("#MasterGroups_Grp").val() == '')
            {
                $("#ErrorMessage").show();
                $("#ErrorMessage").text('Grp is Required..');
                return;
            }
            if ($("#MasterGroups_BaseGr").val() == null || $("#MasterGroups_BaseGr").val() == '')
            {
                $("#ErrorMessage").show();
                $("#ErrorMessage").text('BaseGr is Required..');
                return;
            }
            if ($("#MasterGroups_Prefix").val() == null || $("#MasterGroups_Prefix").val() == '')
            {
                $("#ErrorMessage").show();
                $("#ErrorMessage").text('Prefix for Auto Code is Required..');
                return;
            }
            var url = '@Url.Action("SaveData")';
            @* iX9: Data from individual field is passed on to the Model and then to Controller for Saving *@
            var ModelData = {};
            ModelData["MasterGroups_Code"] = $("#MasterGroups_Code").val();
            ModelData["MasterGroups_Name"] = $("#MasterGroups_Name").val();
            ModelData["MasterGroups_Grp"] = $("#MasterGroups_Grp").val();
            ModelData["MasterGroups_RevGroup"] = $("#MasterGroups_RevGroup").val();
            ModelData["MasterGroups_BaseGr"] = $("#MasterGroups_BaseGr").val();
            ModelData["MasterGroups_Seq"] = $("#MasterGroups_Seq").val();
            ModelData["MasterGroups_Prefix"] = $("#MasterGroups_Prefix").val();
            ModelData["MasterGroups_Hide"] = $("#MasterGroups_Hide").is(':checked');
            ModelData["MasterGroups_DisplayOrder"] = $("#MasterGroups_DisplayOrder").val();
            ModelData["MasterGroups_ForceCC"] = $("#MasterGroups_ForceCC").is(':checked');
            ModelData["MasterGroups_Sch"] = $("#MasterGroups_Sch").val();
            ModelData["MasterGroups_SystemCode"] = $("#MasterGroups_SystemCode").is(':checked');
            ModelData["Mode"] = $("#hdnMode").val();
            var DTO = { mModel: ModelData };
            $.ajax({
                type: "POST",
                dataType: "json",
                data: JSON.stringify(DTO),
                cache: false,
                url: url,
                contentType: "application/json; charset=utf-8",
                beforeSend: function () {
                    $('.spinner').show();
                },
                success: function (data) {
                    if (data.Status == 'Success') {
                        $('.spinner').hide();
                        $("#ErrorMessage").hide();
                        FillTreeView();                    }
                    else {
                        $('.spinner').hide();
                        alert(data.Message);                    }
                },
            });
        });

        $('#addchild').click(function (event) {
            event.preventDefault();
            $("#ErrorMessage").hide();
            var divId = [];
            $("#treeviewcontrol").jstree("get_selected").each(function (key, value) {
                divId.push(this.id);
            });
            var url = '@Url.Action("AddChild")?MasterGroups_GrpKey=' + divId.toString()+'&MasterGroups_Code='+$("#MasterGroups_Code").val();
            $.ajax({
                type: "POST",
                dataType: "json",
                cache: false,
                url: url,
                contentType: "application/json; charset=utf-8",
                beforeSend: function () {
                },
                success: function (data) {
                    $('#adddiv').html(data.Html);
                    if (data.Status == 'Success') {
                        $('.spinner').hide();
                    }
                    else if (data.Status == 'failure') {
                        $('.spinner').hide();
                        alert('No Item is Selected.');
                    }
                    else {
                        $('.spinner').hide();
                        alert(data.Message);                    }
                },
            });
        });

        $('#deletegroup').click(function (event) {
            event.preventDefault();
            $("#ErrorMessage").hide();
            var divId = [];
            $("#treeviewcontrol").jstree("get_selected").each(function (key, value) {
                divId.push(this.id);
            });
            var url = '@Url.Action("DeleteAccountGroups")?MasterGroups_Code=' + $("#MasterGroups_Code").val();
            $.ajax({
                type: "POST",
                dataType: "json",
                cache: false,
                url: url,
                contentType: "application/json; charset=utf-8",
                beforeSend: function () {
                },
                success: function (data) {
                    $('.spinner').hide();
                    $('#adddiv').html(data.Html);
                    if (data.Status == 'Success') {
                        $('.spinner').hide();
                        $("#ErrorMessage").hide();
                        FillTreeView();
                    }
                    else if (data.Status == 'Error') {
                        alert(data.Message);
                    }
                    else {
                        $("#ErrorMessage").show();
                        $("#ErrorMessage").html(data.html);
                    }
                },
            });
        });

        $('#expandall').click(function () {
            $("#treeviewcontrol").jstree("open_all", "#0");
        });
    });


    function FillTreeView() {
        $("#treeviewcontrol").jstree({
            json_data: {
                "ajax": {
                    "url": "/AccountGroups/AccountGroupTreeView",
                    "type": "POST",
                    "dataType": "json",
                    "contentType": "application/json charset=utf-8"
                }
            },
            checkbox: {
                real_checkboxes: false,
                checked_parent_open: false
            },
            plugins: ["themes", "json_data", "ui", ""]
        });
    };
</script>

@* iX9: Form Design *@
<header class="header fixed-top" style="position:fixed;background-color:lightgray;padding:6px;width:100%;margin-top:5px;">
    <div class="fixhead">
        <b class="CodeSt">Account Groups</b>
        <span class="tools pull-right">
            <a href="~/DashBoard/MasterDashBoard" class="btn btn-danger" style="color:white;font-weight:bolder;font-size:13px;padding:3px 10px;" id="Cancel2">X</a>
        </span>
    </div>
</header>

<section class="panel">
    <div class="panel-body">
        <div class="form-horizontal " id="view" role="form" style="margin-top:0px;">
            <div id="ErrorMessage" name="ErrorMessage" class="alert alert-danger" style="display: none"></div>
            <div class="form-group" style="margin-top:0px;">
                <div class="col-sm-3" style="margin-top: 25px;">
                    <div id="treeviewcontrol" style="font-family:Tahoma;font-size:12px;border-right:double; min-height:500px;overflow-y:auto;max-height:500px;padding-left:5px;padding-top:10px;padding-bottom:5px;"></div>
                </div>
                <div id="adddiv">
                    @Html.Partial("AccountGroupsView")
                </div>
            </div>
        </div>
    </div>
</section>

<footer class="footer-section" style="height:33px;position:fixed;background-color:#4B4A4A;padding:3px;color:white;">
    <div class="row">
        <div class="col-sm-5">
            <div class="pull-left">
                <button class="btn btn-success" style="font-size: 13px;padding:3px 12px;" id="addchild">Add Child</button>
                <button class="btn btn-success" style="font-size: 13px;padding:3px 12px;" id="expandall">Expand All</button>
                <button class="btn btn-danger" style="font-size: 13px;padding:3px 12px;" id="deletegroup">Delete Item</button>
            </div>
        </div>
        <div class="col-sm-3" style="margin-top:0px;color:white;font-family:Tahoma;font-size:8pt;">
            T.FAT ERP-iX9, Suchan Software Private Limited<br />(@Session["BranchCode"]) @Session["BranchName"]
        </div>
        @*<div class="col-sm-3" style="margin-top:4px;color:white;font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;">
                T.FAT ERP-iX9, Suchan Software Private Limited
            </div>*@
        <div class="col-sm-4">
            <div class="pull-right">
                @if (Model.Mode != "View")
                {
                    <button class="btn btn-success" style="font-size: 13px;padding:3px 12px;" id="SubmitData">Save</button>
                }
                <a href="~/DashBoard/MasterDashBoard" class="btn btn-danger" style="font-size: 13px;padding:3px 12px;" id="Cancel">Cancel</a>
            </div>
        </div>
    </div>
</footer>
<input type="hidden" id="controllername" />

@*Code Auto Generated on Tue 30-Apr-2019 07:58 PM
    Engine: iX9Generator, ver: 3.7 Revision: 32
    by Team Suchan, T.FAT *@
