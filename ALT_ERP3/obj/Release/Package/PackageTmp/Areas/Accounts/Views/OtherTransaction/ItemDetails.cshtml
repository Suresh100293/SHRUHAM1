@model ALT_ERP3.Areas.Accounts.Models.OtherTransactModel
@using Common
<table id="itemrelatedtable" class="zui-table" style="width:50%;">
    <thead>
    </thead>
    <tbody>
        @if (Model.ItemList != null)
        {
            foreach (var item in @Model.ItemList.ToList())
            {
                if (item.Hide)
                {
                    <tr class="hidden" id="datacharge" style="font-family:Tahoma;font-size:9pt;border: solid 1px lightgray;background-color:@item.BackColor">
                        <td style="width:10%;" hidden="hidden">@item.Fld</td>
                        @if (item.Fld == "F003")
                        {
                            <td style="width:20%;">
                                @item.Head
                                <span style="float:right;">
                                    <button class="btn btn-danger" style="padding:0px 10px;" id="btnNewItem" data-toggle="tooltip" data-placement="top" title="Create New Item."><i class="glyphicon glyphicon-plus"></i></button>
                                    <button class="btn btn-danger" style="padding:0px 10px;" id="btnItemHistory" data-toggle="tooltip" data-placement="top" title="Show Item History Details."><i class="glyphicon glyphicon-list-alt"></i></button>
                                </span>
                            </td>
                        }
                        else
                        {
                            <td style="width:20%;">@item.Head</td>
                        }

                        @if (item.FldType == "C")
                        {
                            <td style="width:40%;">
                                @if (item.Types == "Search")
                                {
                                    <input type="text" id="SearchItem" alt="@item.Fld" value="@item.ApplCode" class="addontxtfvalue " style="width:100%;" />
                                }
                                else
                                {
                                    <select class="addontxtfvalue" id="txtf_@item.Fld" alt="@item.Fld" style="width:100%">
                                        @{
                                            var Text = item.QueryText.Split('^');
                                            var Codes = item.QueryCode.Split('^');
                                            for (int i = 0; i < Text.Length; i++)
                                            {
                                                <option value="@Codes[i]" @(Codes[i] == item.ApplCode ? "selected" : "")>@Text[i]</option>
                                            }
                                        }
                                    </select>
                                }
                            </td>
                        }
                        else if (item.FldType == "M")
                        {
                            <td style="width:50%;"><textarea type="textarea" rows="5" cols="20" id="txtf_@item.Fld" alt="@item.Fld" class="addontxtfvalue" style="width:100%;">@item.ApplCode</textarea></td>
                        }
                        else if (item.FldType == "D")
                        {
                            <td style="width:50%;"><input type="date" id="txtf_@item.Fld" alt="@item.Fld" value="@item.ApplCode" class="addontxtfvalue" style="width:100%;" maxlength="250" /></td>
                        }
                        else if (item.FldType == "N")
                        {
                            <td style="width:50%;"><input type="number" id="txtf_@item.Fld" alt="@item.Fld" value="@item.ApplCode" class="addontxtfvalue" style="width:100%;" maxlength="250" /></td>
                        }
                        else if (item.FldType == "R")
                        {
                            <td style="width:50%;">
                                <div>
                                    @foreach (var item2 in item.QueryText.Split('^').ToList())
                                    {
                                        <div class="col-sm-2 control-label" style="padding-top:0px;">
                                            @item2:  <input @(item2 == item.ApplCode ? "checked=checked" : "") class="addontxtfvalue" name="addontxtfvalue" style="padding-left:0px;width:20px;height:20px;" type="radio" value="@item2">
                                        </div>
                                    }
                                </div>
                            </td>
                        }
                        else
                        {
                            if (@item.Fld == "F014")
                            {
                                <td style="width:50%;"><input type="text" id="HSNCODE" alt="@item.Fld" value="@item.ApplCode" class="addontxtfvalue" style="width:100%;" maxlength="250" /></td>
                            }
                            else
                            {
                                <td style="width:50%;"><input type="text" id="txtf_@item.Fld" alt="@item.Fld" value="@item.ApplCode" class="addontxtfvalue" style="width:100%;" maxlength="250" /></td>
                            }
                        }
                        <td style="width:1%;" hidden="hidden">@item.FldType</td>
                    </tr>
                }
                else
                {
                    <tr id="datacharge" style="font-family:Tahoma;font-size:9pt;border: solid 1px lightgray;background-color:@item.BackColor">
                        <td style="width:10%;" hidden="hidden">@item.Fld</td>
                        @if (item.Fld == "F003")
                        {
                            <td style="width:20%;">
                                @item.Head
                                <span style="float:right;">
                                    <button class="btn btn-danger" style="padding:0px 10px;" id="btnNewItem" data-toggle="tooltip" data-placement="top" title="Create New Item."><i class="glyphicon glyphicon-plus"></i></button>
                                    <button class="btn btn-danger" style="padding:0px 10px;" id="btnItemHistory" data-toggle="tooltip" data-placement="top" title="Show Item History Details."><i class="glyphicon glyphicon-list-alt"></i></button>
                                </span>
                            </td>
                        }
                        else
                        {
                            <td style="width:20%;">@item.Head</td>
                        }
                        @if (item.FldType == "C")
                        {
                            <td style="width:40%;">
                                @if (item.Types == "Search")
                                {
                                    <input type="text" id="SearchItem" alt="@item.Fld" value="@item.ApplCode" class="addontxtfvalue" style="width:100%;" />
                                }
                                else
                                {
                                    <select class="addontxtfvalue" id="txtf_@item.Fld" alt="@item.Fld" style="width:100%">
                                        @{
                                            var Text = item.QueryText.Split('^');
                                            var Codes = item.QueryCode.Split('^');
                                            for (int i = 0; i < Text.Length; i++)
                                            {
                                                <option value="@Codes[i]" @(Codes[i] == item.ApplCode ? "selected" : "")>@Text[i]</option>
                                            }
                                        }
                                    </select>
                                }
                            </td>
                        }
                        else if (item.FldType == "M")
                        {
                            <td style="width:50%;"><textarea type="textarea" rows="5" cols="20" id="txtf_@item.Fld" alt="@item.Fld" class="addontxtfvalue" style="width:100%;">@item.ApplCode</textarea></td>
                        }
                        else if (item.FldType == "D")
                        {
                            <td style="width:50%;"><input type="date" id="txtf_@item.Fld" alt="@item.Fld" value="@item.ApplCode" class="addontxtfvalue" style="width:100%;" maxlength="250" /></td>
                        }
                        else if (item.FldType == "N")
                        {
                            <td style="width:50%;"><input type="number" id="txtf_@item.Fld" alt="@item.Fld" value="@item.ApplCode" class="addontxtfvalue" style="width:100%;" maxlength="250" /></td>
                        }
                        else if (item.FldType == "R")
                        {
                            <td style="width:50%;">
                                <div>
                                    @foreach (var item2 in item.QueryText.Split('^').ToList())
                                    {
                                        <div class="col-sm-2 control-label" style="padding-top:0px;">
                                            @item2:  <input @(item2 == item.ApplCode ? "checked=checked" : "") class="addontxtfvalue" name="addontxtfvalue" style="padding-left:0px;width:20px;height:20px;" type="radio" value="@item2">
                                        </div>
                                    }
                                </div>
                            </td>
                        }
                        else
                        {
                            if (@item.Fld == "F014")
                            {
                                <td style="width:50%;"><input type="text" id="HSNCODE" alt="@item.Fld" value="@item.ApplCode" class="addontxtfvalue" style="width:100%;" maxlength="250" /></td>
                            }
                            else
                            {
                                <td style="width:50%;"><input type="text" id="txtf_@item.Fld" alt="@item.Fld" value="@item.ApplCode" class="addontxtfvalue" style="width:100%;" maxlength="250" /></td>
                            }
                        }
                        <td style="width:1%;" hidden="hidden">@item.FldType</td>
                    </tr>
                }
            }
        }
    </tbody>
</table>
<script>
    $(document).ready(function () {
        loadHSN();
        loadItemSearch();
        $('#modalItemHistory').modal({
            backdrop: 'static',
            keyboard: false
        })
        $("#modalItemHistory").modal("hide");

        if ('@Model.HSNCODEName'!="") {
            $('#HSNCODE').select2('data', { id: '@Model.HSNCODE', text: '@Model.HSNCODEName' });
        }
        if ('@Model.ItemName' != "") {
            $('#SearchItem').select2('data', { id: '@Model.Item', text: '@Model.ItemName' });
        }

        $("#btnNewItem").click(function (e) {
            e.preventDefault();
            var murl = "/Vehicles/ItemMaster/Index?TableName=ItemMaster&MainType=&Mode=Add&Header=Item%20Master&ViewDataId=ItemMaster&Controller2=ItemMaster&Module=Master&optiontype=M&optioncode=ItemMaster&ShortCutKey=true";
            window.open(murl, '_blank');
        });

        $("#btnItemHistory").click(function (e) {
            e.preventDefault();
            GridReloadItemHistory();
            $("#modalItemHistory").modal("show");
        });

        $("#itemrelatedtable tbody").on('focusout', '.addontxtfvalue', function () {
            debugger;
            var currentRow = $(this).closest("tr");
            var tds = currentRow.find('td').eq(0).text();
            //Rate or Qty Blus Functions
            if (tds == "F004" || tds == "F005") {
                var Qty = 0, cost = 0;
                $('#itemrelatedtable tbody tr').each(function () {
                    var tds = $(this).find('td');
                    if (tds.eq(0).text() == "F005") {
                        var CurrQTY = parseFloat(tds.find(".addontxtfvalue").val());
                        if (CurrQTY == 0) {
                            Qty = 1;
                        } else {
                            Qty = CurrQTY;
                        }
                    }
                    if (tds.eq(0).text() == "F004") {
                        var Amount = parseFloat(tds.find(".addontxtfvalue").val());
                        cost = Amount;
                    }
                });
                $('#itemrelatedtable tbody tr').each(function () {
                    var tds = $(this).find('td');
                    if (tds.eq(0).text() == "F006") {
                        tds.find(".addontxtfvalue").val((Qty * cost).toFixed(2));
                    }
                });
                AutoCalculateTaxableAmt();
            }
            //Current KM Change
            if (tds == "F008" || tds == "F007") {
                var WarrantyKM = 0, CurrentKM = 0;
                $('#itemrelatedtable tbody tr').each(function () {
                    var tds = $(this).find('td');
                    if (tds.eq(0).text() == "F007") {
                        var Amount = parseInt(tds.find(".addontxtfvalue").val());
                        WarrantyKM = Amount;
                    }
                    if (tds.eq(0).text() == "F008") {
                        var Amount = parseFloat(tds.find(".addontxtfvalue").val());
                        CurrentKM = Amount;
                    }
                });
                $('#itemrelatedtable tbody tr').each(function () {
                    var tds = $(this).find('td');
                    if (tds.eq(0).text() == "F009") {
                        var laterkm = parseFloat(CurrentKM) + parseFloat(WarrantyKM)
                        tds.find(".addontxtfvalue").val(laterkm);
                    }
                });
            }
            //Expiry Days Change
            if (tds == "F010") {
                var ModelData = {};
                var mCode = "";
                var mexpdate = "";
                var mmDays = "";
                var mmKm = "";
                var CheckMasterOrNot = "";
                $("#itemrelatedtable tbody tr").each(function () {
                    var sectds = $(this).find('td');
                    if (sectds.eq(0).text() == "F003") {
                        mCode = sectds.find(".addontxtfvalue").val();
                    }
                    if (sectds.eq(0).text() == "F002") {
                        CheckMasterOrNot = sectds.find(".addontxtfvalue").val();
                    }
                    if (sectds.eq(0).text() == "F012") {
                        mexpdate = sectds.find(".addontxtfvalue").val();
                    }
                    if (sectds.eq(0).text() == "F010") {
                        mmDays = parseInt(sectds.find(".addontxtfvalue").val());
                    }
                    if (sectds.eq(0).text() == "F007") {
                        mmKm = parseInt(sectds.find(".addontxtfvalue").val());
                    }
                });
                ModelData["BankCashCode"] = $('#BankCashCode').val();
                ModelData["DocuDate"] = $('#DocuDate').val();
                ModelData["Code"] = $('#txtAccount').val();
                ModelData["Type"] = mCode;
                ModelData["FromDate"] = mexpdate;
                if (CheckMasterOrNot !="Direct") {
                    var DTO = { Model: ModelData, KM: mmKm, Days: mmDays };
                    var url = '@Url.Action("GetItemPartDetail")';
                    $.ajax({
                    type: "POST",
                    dataType: "json",
                    data: JSON.stringify(DTO),
                    cache: false,
                    url: url,
                    contentType: "application/json;charset=utf-8",
                    beforeSend: function () {
                        $('.spinner').show();
                    },
                    success: function (data) {
                        $('.spinner').hide();
                        var c = new Date();
                        $('#itemrelatedtable tbody tr').each(function () {
                            var tds = $(this).find('td');
                            if (tds.eq(0).text() == "F004") {
                                if (tds.find(".addontxtfvalue").val() == "0" || tds.find(".addontxtfvalue").val()=="") {
                                    tds.find(".addontxtfvalue").val(data.Cost);
                                }
                            }
                            if (tds.eq(0).text() == "F006") {
                                if (tds.find(".addontxtfvalue").val() == "0" || tds.find(".addontxtfvalue").val() == "") {
                                    tds.find(".addontxtfvalue").val(data.Cost);
                                }
                            }
                            else if (tds.eq(0).text() == "F007") {

                                if (tds.find(".addontxtfvalue").val() == "0" || tds.find(".addontxtfvalue").val() == "") {
                                    tds.find(".addontxtfvalue").val(data.KM);
                                }
                            }
                            else if (tds.eq(0).text() == "F010") {
                                if (tds.find(".addontxtfvalue").val() == "0" || tds.find(".addontxtfvalue").val() == "") {
                                    tds.find(".addontxtfvalue").val(data.Days);
                                }
                            }
                            else if (tds.eq(0).text() == "F013") {
                                //if (parseInt(data.Days) > 0) {
                                    tds.find(".addontxtfvalue").val(data.ExpDays);
                                //}
                            }
                            else if (tds.eq(0).text() == "F015") {
                                if (tds.find(".addontxtfvalue").val() == "") {
                                    tds.find(".addontxtfvalue").val(data.Descr);
                                }
                            }
                        });
                        if (data.Account != "") {
                            $('#txtAccount').select2('data', { id: data.Account, text: data.AccountName });
                        }
                        if (data.HSNCODENAme != "") {
                            $('#HSNCODE').select2('data', { id: data.HSNCODE, text: data.HSNCODENAme });
                        }
                        if (data.GSTNAME != "")
                        {
                            $('#addGSTCode').select2('data', { id: data.GSTCODE, text: data.GSTNAME });
                            $('#addIGSTRate').val(data.IGSTRATE);
                            $('#addCGSTRate').val(data.CGSTRATE);
                            $('#addSGSTRate').val(data.SGSTRATE);
                        }
                        },
                        error: function () {
                        alert("Error occured while processing your request.");
                        }
                    });
                }
            }
        });
        $("#SearchItem").change(function () {
            debugger;
            var ModelData = {};
            var mCode = $(this).val();
            var mexpdate = "";
            var mmDays = "";
            var mmKm = "";
            var CheckMasterOrNot = "";

            $("#itemrelatedtable tbody tr").each(function () {
                var sectds = $(this).find('td');
                //if (sectds.eq(0).text() == "F003") {
                //    mCode = sectds.find(".addontxtfvalue").val();
                //}

                if (sectds.eq(0).text() == "F002") {
                    CheckMasterOrNot = sectds.find(".addontxtfvalue").val();
                }
                if (sectds.eq(0).text() == "F012") {
                    mexpdate = sectds.find(".addontxtfvalue").val();
                }
                if (sectds.eq(0).text() == "F010") {
                    mmDays = parseInt(sectds.find(".addontxtfvalue").val());
                }
                if (sectds.eq(0).text() == "F007") {
                    mmKm = parseInt(sectds.find(".addontxtfvalue").val());
                }
            });
            ModelData["BankCashCode"] = $('#BankCashCode').val();
            ModelData["DocuDate"] = $('#DocuDate').val();
            ModelData["Code"] = $('#txtAccount').val();
            ModelData["Type"] = mCode;
            ModelData["FromDate"] = mexpdate;
            if (CheckMasterOrNot !="Direct") {
                var DTO = { Model: ModelData, KM: mmKm, Days: mmDays };
                var url = '@Url.Action("GetItemPartDetail")';
                $.ajax({
                type: "POST",
                dataType: "json",
                data: JSON.stringify(DTO),
                cache: false,
                url: url,
                contentType: "application/json;charset=utf-8",
                beforeSend: function () {
                    $('.spinner').show();
                },
                success: function (data) {
                    $('.spinner').hide();
                    var c = new Date();
                    $('#itemrelatedtable tbody tr').each(function () {
                        var tds = $(this).find('td');
                        if (tds.eq(0).text() == "F004") {
                            if (tds.find(".addontxtfvalue").val() == "0" || tds.find(".addontxtfvalue").val() == "") {
                                tds.find(".addontxtfvalue").val(data.Cost);
                            }
                        }
                        if (tds.eq(0).text() == "F006") {
                            if (tds.find(".addontxtfvalue").val() == "0" || tds.find(".addontxtfvalue").val() == "") {
                                tds.find(".addontxtfvalue").val(data.Cost);
                            }
                        }
                        else if (tds.eq(0).text() == "F007") {

                            if (tds.find(".addontxtfvalue").val() == "0" || tds.find(".addontxtfvalue").val() == "") {
                                tds.find(".addontxtfvalue").val(data.KM);
                            }
                        }
                        else if (tds.eq(0).text() == "F010") {
                            if (tds.find(".addontxtfvalue").val() == "0" || tds.find(".addontxtfvalue").val() == "") {
                                tds.find(".addontxtfvalue").val(data.Days);
                            }
                        }
                        else if (tds.eq(0).text() == "F013") {
                            if (parseInt(data.Days) > 0) {
                                tds.find(".addontxtfvalue").val(data.ExpDays);
                            }
                        }
                        else if (tds.eq(0).text() == "F015") {
                            if (tds.find(".addontxtfvalue").val() == "") {
                                tds.find(".addontxtfvalue").val(data.Descr);
                            }
                        }
                    });
                    if (data.Account != "") {
                        $('#txtAccount').select2('data', { id: data.Account, text: data.AccountName });
                        $('#txtAccount').trigger('change');
                        $('#txtAccount').select2('data', { id: data.Account, text: data.AccountName });
                    }
                    if (data.HSNCODENAme != "") {
                        $('#HSNCODE').select2('data', { id: data.HSNCODE, text: data.HSNCODENAme });
                    }
                    if (data.GSTNAME != "")
                    {
                        $('#addGSTCode').select2('data', { id: data.GSTCODE, text: data.GSTNAME });
                        $('#addIGSTRate').val(data.IGSTRATE);
                        $('#addCGSTRate').val(data.CGSTRATE);
                        $('#addSGSTRate').val(data.SGSTRATE);
                    }
                    },
                    error: function () {
                    alert("Error occured while processing your request.");
                    }
                });
            }
        });

        $("#itemrelatedtable tbody").on('change', '.addontxtfvalue', function () {
            var currentRow = $(this).closest("tr");
            var tds = currentRow.find('td').eq(0).text();
            if (tds == "F001" || tds == "F002") {
                var ModelData = {};
                ModelData["DocuDate"] = $("#DocuDate").val();
                var mFromType = "", mProductGroupType="";
                $("#itemrelatedtable tbody tr").each(function () {
                    var sectds = $(this).find('td');
                    if (sectds.eq(0).text() == "F001") {
                        mProductGroupType = sectds.find(".addontxtfvalue").val();
                    }
                    if (sectds.eq(0).text() == "F002") {
                        mFromType = sectds.find(".addontxtfvalue").val();
                    }
                });
                if (mProductGroupType == "Select1") {
                    ModelData["FromType"] = "Direct";
                } else {
                    ModelData["FromType"] = mFromType;
                }
                ModelData["ProductGroupType"] = mProductGroupType;
                //ModelData["FromType"] = mFromType;
                var DTO = { Model: ModelData };
                var url = '@Url.Action("GetItemSingleViewList")';
                $.ajax({
                    type: "POST",
                    dataType: "json",
                    data: JSON.stringify(DTO),
                    cache: false,
                    url: url,
                    contentType: "application/json;charset=utf-8",
                    beforeSend: function () {
                        $('.spinner').show();
                    },
                    success: function (data) {
                        $('#ItemRelatedDialog').html('');
                        $('#ItemRelatedDialog').html(data.Html);
                        $('.spinner').hide();
                    },
                    error: function () {
                        $('.spinner').hide();
                        alert("error occured while processing your request.");
                    }
                });
            }
            else if (tds == "F003!") {
                var ModelData = {};
                var mCode = "";
                var mexpdate = "";
                var mmDays = "";
                var mmKm = "";
                var CheckMasterOrNot = "";

                $("#itemrelatedtable tbody tr").each(function () {
                    debugger;
                    var sectds = $(this).find('td');
                    if (sectds.eq(0).text() == "F003") {
                        mCode = sectds.find(".addontxtfvalue").val();
                    }
                    if (sectds.eq(0).text() == "F002") {
                        CheckMasterOrNot = sectds.find(".addontxtfvalue").val();
                    }
                    if (sectds.eq(0).text() == "F012") {
                        mexpdate = sectds.find(".addontxtfvalue").val();
                    }
                    if (sectds.eq(0).text() == "F010") {
                        mmDays = parseInt(sectds.find(".addontxtfvalue").val());
                    }
                    if (sectds.eq(0).text() == "F007") {
                        mmKm = parseInt(sectds.find(".addontxtfvalue").val());
                    }
                });
                ModelData["BankCashCode"] = $('#BankCashCode').val();
                ModelData["DocuDate"] = $('#DocuDate').val();
                ModelData["Code"] = $('#txtAccount').val();
                ModelData["Type"] = mCode;
                ModelData["FromDate"] = mexpdate;
                if (CheckMasterOrNot !="Direct") {
                    var DTO = { Model: ModelData, KM: mmKm, Days: mmDays };
                    var url = '@Url.Action("GetItemPartDetail")';
                    $.ajax({
                    type: "POST",
                    dataType: "json",
                    data: JSON.stringify(DTO),
                    cache: false,
                    url: url,
                    contentType: "application/json;charset=utf-8",
                    beforeSend: function () {
                        $('.spinner').show();
                    },
                    success: function (data) {
                        $('.spinner').hide();
                        var c = new Date();
                        $('#itemrelatedtable tbody tr').each(function () {
                            var tds = $(this).find('td');
                            if (tds.eq(0).text() == "F004") {
                                if (tds.find(".addontxtfvalue").val() == "0" || tds.find(".addontxtfvalue").val() == "") {
                                    tds.find(".addontxtfvalue").val(data.Cost);
                                }
                            }
                            if (tds.eq(0).text() == "F006") {
                                if (tds.find(".addontxtfvalue").val() == "0" || tds.find(".addontxtfvalue").val() == "") {
                                    tds.find(".addontxtfvalue").val(data.Cost);
                                }
                            }
                            else if (tds.eq(0).text() == "F007") {

                                if (tds.find(".addontxtfvalue").val() == "0" || tds.find(".addontxtfvalue").val() == "") {
                                    tds.find(".addontxtfvalue").val(data.KM);
                                }
                            }
                            else if (tds.eq(0).text() == "F010") {
                                if (tds.find(".addontxtfvalue").val() == "0" || tds.find(".addontxtfvalue").val() == "") {
                                    tds.find(".addontxtfvalue").val(data.Days);
                                }
                            }
                            else if (tds.eq(0).text() == "F013") {
                                if (parseInt(data.Days) > 0) {
                                    tds.find(".addontxtfvalue").val(data.ExpDays);
                                }
                            }
                            else if (tds.eq(0).text() == "F015") {
                                if (tds.find(".addontxtfvalue").val() == "") {
                                    tds.find(".addontxtfvalue").val(data.Descr);
                                }
                            }
                        });
                        if (data.Account != "") {
                            $('#txtAccount').select2('data', { id: data.Account, text: data.AccountName });
                            $('#txtAccount').trigger('change');
                            $('#txtAccount').select2('data', { id: data.Account, text: data.AccountName });
                        }
                        if (data.HSNCODENAme != "") {
                            $('#HSNCODE').select2('data', { id: data.HSNCODE, text: data.HSNCODENAme });
                        }
                        if (data.GSTNAME != "")
                        {
                            $('#addGSTCode').select2('data', { id: data.GSTCODE, text: data.GSTNAME });
                            $('#addIGSTRate').val(data.IGSTRATE);
                            $('#addCGSTRate').val(data.CGSTRATE);
                            $('#addSGSTRate').val(data.SGSTRATE);
                        }
                        },
                        error: function () {
                        alert("Error occured while processing your request.");
                        }
                    });
                }
            }
        });
    });
    function loadHSN() {
        var url = '@Url.Action("GetHSNList")';
        $('#HSNCODE').select2({
            minimumInputLength: 0,
            placeholder: 'Search',
            ajax: {
                url: url,
                dataType: 'json',
                quietMillis: 100,
                enableFiltering: true,
                allowClear: true,
                minimumInputLength: 0,
                multiple: true,
                width: 300,
                data: function (term, page) {
                    return {
                        types: ["exercise"],
                        limit: -1,
                        term: term
                    };
                },
                results: function (data, page) {
                    clientObj = JSON.stringify(data);
                    return {
                        results: $.map(data, function (item) {
                            return {
                                text: item.Name,
                                id: item.Code
                            }
                        })
                    };
                }
            },
            initSelection: function (element, callback) {
                var data = { id: '@Model.HSNCODE', text: '@Model.HSNCODEName' };
                callback(data);
            },
            formatResult: function (exercise) {
                return "<div class='row-fluid'><div class=''><span class='span1'><div style='color:" + exercise.alias + "'>" + exercise.text +
                    "</div></span></div></div>";
            },
            formatSelection: function (exercise) {
                return "<div class='row-fluid'><div class=''><span class='span1'><div style='color:" + exercise.alias + "'>" + exercise.text +
                    "</div></span></div></div>";
            },
        });
    }
    function loadItemSearch() {
        var mProductGroupType = "";
        $("#itemrelatedtable tbody tr").each(function () {
            var sectds = $(this).find('td');
            if (sectds.eq(0).text() == "F001") {
                mProductGroupType = sectds.find(".addontxtfvalue").val();
                return false;
            }
        });

        var url = '@Url.Action("GetItemMasters")';
            $('#SearchItem').select2({
            minimumInputLength: 0,
            placeholder: 'Search',
            ajax: {
                url: url,
                dataType: 'json',
                quietMillis: 100,
                enableFiltering: true,
                allowClear: true,
                minimumInputLength: 0,
                multiple: true,
                width: 300,
                data: function (term, page) {
                    return {
                        types: ["exercise"],
                        limit: -1,
                        term: term,
                        ItemGroup: mProductGroupType
                    };
                },
                results: function (data, page) {
                    clientObj = JSON.stringify(data);
                    return {
                        results: $.map(data, function (item) {
                            return {
                                text: item.Name,
                                id: item.Code
                            }
                        })
                    };
                }
            },
            initSelection: function (element, callback) {
                var data = { id: '@Model.Item', text: '@Model.ItemName' };
                callback(data);
            },
            formatResult: function (exercise) {
                return "<div class='row-fluid'><div class=''><span class='span1'><div style='color:" + exercise.alias + "'>" + exercise.text +
                    "</div></span></div></div>";
            },
            formatSelection: function (exercise) {
                return "<div class='row-fluid'><div class=''><span class='span1'><div style='color:" + exercise.alias + "'>" + exercise.text +
                    "</div></span></div></div>";
            },
        });
    };
</script>
<div class="modal fade" id="modalItemHistory" style="overflow:scroll;height:fit-content;" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true" @*style="margin-top: 60px;"*@>
    <div class="modal-dialog modal-lg modal-sm modal-xl" role="document" style="width: 100%;margin: auto;margin-top: 5%;">
        <div class="modal-content">
            <div class="modal-header" style="background-color:#cccccc;padding-top:5px;">
                <button type="button" class="close" onclick="ClosemodalItem();" aria-hidden="true">&times;</button>
                <h4 class="modal-title"><b>Item Transaction Details</b></h4>
            </div>
            <div class="modal-body" style="height:435px;">
                <div style="height:430px;overflow: auto;">
                    <div class="jqGrid" style="padding-left:0px;padding-right:0px;width:100%;overflow:scroll;">
                        <table id="list3" class="scroll" cellpadding="0" cellspacing="0" style="border-collapse:unset;margin-top:0px;"></table>
                        <div id="pager3" style="height:32px;width:100%;"></div>
                    </div>
                </div>
                <script>
                    function ClosemodalItem() {
                        $("#modalItemHistory").modal("hide");
                    }
                    function GridReloadItemHistory() {
                        $('#list3').jqGrid('clearGridData');
                        $("#list3").jqGrid("GridUnload");
                        $('#list3').trigger('reloadGrid');

                        var ColName, Coldata;
                        var lPath = window.location.pathname;
                        var arrPath = lPath.split("/");
                        var code = $("#btncode").val();
                        var sPathUrl = '@Url.Action("GetGridStructureRecords")?id=ItemTransactionHistory';
                        var sUrlpath = '@Url.Action("GetGridData")?ViewDataId=ItemTransactionHistory&Code=' + $('#SearchItem').val();
                        $.ajax({
                            url: sPathUrl,
                            type: "POST",
                            contentType: "application/json; charset=utf-8",
                            dataType: "json",
                            beforeSend: function () {
                                $('.spinner').show();
                            },
                            success: function (data) {
                                var obj = $.parseJSON(data);
                                ColName = obj[0].split(",");
                                Coldata = obj[1];
                                CreateGridData();
                                $('.spinner').hide();
                            },
                            error: function () {
                                alert("Error with AJAX callback");
                            }
                        });

                        function CreateGridData() {
                            $('#list3').jqGrid({
                                url: sUrlpath,
                                datatype: 'json',
                                mtype: 'POST',
                                sortable: true,
                                colNames: ColName,
                                colModel: Coldata,
                                pager: $('#pager3'),
                                rowNum: @Session["GridRows"],
                                rowList: [10, 15, 20, 50, 100, 500, 1000, 5000, 10000],
                                height:330,
                                sortname: '',
                                frozen: false,
                                sortorder: 'asc',
                                gridview: true,
                                viewrecords: true,
                                //scroll: false,
                                autowidth: false,
                                shrinkToFit: false,
                                search: true,
                                scrollrows: true,
                                onSelectRow: function (id, status, e) {
                                    $('.spinner').hide();
                                },
                                ondblClickRow: function (id) {
                                    //event.preventDefault();
                                    var myGrid = $('#list3');
                                    var cellVal = myGrid.jqGrid('getCell', id, 'Authenticate');
                                },
                                beforeRequest: function () {
                                    responsive_jqgridData($(".jqGrid"));
                                },
                                gridComplete: function () {
                                    $('.spinner').hide();
                                },
                            });
                            jQuery("#list3").jqGrid('navGrid', "#pager3",
                            { edit: false, add: false, del: false, print:false, search: true, refresh: false, searchtext: "filter" });
                            jQuery("#list3").jqGrid("setFrozenColumns");
                        };

                        function responsive_jqgridData(jqgrid) {
                            jqgrid.find('.ui-jqgrid').addClass('clear-margin span12').css('width', '');
                            //jqgrid.find('.ui-jqgrid').addClass('ui-widget-content jqgrow ui-row-ltr ui-state-highlight').css('background', 'skyblue');
                            jqgrid.find('.ui-jqgrid-view').addClass('clear-margin span12').css('width', '');
                            jqgrid.find('.ui-jqgrid-view > div').eq(1).addClass('clear-margin span12').css('width', '').css('min-height', '0').css('display', 'grid');
                            jqgrid.find('.ui-jqgrid-view > div').eq(2).addClass('clear-margin span12').css('width', '').css('min-height', '0').css('display', 'grid');
                            jqgrid.find('.ui-jqgrid-sdiv').addClass('clear-margin span12').css('width', '');
                            jqgrid.find('.ui-jqgrid-pager').addClass('clear-margin span12').css('width', '');
                            jqgrid.find('#pager_right').css('width', '180px');
                            jqgrid.find('.ui-state-default,.ui-widget-content .ui-state-default,.ui-widget-header .ui-state-default').css('background', '#e7e4e4');
                            jqgrid.find('.ui-widget-content .ui-state-focus, .ui-widget-header .ui-state-focus .ui-state-hover').css('background', 'skyblue');
                            //$('#GetLRLIst').modal('show');
                        };
                    }
                </script>
            </div>
            <div class="modal-footer">
                <button type="button" style="float:right" class="btn btn-danger" onclick="ClosemodalItem();">Close</button>
            </div>
        </div>
    </div>
</div>