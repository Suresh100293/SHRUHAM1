@model ALT_ERP3.Areas.Accounts.Models.CreditPurchaseVM
@using Common
@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_LayoutMenu.cshtml";
}
<link href="~/Content/ToogleCreate/CreateTgl.css" rel="stylesheet" />
<script src="~/Content/ToogleCreate/CreateTgl.js"></script>

@*<script src="@Url.Content("~/Content/js/jquery.validate.min.js")" type="text/javascript"></script>*@
<script src="@Url.Content("~/Content/js/jquery.constrain.js")" type="text/javascript"></script>
<script>
    var PrintLR = "";
    function PurchaseBillAlertNoteMaster(value) {
        var url = '/Logistics/AlertNote/ShoWAlertNoteList';
        var myTableArray = [];
        myTableArray.push(value);

        var DTO = { Type: "PUR00", TypeCode: myTableArray, DocTpe: "PUR00" };
        $.ajax({
            type: "POST",
            dataType: "json",
            data: JSON.stringify(DTO),
            cache: false,
            url: url,
            contentType: "application/json; charset=utf-8",
            beforeSend: function () {
                $('.spinner').show();
            },
            success: function (data) {
                debugger;
                $('.spinner').hide();
                if (data.Status == "Success") {
                    var AttachDoc = $("#OnlyAlertNoteDiv");
                    AttachDoc.html('');
                    AttachDoc.html(data.Html);
                    $('#AlertNoteModal').modal('show');
                }
            },
        });
    }
    $(document).ready(function () {
        GetMyFavorites('@Model.ViewDataId');
        $('#attachdoc,#AlertNoteModal,#addnotemodel').modal({
            backdrop: 'static',
            keyboard: false
        })
        $("#attachdoc,#AlertNoteModal,#addnotemodel").modal("hide");

        document.getElementById("headerdiv").style.backgroundColor = '@Session["headerdivcolor"]';
        document.getElementById("headercaption").style.color = '@Session["headercaptioncolor"]';
        document.getElementById("fixedbottom").style.backgroundColor = '@Session["bottomcolor"]';
        $("#Srl").constrain({ allow: { regex: "[0-9]" } });
        var mstartdate = $('#hdnStartDate').val();
        var menddate = $('#hdnEndDate').val();
        if ('@Model.Mode' != "Add") {
            if ('@Model.Mode' != "Delete") {
                PurchaseBillAlertNoteMaster('@Model.ParentKey');
            }
            $('#FBothCHK').prop("disabled", true);
            $('#txttottxable').val(parseFloat(@Model.Taxable).toFixed(2));
            $('#txttotcgst').val(parseFloat(@Model.CGSTAmt).toFixed(2));
            $('#txttotsgst').val(parseFloat(@Model.SGSTAmt).toFixed(2));
            $('#txttotigst').val(parseFloat(@Model.IGSTAmt).toFixed(2));
            $('#txtinvamt').val(parseFloat(@Model.InvoiceAmt).toFixed(2));
            $('#TDSAmt').val(parseFloat(@Model.TDSAmt).toFixed(2));
        } else {
            $('#txttottxable').val(parseFloat("0").toFixed(2));
            $('#txttotcgst').val(parseFloat("0").toFixed(2));
            $('#txttotsgst').val(parseFloat("0").toFixed(2));
            $('#txttotigst').val(parseFloat("0").toFixed(2));
            $('#txtinvamt').val(parseFloat("0").toFixed(2));
            $('#TDSAmt').val(parseFloat("0").toFixed(2));
        }
        //$("#DocuDate").focus();

        

        $('#DocuDate,#BillDate').datepicker({
            format: "dd-mm-yyyy",
            autoclose: true,
            startDate: new Date(mstartdate),
            endDate: new Date(menddate)
        });
        $("#FBothCHK").change(function () {
            if (this.checked) {
                $("#Srl").removeAttr("disabled");
                $("#hdnOTGenerate").val('M');
            }
            else {

                $("#Srl").attr("disabled", "disabled");
                $("#hdnOTGenerate").val('A');
            }
        });
        $("#btnAddDoc").click(function (event) {
            event.preventDefault();

            var url = '/Logistics/Attachment/UploadFile';
            var ModelData = {};
            ModelData["Mode"] = "@Model.Mode";
            ModelData["Srl"] = $("#hdnParentKey").val();
            ModelData["Type"] = "PUR00";
            ModelData["RefType"] = "@Model.Header";

            var DTO = { Model: ModelData };
            $.ajax({
                type: "POST",
                dataType: "json",
                data: JSON.stringify(DTO),
                cache: false,
                url: url,
                contentType: "application/json; charset=utf-8",
                beforeSend: function () {
                    $('.spinner').show();
                },
                success: function (data) {
                    $('.spinner').hide();
                    var AttachDoc = $("#AttachDoc");
                    AttachDoc.html('');
                    AttachDoc.html(data.Html);
                    $('#attachdoc').modal('show');
                },
            });
        });
        $("#addTDSFlag").change(function () {
            TDSCalculation();
        });
        $("#TDSAmt").blur(function () {
            $("#addTDSAmt").val(this.value);
        });
        $("#addTDSAmt").blur(function () {
            $("#TDSAmt").val(this.value);
        });

        var CGL = $('#hdnMode').val();
        if (($('#hdnOTGenerate').val() == "A") && CGL == "Add") {
            $('#Srl').prop('disabled', true);
        }
        if ('@Model.Mode' == 'View' || '@Model.Mode' == 'Delete') {
            $('#frmaddnewbank :input').prop("disabled", true);
            $('#divLedgerTable :input').prop("disabled", true);
            $('#divLedgerTable1 :input').prop("disabled", true);
            $('#fixedbottom :input').prop("disabled", true);
            $('#DeleteData').prop("disabled", false);
        }
        if ('@Model.PeriodLock' == "True" ||'@Model.PeriodLock' == "true") {
            var Message = $("#ErrorMessage").text() + "<br>This Document Lock By Period Lock Mechanism....!";
            $("#ErrorMessage").show();
            $("#ErrorMessage").html(Message);
            $('#frmaddnewbank :input').prop("disabled", true);
            $('#divLedgerTable :input').prop("disabled", true);
            $('#divLedgerTable1 :input').prop("disabled", true);
            $('#fixedbottom :input').prop("disabled", true);
            $('.btn').prop("disabled", true);
        }
        debugger;
        if ('@Model.CheckMode' == "True" || '@Model.CheckMode' == "true") {
            var Message = $("#ErrorMessage").text() + "<br>@Model.Message";
            $("#ErrorMessage").show();
            $("#ErrorMessage").html(Message);
            $('#frmaddnewbank :input').prop("disabled", true);
            $('#divLedgerTable :input').prop("disabled", true);
            $('#divLedgerTable1 :input').prop("disabled", true);
            $('#fixedbottom :input').prop("disabled", true);
            $('.btn').prop("disabled", true);
        }
        if ('@Model.Mode' == "Edit" || '@Model.Mode' == "Delete")
        {
            if ('@Model.LockAuthorise' == "True" || '@Model.LockAuthorise' == "true")
            {
                var Message = $("#ErrorMessage").text() + "<br>Document Lock In @Model.Mode Mode As Per The Authentication Rule...";
                $("#ErrorMessage").show();
                $("#ErrorMessage").html(Message);
                $('#frmaddnewbank :input').prop("disabled", true);
                $('#divLedgerTable :input').prop("disabled", true);
                $('#divLedgerTable1 :input').prop("disabled", true);
                $('#fixedbottom :input').prop("disabled", true);
                $('.btn').prop("disabled", true);
            }
            if ('@Model.LockAdjustTrip' == "True") {
                var Message1 = $("#ErrorMessage").text();
                Message1 +="<br>@Model.LockAdjustTripMessage";
                $("#ErrorMessage").show();
                $("#ErrorMessage").html(Message1);
                $('#frmaddnewbank :input').prop("disabled", true);
                $('#divLedgerTable :input').prop("disabled", true);
                $('#divLedgerTable1 :input').prop("disabled", true);
                $('#fixedbottom :input').prop("disabled", true);
                $('.btn').prop("disabled", true);
            }
        }
        $('#btnPrintOnly,#btnAddDoc,#btnAddNote').prop("disabled", false);
        $('#changeperiod :input').prop("disabled", false);
        $('#changebranch :input').prop("disabled", false);
        $('.tablinks').prop("disabled", false);
        $('#addnotemodel :input').prop("disabled", false);
        $('#attachdoc :input').prop("disabled", false);
        $('#printpostmodel :input').prop("disabled", false);

        loadCashBank();
        $('#BankCashCode').change(function () {
            event.preventDefault();
            var url = '@Url.Action("GetAccountDetails")';
            var ModelData = {};

            ModelData["DocuDate"] = $("#DocuDate").val();
            ModelData["BankCashCode"] = $("#BankCashCode").val();

            var DTO = { Model: ModelData };
            $.ajax({
                type: "POST",
                dataType: "json",
                data: JSON.stringify(DTO),
                cache: false,
                url: url,
                contentType: "application/json;charset=utf-8",
                beforeSend: function () {
                    $('.spinner').show();
                },
                success: function (data) {
                    $('.spinner').hide();
                    if (data.CutTDS == true) {
                        $("#addTDSFlag").prop("checked", true);
                    }
                    else {
                        $("#addTDSFlag").prop("checked", false);
                        //$('#addTDSCode').val(null).trigger("change");
                        //$('#addTDSRate').val("0");
                    }
                    if (data.TDSCode == "0") {
                        $('#addTDSCode').select2('data', { id: '', text: '' });
                        $('#addTDSRate').val("0");

                    }
                    else {
                        $('#addTDSCode').select2('data', { id: data.TDSCode, text: data.TDSName });
                        $('#addTDSRate').val(data.TDSRate);
                    }
                },
                error: function () {
                    alert("Error occured while processing your request.");
                }
            });
        });
        $('#DeleteData').click(function (event) {
            event.preventDefault();
            var confrm = confirm('Are You Sure Do You Want To Delete');
            if (confrm == false) {
                $('.spinner').hide();
                return;
            }
            else {

                var url = '@Url.Action("DeleteData")';
                var ModelData = {};
                ModelData["ParentKey"] = $("#hdnParentKey").val();
                ModelData["Header"] = '@Model.Header';
                ModelData["Mode"] = $("#hdnMode").val();
                ModelData["DocuDate"] = $("#DocuDate").val();
                ModelData["Branch"] = $('#hdnBranch').val();
                var DTO = { Model: ModelData };
                $.ajax({
                    type: "POST",
                    dataType: "json",
                    data: JSON.stringify(DTO),
                    cache: false,
                    url: url,
                    contentType: "application/json; charset=utf-8",
                    beforeSend: function () {
                        $('.spinner').show();
                    },
                    success: function (data) {
                        alert(data.Message);
                        if (data.Status == 'Success') {
                            window.location.href = "/Accounts/MasterGrid?Type=@Model.Type&Module=@Model.Module&ViewDataId=@Model.ViewDataId&TableName=@Model.TableName&Header=@Model.Header&optiontype=@Model.OptionType&OptionCode=@Model.OptionCode&MainType=@Model.MainType&SubType=@Model.SubType&Controller2=@Model.Controller2&Date=" + $('#hdnDate').val();
                        }
                        else if (data.Status == 'Error') {

                            alert(data.Message);
                            $('.spinner').hide();
                        }
                        else {
                            $('.spinner').hide();
                            $("#ErrorMessage").show();
                            $("#ErrorMessage").html(data.html);
                        }
                    },
                });
            }
        });
        $('#SaveData').click(function (event) {
            event.preventDefault();
            if ($("#DocuDate").val() == '') {
                alert('Please Enter Document Date.');
                return;
            }
            if ($("#BankCashCode").val() == '') {
                alert('Please Select a Bank / Cash account.');
                return;
            }
            if ($("#hdnAllowZeroAmt").val() == "False" || $("#hdnAllowZeroAmt").val() == "false") {
                if ($("#SumDebit").val() == 0 && $("#SumCredit").val() == 0) {
                    alert('Nothing Entered..');
                    return;
                }
            }
            if ($('#hdnOTGenerate').val() == "M") {
                if ($("#Srl").val() == '') {
                    alert('Enter Document Number.');
                    return;
                }
            }
            $("#ErrorMessage").hide();
            if ($("#hdnShowLedgerPost").val() == "Y") {
                var ModelData = {};
                ModelData["DocuDate"] = $("#DocuDate").val();
                ModelData["BillDate"] = $("#BillDate").val();
                ModelData["BillNumber"] = $("#BillNumber").val();
                ModelData["BankCashCode"] = $("#BankCashCode").val();
                ModelData["MainType"] = $("#hdnMainType").val();
                ModelData["SubType"] = $("#hdnSubType").val();
                ModelData["Type"] = $("#hdnType").val();
                ModelData["Prefix"] = $("#hdnPrefix").val();
                ModelData["SumDebit"] = $("#SumDebit").val();
                ModelData["SumCredit"] = $("#SumCredit").val();
                ModelData["Srl"] = $("#Srl").val();
                ModelData["ParentKey"] = $("#hdnParentKey").val();
                ModelData["Mode"] = $("#hdnMode").val();
                ModelData["Controller2"] = '@Model.Controller2';
                ModelData["Module"] = '@Model.Module';
                ModelData["ViewDataId"] = '@Model.ViewDataId';
                ModelData["TableName"] = '@Model.TableName';
                ModelData["Header"] = '@Model.Header';
                ModelData["OptionType"] = '@Model.OptionType';
                ModelData["OptionCode"] = '@Model.OptionCode';
                ModelData["Branch"] = $('#hdnBranch').val();
                ModelData["Taxable"] = $("#txttottxable").val();

                ModelData["CGSTAmt"] = $('#txttotcgst').val();
                ModelData["SGSTAmt"] = $('#txttotsgst').val();
                ModelData["IGSTAmt"] = $('#txttotigst').val();
                ModelData["GSTCode"] = $("#addGSTCode").val();
                ModelData["TDSCode"] = $("#addTDSCode").val();
                ModelData["TDSAmt"] = $('#TDSAmt').val();
                ModelData["GSTFlag"] = $('#addGSTNoItc').is(":checked");
                ModelData["TDSFlag"] = $('#addTDSFlag').is(":checked");

                var DTO = { Model: ModelData };
                var url = '@Url.Action("GetPostingNew")';
                $.ajax({
                    async: false,
                    cache: false,
                    url: url,
                    data: JSON.stringify(DTO),
                    type: "POST",
                    dataType: "json",
                    cache: false,
                    contentType: "application/json; charset=utf-8",
                    beforeSend: function () {
                        $('.spinner').show();
                    },
                    success: function (data) {
                        if (data.Status == "ErrorValid") {
                            alert(data.Message)
                            $('.spinner').hide();
                        }
                        else {
                            $('.spinner').hide();
                            $('#ledpostmodel').modal('show');
                            $('#ledpostingmodel').html(data.Html);
                            $('#controllername').val(data.Controller);
                        }

                    },
                });
            }
            else
            {
                if ($("#DocuDate").val() == '') {
                    alert('Please Enter Document Date.');
                    return;
                }
                if ($("#BankCashCode").val() == '') {
                    alert('Please Select a Bank / Cash account.');
                    return;
                }
                if ($("#hdnAllowZeroAmt").val() == "False" || $("#hdnAllowZeroAmt").val() == "false") {
                    if ($("#SumDebit").val() == 0 && $("#SumCredit").val() == 0) {
                        alert('Nothing Entered..');
                        return;
                    }
                }
                if ($('#hdnOTGenerate').val() == "M") {
                    if ($("#Srl").val() == '') {
                        alert('Enter Document Number.');
                        return;
                    }
                }
                $("#ErrorMessage").hide();
                var ModelData = {};
                ModelData["DocuDate"] = $("#DocuDate").val();
                ModelData["BillDate"] = $("#BillDate").val();
                ModelData["BillNumber"] = $("#BillNumber").val();
                ModelData["BankCashCode"] = $("#BankCashCode").val();
                ModelData["MainType"] = $("#hdnMainType").val();
                ModelData["SubType"] = $("#hdnSubType").val();
                ModelData["Type"] = $("#hdnType").val();
                ModelData["Prefix"] = $("#hdnPrefix").val();
                ModelData["SumDebit"] = $("#SumDebit").val();
                ModelData["SumCredit"] = $("#SumCredit").val();
                ModelData["Srl"] = $("#Srl").val();
                ModelData["ParentKey"] = $("#hdnParentKey").val();
                ModelData["Mode"] = $("#hdnMode").val();
                ModelData["Controller2"] = '@Model.Controller2';
                ModelData["Module"] = '@Model.Module';
                ModelData["ViewDataId"] = '@Model.ViewDataId';
                ModelData["TableName"] = '@Model.TableName';
                ModelData["Header"] = '@Model.Header';
                ModelData["OptionType"] = '@Model.OptionType';
                ModelData["OptionCode"] = '@Model.OptionCode';
                ModelData["Branch"] = $('#hdnBranch').val();
                ModelData["Taxable"] = $("#txttottxable").val();
                ModelData["Amt"] = $("#txtinvamt").val();

                ModelData["CGSTAmt"] = $('#txttotcgst').val();
                ModelData["SGSTAmt"] = $('#txttotsgst').val();
                ModelData["IGSTAmt"] = $('#txttotigst').val();
                ModelData["GSTCode"] = $("#addGSTCode").val();
                ModelData["TDSCode"] = $("#addTDSCode").val();
                ModelData["TDSAmt"] = $('#TDSAmt').val();
                ModelData["GSTFlag"] = $('#addGSTNoItc').is(":checked");
                ModelData["TDSFlag"] = $('#addTDSFlag').is(":checked");

                var DTO = { Model: ModelData };
                var url = '@Url.Action("GetPostingNew")';
                $.ajax({
                    async: false,
                    cache: false,
                    url: url,
                    data: JSON.stringify(DTO),
                    type: "POST",
                    dataType: "json",
                    cache: false,
                    contentType: "application/json; charset=utf-8",
                    beforeSend: function () {
                        $('.spinner').show();
                    },
                    success: function (data) {
                        if (data.Status == "ErrorValid") {
                            alert(data.Message)
                            $('.spinner').hide();
                        }
                        else {
                            $('.spinner').show();
                            $('#ledpostingmodel').html(data.Html);
                            $('#controllername').val(data.Controller);
                            $('#LedgerPostgrid tfoot').find('tr').each(function () {
                                var $tds = $(this).find('td');
                                tdeb += parseFloat($tds.eq(3).text());
                                tcred += parseFloat($tds.eq(4).text());
                            });
                            if (tdeb != tcred) {
                                alert('Credit and Debit doesnt Match cant Save')
                                return;
                            }
                            else {
                                var tab2size = $('#tabledata tbody tr').length;
                                if ($("#Account").val() == '') {
                                    alert('Select Party.');
                                    return;
                                }
                                if (tab2size == 0) {
                                    alert('Add Product.');
                                    return;
                                }
                                if ($("#hdnAllowZeroAmt").val() == "False" || $("#hdnAllowZeroAmt").val() == "false") {
                                    if ($("#SumDebit").val() == 0 && $("#SumCredit").val() == 0) {
                                        alert('Nothing Entered..');
                                        return;
                                    }
                                }
                                $('#fixedbottom :input').prop("disabled", true);
                                $('#frmpurchase :input').prop("disabled", true);
                                $('.form-horizontal :input').prop("disabled", true);
                                $('#ItemListTable :input').prop('disabled', true);
                                var myLederArray = [];
                                $('#LedgerPostgrid tbody').find('tr').each(function () {
                                    var tds = $(this).find('td');
                                    var myDets = {
                                        tempId: tds.eq(0).text(),
                                        Code: tds.eq(1).text(),
                                        Debit: tds.eq(3).text(),
                                        Credit: tds.eq(4).text(),
                                        Narr: tds.eq(7).text(),
                                        AltCode: tds.eq(8).text()
                                        //TDSFlag: tds.eq(6).text()
                                    }
                                    myLederArray.push(myDets);
                                });
                                var mAuthorise = $('#hdnAuthorise').val();
                                var url = '@Url.Action("SaveData")';
                                var ModelData = {};
                                ModelData["LedgerPostList"] = myLederArray;
                                ModelData["OTGenerate"] = $("#hdnOTGenerate").val();
                                ModelData["DocuDate"] = $("#DocuDate").val();
                                ModelData["BankCashCode"] = $("#BankCashCode").val();
                                ModelData["MainType"] = $("#hdnMainType").val();
                                ModelData["SubType"] = $("#hdnSubType").val();
                                ModelData["Type"] = $("#hdnType").val();
                                ModelData["Prefix"] = $("#hdnPrefix").val();
                                ModelData["SumDebit"] = $("#SumDebit").val();
                                ModelData["SumCredit"] = $("#SumCredit").val();
                                ModelData["Srl"] = $("#Srl").val();
                                ModelData["ParentKey"] = $("#hdnParentKey").val();
                                ModelData["Mode"] = $("#hdnMode").val();
                                ModelData["Authorise"] = "A00";
                                ModelData["Controller2"] = '@Model.Controller2';
                                ModelData["Module"] = '@Model.Module';
                                ModelData["ViewDataId"] = '@Model.ViewDataId';
                                ModelData["TableName"] = '@Model.TableName';
                                ModelData["Header"] = '@Model.Header';
                                ModelData["OptionType"] = '@Model.OptionType';
                                ModelData["OptionCode"] = '@Model.OptionCode';
                                ModelData["Branch"] = $('#hdnBranch').val();
                                ModelData["CGSTAmt"] = $('#txttotcgst').val();
                                ModelData["SGSTAmt"] = $('#txttotsgst').val();
                                ModelData["IGSTAmt"] = $('#txttotigst').val();
                                if ($('#addTDSFlag').is(":checked")) {
                                    ModelData["TDSFlag"] = $('#addTDSFlag').is(":checked");
                                    ModelData["TDSCode"] = $("#addTDSCode").val();
                                    ModelData["TDSAmt"] = $('#TDSAmt').val();
                                }
                                ModelData["Taxable"] = $("#txttottxable").val();
                                ModelData["Amt"] = $('#txtinvamt').val();
                                ModelData["BillDate"] = $("#BillDate").val();
                                ModelData["BillNumber"] = $("#BillNumber").val();
                                var DTO = { Model: ModelData };
                                $.ajax({
                                    type: "POST",
                                    dataType: "json",
                                    data: JSON.stringify(DTO),
                                    cache: false,
                                    url: url,
                                    contentType: "application/json; charset=utf-8",
                                    beforeSend: function () {
                                        $('.spinner').show();
                                    },
                                    success: function (data) {
                                        $('.spinner').hide();
                                        if (data.Status == 'AutoDocumentAlert') {
                                            PurchaseBillAlertNoteMaster(data.Message);
                                            $('#fixedbottom :input').prop("disabled", false);
                                            $('#frmpurchase :input').prop("disabled", false);
                                            $('.form-horizontal :input').prop("disabled", false);
                                            $('#ItemListTable :input').prop('disabled', false);
                                        }
                                        else if (data.Status == 'CancelError') {
                                            $('#fixedbottom :input').prop("disabled", false);
                                            $('#frmpurchase :input').prop("disabled", false);
                                            $('.form-horizontal :input').prop("disabled", false);
                                            $('#ItemListTable :input').prop('disabled', false);
                                            alert(data.Message);
                                        }
                                        else if (data.Status == 'PrimaryKeyError') {
                                            alert(data.Message);
                                            $('#fixedbottom :input').prop("disabled", false);
                                            $('#frmpurchase :input').prop("disabled", false);
                                            $('.form-horizontal :input').prop("disabled", false);
                                            $('#ItemListTable :input').prop('disabled', false);
                                        }
                                        else if (data.Status == 'Success') {
                                            if ($('#hdnShowDocSerial').val() == 'True' || $('#hdnShowDocSerial').val() == 'true') {
                                                alert("Document Saved as " + data.NewSrl + "");
                                            }
                                            if (PrintLR == "SavePrint") {
                                                $('.spinner').hide();
                                                $('#printpostmodel').modal('show');

                                            }
                                            else {
                                                if ($('#hdnMode').val() != "Add") {
                                                    window.location.href = "/Accounts/MasterGrid?Type=@Model.Type&Module=@Model.Module&ViewDataId=@Model.ViewDataId&TableName=@Model.TableName&Header=@Model.Header&optiontype=@Model.OptionType&OptionCode=@Model.OptionCode&MainType=@Model.MainType&SubType=@Model.SubType&Controller2=@Model.Controller2";
                                                }
                                                else {
                                                    window.location.href = "/Accounts/" + '@Model.Controller2' + "/Index?Type=" + '@Model.Type' + '&ChangeLog=Add&Mode=Add' + '&ViewDataId=' + '@Model.ViewDataId' + '&Header=' + '@Model.Header' + '&Module=' + '@Model.Module' + '&TableName=' + '@Model.TableName' + '&OptionType=' + '@Model.OptionType' + '&OptionCode=' + '@Model.OptionCode' + '&Controller2=' + '@Model.Controller2';
                                                }
                                            }
                                        }
                                        else if (data.Status == 'Error') {
                                            alert(data.Message);
                                            $('#fixedbottom :input').prop("disabled", false);
                                            $('#frmpurchase :input').prop("disabled", false);
                                            $('.form-horizontal :input').prop("disabled", false);
                                            $('#ItemListTable :input').prop('disabled', false);
                                            $("#ErrorMessage").show();
                                            $("#ErrorMessage").text(data.Message);
                                        }
                                        else {
                                            alert('Status not Success')
                                            $('#fixedbottom :input').prop("disabled", false);
                                            $('#frmpurchase :input').prop("disabled", false);
                                            $('.form-horizontal :input').prop("disabled", false);
                                            $('#ItemListTable :input').prop('disabled', false);
                                            $("#ErrorMessage").show();
                                            $("#ErrorMessage").html(data.html);
                                        }
                                    },
                                    error: function (ex) {
                                        alert(JSON.stringify(ex))
                                        alert("Error occured while processing your request.");
                                        $('#fixedbottom :input').prop("disabled", false);
                                        $('#frmpurchase :input').prop("disabled", false);
                                        $('.form-horizontal :input').prop("disabled", false);
                                        $('#ItemListTable :input').prop('disabled', false);
                                    }
                                });
                            }
                        }
                    },
                });
            }
        });
        $('#btnPrintOnly').click(function (event) {
            event.preventDefault();
            PrintLR = "OnlyPrint";
            $('#printpostmodel').modal('show');
        });
        $('#SavePrint').click(function () {
            event.preventDefault();
            PrintLR = "SavePrint";
            if ($("#DocuDate").val() == '') {
                alert('Please Enter Document Date.');
                return;
            }

            if ($("#BankCashCode").val() == '') {
                alert('Please Select a Bank / Cash account.');
                return;
            }
            if ($("#hdnAllowZeroAmt").val() == "False" || $("#hdnAllowZeroAmt").val() == "false") {
                if ($("#SumDebit").val() == 0 && $("#SumCredit").val() == 0) {
                    alert('Nothing Entered..');
                    return;
                }
            }

            if ($('#hdnOTGenerate').val() == "M") {
                if ($("#Srl").val() == '') {
                    alert('Enter Document Number.');
                    return;
                }
            }
            $("#ErrorMessage").hide();


            if ($("#hdnShowLedgerPost").val() == "Y") {
                //$('#ledpostmodel').modal({
                //    backdrop: 'static',
                //    keyboard: false
                //});

                var ModelData = {};
                ModelData["DocuDate"] = $("#DocuDate").val();
                ModelData["BillDate"] = $("#BillDate").val();
                ModelData["BillNumber"] = $("#BillNumber").val();
                ModelData["BankCashCode"] = $("#BankCashCode").val();
                ModelData["MainType"] = $("#hdnMainType").val();
                ModelData["SubType"] = $("#hdnSubType").val();
                ModelData["Type"] = $("#hdnType").val();
                ModelData["Prefix"] = $("#hdnPrefix").val();
                ModelData["SumDebit"] = $("#SumDebit").val();
                ModelData["SumCredit"] = $("#SumCredit").val();
                ModelData["Srl"] = $("#Srl").val();
                ModelData["ParentKey"] = $("#hdnParentKey").val();
                ModelData["Mode"] = $("#hdnMode").val();
                ModelData["Controller2"] = '@Model.Controller2';
                ModelData["Module"] = '@Model.Module';
                ModelData["ViewDataId"] = '@Model.ViewDataId';
                ModelData["TableName"] = '@Model.TableName';
                ModelData["Header"] = '@Model.Header';
                ModelData["OptionType"] = '@Model.OptionType';
                ModelData["OptionCode"] = '@Model.OptionCode';
                ModelData["Branch"] = $('#hdnBranch').val();
                ModelData["Taxable"] = $("#txttottxable").val();

                ModelData["CGSTAmt"] = $('#txttotcgst').val();
                ModelData["SGSTAmt"] = $('#txttotsgst').val();
                ModelData["IGSTAmt"] = $('#txttotigst').val();
                ModelData["GSTCode"] = $("#addGSTCode").val();
                ModelData["TDSCode"] = $("#addTDSCode").val();
                ModelData["TDSAmt"] = $('#TDSAmt').val();
                ModelData["GSTFlag"] = $('#addGSTNoItc').is(":checked");
                ModelData["TDSFlag"] = $('#addTDSFlag').is(":checked");

                var DTO = { Model: ModelData };
                var url = '@Url.Action("GetPostingNew")';
                $.ajax({
                    async: false,
                    cache: false,
                    url: url,
                    data: JSON.stringify(DTO),
                    type: "POST",
                    dataType: "json",
                    cache: false,
                    contentType: "application/json; charset=utf-8",
                    beforeSend: function () {
                        $('.spinner').show();
                    },
                    success: function (data) {
                        if (data.Status == "ErrorValid") {
                            alert(data.Message)
                            $('.spinner').hide();
                        }
                        else {
                            $('.spinner').hide();
                            $('#ledpostmodel').modal('show');
                            $('#ledpostingmodel').html(data.Html);
                            $('#controllername').val(data.Controller);
                        }

                    },
                });
            }
            else {
                var ModelData = {};
                ModelData["DocuDate"] = $("#DocuDate").val();
                ModelData["BillDate"] = $("#BillDate").val();
                ModelData["BillNumber"] = $("#BillNumber").val();
                ModelData["BankCashCode"] = $("#BankCashCode").val();
                ModelData["MainType"] = $("#hdnMainType").val();
                ModelData["SubType"] = $("#hdnSubType").val();
                ModelData["Type"] = $("#hdnType").val();
                ModelData["Prefix"] = $("#hdnPrefix").val();
                ModelData["SumDebit"] = $("#SumDebit").val();
                ModelData["SumCredit"] = $("#SumCredit").val();
                ModelData["Srl"] = $("#Srl").val();
                ModelData["ParentKey"] = $("#hdnParentKey").val();
                ModelData["Mode"] = $("#hdnMode").val();
                ModelData["Controller2"] = '@Model.Controller2';
                ModelData["Module"] = '@Model.Module';
                ModelData["ViewDataId"] = '@Model.ViewDataId';
                ModelData["TableName"] = '@Model.TableName';
                ModelData["Header"] = '@Model.Header';
                ModelData["OptionType"] = '@Model.OptionType';
                ModelData["OptionCode"] = '@Model.OptionCode';
                ModelData["Branch"] = $('#hdnBranch').val();
                ModelData["Taxable"] = $("#txttottxable").val();

                ModelData["CGSTAmt"] = $('#txttotcgst').val();
                ModelData["SGSTAmt"] = $('#txttotsgst').val();
                ModelData["IGSTAmt"] = $('#txttotigst').val();
                ModelData["GSTCode"] = $("#addGSTCode").val();
                ModelData["TDSCode"] = $("#addTDSCode").val();
                ModelData["TDSAmt"] = $('#TDSAmt').val();
                ModelData["GSTFlag"] = $('#addGSTNoItc').is(":checked");
                ModelData["TDSFlag"] = $('#addTDSFlag').is(":checked");

                var DTO = { Model: ModelData };
                var url = '@Url.Action("GetPostingNew")';
                $.ajax({
                    async: false,
                    cache: false,
                    url: url,
                    data: JSON.stringify(DTO),
                    type: "POST",
                    dataType: "json",
                    cache: false,
                    contentType: "application/json; charset=utf-8",
                    beforeSend: function () {
                        $('.spinner').show();
                    },
                    success: function (data) {
                        if (data.Status == "ErrorValid") {
                            alert(data.Message)
                            $('.spinner').hide();
                        }
                        else {
                            $('.spinner').hide();
                            SavePurchase();
                            $('#controllername').val(data.Controller);
                        }

                    },
                });
            }
        });

        $("#btnAddNote").click(function (e) {
            e.preventDefault();
            $("#OnlyAlertNoteDiv").html('');
            var url = '/Logistics/AlertNote/ShoWAlertNoteList';
            var myTableArray = [];
            myTableArray.push('@Model.ParentKey');
            var DTO = { Type: "PUR00", TypeCode: myTableArray, DocTpe: "PUR00" };
            $.ajax({
                type: "POST",
                dataType: "json",
                data: JSON.stringify(DTO),
                cache: false,
                url: url,
                contentType: "application/json; charset=utf-8",
                beforeSend: function () {
                    $('.spinner').show();
                },
                success: function (data) {
                    $('.spinner').hide();
                    debugger;
                    $('#addnotemodel').modal('show');
                    var AttachDoc = $("#AlertAlertNoteDiv");
                    AttachDoc.html('');
                    AttachDoc.html(data.Html);

                    $("#AlertAlertNoteDiv,#btnAddNarr").removeClass("hidden");
                    $("#AddAlertNoteDiv,#btnNarrList,#btnNarrSave").addClass("hidden");
                },
            });
        });
        $("#btnAddNarr").click(function (e) {
            e.preventDefault();
            $("#AlertAlertNoteDiv,#btnAddNarr").addClass("hidden");
            $("#AddAlertNoteDiv,#btnNarrList,#btnNarrSave").removeClass("hidden");
            var url = '/Logistics/AlertNote/PartialView';
            var ModelData = {};
            ModelData["AType"] = "PUR00";
            ModelData["DocReceived"] = $("#Srl").val();
            ModelData["DocumentKey"] = '@Model.ParentKey';
            var DTO = { mModel: ModelData };
            $.ajax({
                type: "POST",
                dataType: "json",
                data: JSON.stringify(DTO),
                cache: false,
                url: url,
                contentType: "application/json; charset=utf-8",
                beforeSend: function () {
                    $('.spinner').show();
                },
                success: function (data) {
                    $('.spinner').hide();
                    debugger;
                    var AttachDoc = $("#AddAlertNoteDiv");
                    AttachDoc.html('');
                    AttachDoc.html(data.Html);
                },
            });
        });
        $("#btnNarrList").click(function (e) {
            e.preventDefault();
            $("#AlertAlertNoteDiv,#btnAddNarr").removeClass("hidden");
            $("#AddAlertNoteDiv,#btnNarrList,#btnNarrSave").addClass("hidden");
        });
        $('#btnNarrSave').click(function (event) {
            event.preventDefault();
            debugger;
            if ($("#AType").val() == null || $("#AType").val() == '') {
                $("#CommonErrorMessage").show();
                $("#CommonErrorMessage").text('Type is required..');
                return;
            }
            if ($("#CommonRemark").val() == null || $("#CommonRemark").val() == '') {
                $("#CommonErrorMessage").show();
                $("#CommonErrorMessage").text('Remark is required..');
                return;
            }
            var AlertRefType = [];
            debugger;
            $('#ALerttbl > tbody  > tr').each(function () {
                var tds = $(this).find('td');
                if ($(this).find(".chkfvalue").prop("checked") == true || $(this).find(".chkfvalueStop").prop("checked")) {
                    var myDets =
                    {
                        Code: tds.eq(1).text(),
                        select: $(this).find(".chkfvalue").prop("checked"),
                        stop: $(this).find(".chkfvalueStop").prop("checked"),
                    }
                    AlertRefType.push(myDets);
                }
            });
            var url = '/Logistics/AlertNote/SaveDataGetList';
            var ModelData = {};
            ModelData["AType"] = $("#AType").val();
            ModelData["TypeCode"] = $("#TypeCode").val();
            ModelData["RefersType"] = AlertRefType;
            ModelData["Remark"] = $("#CommonRemark").val();
            ModelData["Bling"] = $("#Bling").is(":checked");
            ModelData["PartyNarr"] = $("#PartyNarr").is(":checked");
            ModelData["Mode"] = '@Model.Mode';
            ModelData["Header"] = '@Model.Header';
            var DTO = { mModel: ModelData };
            $.ajax({
                type: "POST",
                dataType: "json",
                data: JSON.stringify(DTO),
                cache: false,
                url: url,
                contentType: "application/json; charset=utf-8",
                beforeSend: function () {
                    $('.spinner').show();
                },
                success: function (data) {
                    $("#ErrorMessage").hide();
                    $('.spinner').hide();
                    if (data.Status == "Error") {
                        alert(data.Message);
                    } else
                    {
                        var LoadDownLoadFiles = $("#AlertAlertNoteDiv");
                        LoadDownLoadFiles.html('');
                        LoadDownLoadFiles.html(data.Html);
                        $("#AlertAlertNoteDiv,#btnAddNarr").removeClass("hidden");
                        $("#AddAlertNoteDiv,#btnNarrList,#btnNarrSave").addClass("hidden");
                    }
                },
            });
        });


    });
    function GetAccountDetails() {
        var url = '@Url.Action("GetAccountDetails")';
            var ModelData = {};

        ModelData["DocuDate"] = $("#DocuDate").val();
            ModelData["BankCashCode"] = $("#BankCashCode").val();

            var DTO = { Model: ModelData };
            $.ajax({
                type: "POST",
                dataType: "json",
                data: JSON.stringify(DTO),
                cache: false,
                url: url,
                contentType: "application/json;charset=utf-8",
                beforeSend: function () {
                    $('.spinner').show();
                },
                success: function (data) {
                    $('.spinner').hide();
                    if (data.CutTDS == true) {
                        $("#addTDSFlag").prop("checked", true);
                    }
                    else {
                        $("#addTDSFlag").prop("checked", false);
                        //$('#addTDSCode').val(null).trigger("change");
                        //$('#addTDSRate').val("0");
                    }
                    if (data.TDSCode == "0") {
                        $('#addTDSCode').select2('data', { id: '', text: '' });
                        $('#addTDSRate').val("0");

                    }
                    else {
                        $('#addTDSCode').select2('data', { id: data.TDSCode, text: data.TDSName });
                        $('#addTDSRate').val(data.TDSRate);
                    }
                },
                error: function () {
                    alert("Error occured while processing your request.");
                }
            });
    }
    function SavePurchase() {
        $('#LedgerPostgrid tfoot').find('tr').each(function () {
                var $tds = $(this).find('td');
                tdeb += parseFloat($tds.eq(3).text());
                tcred += parseFloat($tds.eq(4).text());

            });
           if (tdeb != tcred) {
               alert('Credit and Debit doesnt Match cant Save')
                return;
            }
            else {

               var tab2size = $('#tabledata tbody tr').length;
               if ($("#Account").val() == '') {
                   alert('Select Party.');
                   return;
               }

               if (tab2size == 0) {
                   alert('Add Product.');
                   return;
               }
               if ($("#hdnAllowZeroAmt").val() == "False" || $("#hdnAllowZeroAmt").val() == "false") {
                   if ($("#SumDebit").val() == 0 && $("#SumCredit").val() == 0) {
                       alert('Nothing Entered..');
                       return;
                   }
               }

                   $('#fixedbottom :input').prop("disabled", true);
                   $('#frmpurchase :input').prop("disabled", true);
                   $('.form-horizontal :input').prop("disabled", true);
                   $('#ItemListTable :input').prop('disabled', true);



                   var myLederArray = [];
                   $('#LedgerPostgrid tbody').find('tr').each(function () {
                       var tds = $(this).find('td');

                       var myDets = {
                           tempId: tds.eq(0).text(),
                           Code: tds.eq(1).text(),
                           Debit: tds.eq(3).text(),
                           Credit: tds.eq(4).text(),
                           Narr: tds.eq(7).text(),
                           AltCode: tds.eq(8).text()
                           //TDSFlag: tds.eq(6).text()
                       }
                       myLederArray.push(myDets);
                   });
                   var mAuthorise = $('#hdnAuthorise').val();


                   var url = '@Url.Action("SaveData")';
                   var ModelData = {};
                    ModelData["LedgerPostList"] = myLederArray;
               ModelData["OTGenerate"] = $("#hdnOTGenerate").val();
                    ModelData["DocuDate"] = $("#DocuDate").val();
                    ModelData["BankCashCode"] = $("#BankCashCode").val();
                    ModelData["MainType"] = $("#hdnMainType").val();
                    ModelData["SubType"] = $("#hdnSubType").val();
                    ModelData["Type"] = $("#hdnType").val();
                    ModelData["Prefix"] = $("#hdnPrefix").val();
                    ModelData["SumDebit"] = $("#SumDebit").val();
                    ModelData["SumCredit"] = $("#SumCredit").val();
               ModelData["Srl"] = $("#Srl").val();
                    ModelData["ParentKey"] = $("#hdnParentKey").val();
                    ModelData["Mode"] = $("#hdnMode").val();
                    ModelData["Authorise"] = "A00";
                    ModelData["Controller2"] = '@Model.Controller2';
                    ModelData["Module"] = '@Model.Module';
                    ModelData["ViewDataId"] = '@Model.ViewDataId';
                    ModelData["TableName"] = '@Model.TableName';
                    ModelData["Header"] = '@Model.Header';
                    ModelData["OptionType"] = '@Model.OptionType';
               ModelData["OptionCode"] = '@Model.OptionCode';
               ModelData["Branch"] = $('#hdnBranch').val();

               if ($('#addGSTNoItc').is(":checked")) {

                   ModelData["GSTFlag"] = $('#addGSTNoItc').is(":checked");
                   ModelData["GSTCode"] = $("#addGSTCode").val();
                   ModelData["CGSTAmt"] = $('#txttotcgst').val();
                   ModelData["SGSTAmt"] = $('#txttotsgst').val();
                   ModelData["IGSTAmt"] = $('#txttotigst').val();
                   ModelData["CGSTRate"] = $('#addCGSTRate').val();
                   ModelData["IGSTRate"] = $('#addIGSTRate').val();
                   ModelData["SGSTRate"] = $('#addSGSTRate').val();

               }
               if ($('#addTDSFlag').is(":checked")) {
                   ModelData["TDSFlag"] = $('#addTDSFlag').is(":checked");
                   ModelData["TDSCode"] = $("#addTDSCode").val();
                   ModelData["TDSAmt"] = $('#TDSAmt').val();
               }
               ModelData["Taxable"] = $("#txttottxable").val();
               ModelData["Amt"] = $('#txtinvamt').val();
               ModelData["BillDate"] = $("#BillDate").val();
               ModelData["BillNumber"] = $("#BillNumber").val();

                   var DTO = { Model: ModelData };
                   $.ajax({
                       type: "POST",
                       dataType: "json",
                       data: JSON.stringify(DTO),
                       cache: false,
                       url: url,
                       contentType: "application/json; charset=utf-8",
                       beforeSend: function () {
                           $('.spinner').show();
                       },
                       success: function (data) {
                           $('.spinner').hide();
                           if (data.Status == 'AutoDocumentAlert') {
                               PurchaseBillAlertNoteMaster(data.Message);
                               $('#fixedbottom :input').prop("disabled", false);
                               $('#frmpurchase :input').prop("disabled", false);
                               $('.form-horizontal :input').prop("disabled", false);
                               $('#ItemListTable :input').prop('disabled', false);
                           }
                           else if (data.Status == 'CancelError') {
                               $('#fixedbottom :input').prop("disabled", false);
                               $('#frmpurchase :input').prop("disabled", false);
                               $('.form-horizontal :input').prop("disabled", false);
                               $('#ItemListTable :input').prop('disabled', false);
                               alert(data.Message);

                           }
                           else if (data.Status == 'PrimaryKeyError') {
                               alert(data.Message);
                               $('#fixedbottom :input').prop("disabled", false);
                               $('#frmpurchase :input').prop("disabled", false);
                               $('.form-horizontal :input').prop("disabled", false);
                               $('#ItemListTable :input').prop('disabled', false);

                           }
                           else if (data.Status == 'Success') {
                               if ($('#hdnShowDocSerial').val() == 'True' || $('#hdnShowDocSerial').val() == 'true') {
                                   alert("Document Saved as " + data.NewSrl + "");
                               }
                                   if ($('#hdnMode').val() != "Add") {
                                       window.location.href = "/Accounts/MasterGrid?Type=@Model.Type&Module=@Model.Module&ViewDataId=@Model.ViewDataId&TableName=@Model.TableName&Header=@Model.Header&optiontype=@Model.OptionType&OptionCode=@Model.OptionCode&MainType=@Model.MainType&SubType=@Model.SubType&Controller2=@Model.Controller2";
                                   }
                                   else {
                                       window.location.href = "/Accounts/" + '@Model.Controller2' + "/Index?Type=" + '@Model.Type' + '&ChangeLog=Add&Mode=Add' + '&ViewDataId=' + '@Model.ViewDataId' + '&Header=' + '@Model.Header' + '&Module=' + '@Model.Module' + '&TableName=' + '@Model.TableName' + '&OptionType=' + '@Model.OptionType' + '&OptionCode=' + '@Model.OptionCode' + '&Controller2=' + '@Model.Controller2';
                                   }

                           }
                           else if (data.Status == 'Error') {
                               alert(data.Message);
                               $('#fixedbottom :input').prop("disabled", false);
                               $('#frmpurchase :input').prop("disabled", false);
                               $('.form-horizontal :input').prop("disabled", false);
                               $('#ItemListTable :input').prop('disabled', false);
                               $("#ErrorMessage").show();
                               $("#ErrorMessage").text(data.Message);

                           }
                           else {
                               alert('Status not Success')
                               $('#fixedbottom :input').prop("disabled", false);
                               $('#frmpurchase :input').prop("disabled", false);
                               $('.form-horizontal :input').prop("disabled", false);
                               $('#ItemListTable :input').prop('disabled', false);
                               $("#ErrorMessage").show();
                               $("#ErrorMessage").html(data.html);

                           }
                       },
                       error: function (ex) {
                           alert(JSON.stringify(ex))
                           alert("Error occured while processing your request.");
                           $('#fixedbottom :input').prop("disabled", false);
                           $('#frmpurchase :input').prop("disabled", false);
                           $('.form-horizontal :input').prop("disabled", false);
                           $('#ItemListTable :input').prop('disabled', false);
                       }
                   });


           }
    }
    function loadCashBank() {
        var url = '@Url.Action("GetCashBankList")';
        $('#BankCashCode').select2({
            minimumInputLength: 0,
            placeholder: 'Search',
            ajax: {
                url: url,
                dataType: 'json',
                quietMillis: 100,
                enableFiltering: true,
                allowClear: true,
                minimumInputLength: 5,
                multiple: true,
                width: 300,
                data: function (term, page) {
                    return {
                        types: ["exercise"],
                        limit: -1,
                        term: term
                    };
                },
                results: function (data, page) {
                    clientObj = JSON.stringify(data);
                    return {
                        results: $.map(data, function (item) {
                            return {
                                text: item.Name,
                                id: item.Code
                            }
                        })
                    };
                }
            },
            initSelection: function (element, callback) {
                var data = { id: '@Model.BankCashCode', text:'@Model.BankCashName' };
                callback(data);
            },
            formatResult: function (exercise) {
                return "<div class='row-fluid'><div class=''><span class='span1'><div style='color:" + exercise.alias + "'>" + exercise.text +
                    "</div></span></div></div>";
            },
            formatSelection: function (exercise) {
                //GetAccountDetails();
                return "<div class='row-fluid'><div class=''><span class='span1'><div style='color:" + exercise.alias + "'>" + exercise.text +
                    "</div></span></div></div>";
            },
        })
    };

</script>

<header class="header fixed-top" id="headerdiv" style="position:fixed;background-color:lightgray;padding:6px;width:100%;margin-top:0%;">
    <div class="fixhead">
        <div class="col-md-3" style="padding-left:6px;padding-top:3px;">
            <b class="CodeSt" id="headercaption">@Model.Header (@Model.Type)</b>
        </div>

        <div class="col-md-1 pull-right" style="padding-left:6px;font-family:Tahoma;padding-top:2px;padding-right:0px;font-size:9pt; width:unset;">
            @if (Model.LedgerThrough)
            {
                <a href="" onclick="window.top.close();" class="btn btn-danger" style="color:white;font-weight:bolder;font-size:13px;padding:3px 10px;" id="Cancel2">X</a>
            }
            else
            {
                <a href="~/Accounts/MasterGrid?Type=@Model.Type&Module=@Model.Module&ViewDataId=@Model.ViewDataId&TableName=@Model.TableName&Header=@Model.Header&optiontype=@Model.OptionType&OptionCode=@Model.OptionCode&MainType=@Model.MainType&SubType=@Model.SubType&Controller2=@Model.Controller2" class="btn btn-danger" style="color:white;font-weight:bolder;font-size:13px;padding:3px 10px;" id="Cancel2">X</a>
            }
        </div>
        <div class="col-md-1 pull-right" style="padding-left:6px;font-family:Tahoma;padding-top:2px;padding-right:0px;font-size:14pt;font-weight:bold;width:unset;">
            <label id="headercaption">@Model.Mode</label>
        </div>
        <button class="fa fa-heart pull-right" type="submit" onclick="AddToFavorite('@Model.ViewDataId','@Model.OptionCode')" title="Add/Remove from My Favorites" id="MyFavorites" style="color: rgb(145,142,142); background-color: transparent; border: none; font-size: 20px; height: 27px; margin-right: 5px;margin-top:5px;" name="MyFavorites"></button>

    </div>
</header>

<section class="panel">
    <div class="panel-body">
        <div class="form-horizontal " id="frmaddnewbank" role="form" style="margin-top:3%;">
            <div id="ErrorMessage" name="ErrorMessage" class="alert alert-danger" style="display: none; padding:3px;margin-bottom: 0px;"></div>

            <div class="form-group">
                <div class="col-sm-1" style="padding-top:0px;">
                    @if (Model.BillBoth)
                    {
                        <input type="checkbox" data-toggle="toggle" id="FBothCHK" data-onstyle="info" data-offstyle="danger" data-on="Manual" data-off="Auto" style="width: 100%;height: 34px;">
                    }
                    else if (Model.OTGenerate == "A")
                    {
                        <input type="checkbox" data-toggle="toggle" id="FBothCHK" data-onstyle="info" data-offstyle="danger" data-on="Manual" data-off="Auto" style="width: 100%;height: 34px;" disabled>
                    }
                    else
                    {
                        <input type="checkbox" data-toggle="toggle" id="FBothCHK" data-onstyle="danger" data-offstyle="info" data-on="Auto" data-off="Manual" style="width: 100%;height: 34px;" disabled>
                    }
                </div>
                <label class="col-sm-1 control-label" style="padding-right:0px;padding-left:0px;">Doc. Serial:</label>
                <div class="col-sm-1" style="padding-left:0px;">
                    @if (Model.Mode == "Add")
                    {
                        @Html.TextBoxFor(x => x.Srl, new { @class = "form-control", @id = "Srl", @Name = "Srl", @style = "width:100%;height:28px;font-size:13pt;font-weight:bolder;text-align:center;", @Value = Model.Srl })
                    }
                    else
                    {
                        @Html.TextBoxFor(x => x.Srl, new { @class = "form-control", @id = "Srl", @Name = "Srl", @style = "width:100%;height:28px;font-size:13pt;font-weight:bolder;text-align:center;", @disabled = "disabled", @Value = Model.Srl })
                    }
                </div>
                <label class="col-sm-1 control-label" style="padding-right:0px;">Doc. Date:</label>
                <div class="col-sm-1">
                    @Html.TextBoxFor(x => x.DocuDate, new { @type = "text", @class = "form-control", @id = "DocuDate", @Name = "DocuDate", @style = "width:100%;text-align:center;height:28px;font:size:14pt;font-weight:bolder;", @Value = Model.DocDate.ToString("dd-MM-yyyy") })
                </div>
                <label class="col-sm-1 control-label" style="padding-right:0px;padding-left:0px;">Vendor Account</label>
                <div class="col-sm-2" style="padding-left:0px;">
                    @Html.TextBoxFor(m => m.BankCashCode, new { @class = "input-large search-query", @id = "BankCashCode", @Name = "BankCashCode", @style = "width:99%;" })
                </div>
                <div class="col-sm-4">
                    <label class="col-sm-3 control-label">Bill Date:</label>
                    <div class="col-sm-3" style="padding-right:0px;padding-left:0px;">
                        @Html.TextBoxFor(x => x.BillDate, new { @type = "text", @class = "form-control", @id = "BillDate", @Name = "BillDate", @style = "width:100%;text-align:center;height:28px;font:size:14pt;font-weight:bolder;", @Value = Model.BillDate.ToString("dd-MM-yyyy") })
                    </div>
                    <label class="col-sm-3 control-label">Bill Number:</label>
                    <div class="col-sm-3" style="padding-right:0px;padding-left:0px;">
                        @Html.TextBoxFor(x => x.BillNumber, new { @class = "form-control", @id = "BillNumber", @Name = "Cheque", @style = "width:99%;", @value = Model.BillNumber })
                    </div>
                </div>

            </div>
            <div class="tab">
                <button class="tablinks" onclick="openCity(event, 'divLedgerTable')" id="List">List</button>
                <button class="tablinks" onclick="openCity(event, 'divLedgerTable1')">TDS Details</button>
                @*<button class="tablinks" onclick="openCity(event, 'divLedgerTable2')">GST Details</button>*@
            </div>


            <div id="divLedgerTable" class="tabcontent" style="min-height:370px;max-height:370px;">
                <div class="grid">
                    @Html.Partial("LedgerList", Model)
                </div>
            </div>
            <div id="divLedgerTable1" class="tabcontent" style="min-height:370px;max-height:370px;">
                @*@Html.Partial("ValueChargeList", Model)*@
                <div class="form-group">
                    <label class="col-sm-1 control-label">TDS Cut?</label>
                    <div class="col-sm-1">
                        @Html.CheckBoxFor(x => x.TDSFlag, new { @id = "addTDSFlag", @Name = "addTDSFlag", @Value = Model.TDSFlag })
                    </div>
                    <label class="col-sm-1 control-label">Code</label>
                    <div class="col-sm-2">
                        @Html.TextBoxFor(x => x.TDSCode, new { @class = "input-large search-query", @id = "addTDSCode", @Name = "addTDSCode", @style = "width:99%;" })
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-1 control-label">TDS Rate</label>
                    <div class="col-sm-1">
                        @Html.TextBoxFor(x => x.TDSRate, new { @class = "form-control", @id = "addTDSRate", @Name = "addTDSRate", @Value = Model.TDSRate })
                    </div>
                    <label class="col-sm-1 control-label">TDS Amt</label>
                    <div class="col-sm-1">
                        @Html.TextBoxFor(x => x.TDSAmt, new { @class = "form-control", @id = "addTDSAmt", @Name = "addTDSAmt", @Value = Model.TDSAmt })
                    </div>
                </div>
            </div>
            @*<div id="divLedgerTable2" class="tabcontent" style="min-height:370px;max-height:370px;">
            <div class="form-group">
                <label class="col-sm-1 control-label">GST Cut?</label>
                <div class="col-sm-1">
                    @Html.CheckBoxFor(x => x.GSTFlag, new { @id = "addGSTNoItc", @Name = "addGSTNoItc" })
                </div>
                <label class="col-sm-1 control-label">GST Type</label>
                <div class="col-sm-2">
                    @Html.TextBoxFor(x => x.GSTCode, new { @class = "input-large search-query", @id = "addGSTCode", @Name = "addGSTCode", @style = "width:99%;" })
                </div>
                <label class="col-sm-1 control-label">Taxable</label>
                <div class="col-sm-1">
                    @Html.TextBoxFor(x => x.Taxable, new { @class = "form-control", @id = "addTaxable", @Name = "addTaxable" })
                </div>
            </div>
            <div class="form-group">
                <label class="col-sm-1 control-label">IGST Rate</label>
                <div class="col-sm-1">
                    @Html.TextBoxFor(x => x.IGSTRate, new { @class = "form-control", @id = "addIGSTRate", @Name = "addIGSTRate" })
                </div>
                <label class="col-sm-1 control-label">IGST Amt</label>
                <div class="col-sm-1">
                    @Html.TextBoxFor(x => x.IGSTAmt, new { @class = "form-control", @id = "addIGSTAmt", @Name = "addIGSTAmt" })
                </div>
            </div>
            <div class="form-group">
                <label class="col-sm-1 control-label">CGST Rate</label>
                <div class="col-sm-1">
                    @Html.TextBoxFor(x => x.CGSTRate, new { @class = "form-control", @id = "addCGSTRate", @Name = "addCGSTRate" })
                </div>
                <label class="col-sm-1 control-label">CGST Amt</label>
                <div class="col-sm-1">
                    @Html.TextBoxFor(x => x.CGSTAmt, new { @class = "form-control", @id = "addCGSTAmt", @Name = "addCGSTAmt" })
                </div>
            </div>
            <div class="form-group">
                <label class="col-sm-1 control-label">SGST Rate</label>
                <div class="col-sm-1">
                    @Html.TextBoxFor(x => x.SGSTRate, new { @class = "form-control", @id = "addSGSTRate", @Name = "addSGSTRate" })
                </div>
                <label class="col-sm-1 control-label">SGST Amt</label>
                <div class="col-sm-1">
                    @Html.TextBoxFor(x => x.SGSTAmt, new { @class = "form-control", @id = "addSGSTAmt", @Name = "addSGSTAmt" })
                </div>
            </div>
        </div>*@
            <script>
            $(document).ready(function ()
            {
                loadTDSCodeList();

                $('#addTDSCode').change(function () {
                    var url = '@Url.Action("GetTDSRateDetail")?TDSCode=' + $('#addTDSCode').val() + '&DocuDate=' + $('#DocuDate').val();
                    $.ajax({
                        type: "GET",
                        dataType: "json",
                        cache: false,
                        url: url,
                        contentType: "application/json;charset=utf-8",
                        beforeSend: function () {
                            $('.spinner').show();
                        },
                        success: function (data) {
                            $('.spinner').hide();
                            $('#addTDSRate').val(data.TDSRate);
                            TDSCalculation();
                        },
                        error: function () {
                            alert("Error occured while processing your request.");
                        }
                    });
                });
                $('#addTDSRate').focusout(function () {
                    TDSCalculation()
                });


            });

            function TDSCalculation()
            {
                debugger;
                $("#addTDSAmt").val(0);

                if ($('#addTDSFlag').is(":checked")) {
                    var rate1 = (parseFloat($("#addTDSRate").val()));
                    var amt1 = parseFloat($("#addTaxable").val());
                    var AmtTDS = (rate1 * amt1) / 100;
                    $('#addTDSAmt').val(AmtTDS);
                    $('#TDSAmt').val(AmtTDS);
                }
                else {
                    $('#addTDSAmt').val(0);
                    $('#TDSAmt').val(0);
                }


            }

            function loadTDSCodeList() {
                var url = '@Url.Action("GetTDSList")'
                $('#addTDSCode').select2({
                    minimumInputLength: 0,
                    placeholder: 'Search',
                    ajax: {
                        url: url,
                        dataType: 'json',
                        quietMillis: 100,
                        enableFiltering: true,
                        allowClear: true,
                        minimumInputLength: 0,
                        multiple: true,
                        width: 300,
                        data: function (term, page) {
                            return {
                                types: ["exercise"],
                                limit: -1,
                                term: term
                            };
                        },
                        results: function (data, page) {
                            clientObj = JSON.stringify(data);
                            return {
                                results: $.map(data, function (item) {
                                    return {
                                        text: item.Name,
                                        id: item.Code
                                    }
                                })
                            };
                        }
                    },
                    initSelection: function (element, callback) {
                        var data = { id: '@Model.TDSCode', text: '@Model.TDSCodeName' };
                        callback(data);
                    },
                    formatResult: function (exercise) {
                        return "<div class='row-fluid'><div class=''><span class='span1'><div style='color:" + exercise.alias + "'>" + exercise.text +
                            "</div></span></div></div>";
                    },
                    formatSelection: function (exercise) {
                        return "<div class='row-fluid'><div class=''><span class='span1'><div style='color:" + exercise.alias + "'>" + exercise.text +
                            "</div></span></div></div>";
                    },
                })
            };

            function openCity(evt, cityName) {
                $("#ErrorMessage1").hide();
                var i, tabcontent, tablinks;
                tabcontent = document.getElementsByClassName("tabcontent");
                for (i = 0; i < tabcontent.length; i++) {

                    tabcontent[i].style.display = "none";
                }
                tablinks = document.getElementsByClassName("tablinks");
                for (i = 0; i < tablinks.length; i++) {

                    tablinks[i].className = tablinks[i].className.replace(" active", "");
                }
                document.getElementById(cityName).style.display = "block";
                evt.currentTarget.className += " active";
            }
            document.getElementById("List").click();
            </script>
        </div>
    </div>
</section>

<div class="footer-section" style="position:fixed;background-color:whitesmoke;padding:2px;color:unset;height:70px;border:solid 1px black;">
    <div class="row" style="padding-top:2px;">

        <label class="col-sm-1 control-label" style="padding-top:4px;padding-left:20px;">Taxable:</label>
        <div class="col-sm-1">
            <input type="text" id="txttottxable" alt="" class="form-control" style="width:90px;text-align:right;font-weight:bold;border-color:gray;background-color:lightgray;" disabled="disabled" />
        </div>
        <label class="col-sm-1 control-label" style="padding-top:4px;padding-left:0px;padding-right:0px;width:7.33%;">TDS Amt:</label>
        <div class="col-sm-1">
            @Html.TextBoxFor(x => x.TDSAmt, new { @style = "width:90px;text-align:right;font-weight:bold;border-color:gray;background-color:lightgray;", @type = "number", @class = "form-control", @id = "TDSAmt", @name = "TDSAmt", @disabled = "disabled", @Value = @Model.TDSAmt })
        </div>
        <label class="col-sm-1 control-label" id="igstfootlbl" style="padding-top:4px;padding-left:0px;padding-right:0px;width:7.33%;">IGST Amt:</label>
        <div class="col-sm-1">
            <input type="text" id="txttotigst" alt="" class="form-control" style="width:90px;text-align:right;font-weight:bold;border-color:gray;background-color:lightgray;" disabled="disabled" />
        </div>
        <label class="col-sm-1 control-label" id="sgstfootlbl" style="padding-top:4px;padding-left:0px;padding-right:0px;width:7.33%;">SGST Amt:</label>
        <div class="col-sm-1">
            <input type="text" id="txttotsgst" alt="" class="form-control" style="width:90px;text-align:right;font-weight:bold;border-color:gray;background-color:lightgray;" disabled="disabled" />
        </div>
        <label class="col-sm-1 control-label" id="cgstfootlbl" style="padding-top:4px;padding-left:0px;padding-right:0px;width:7.33%;">CGST Amt:</label>
        <div class="col-sm-1">
            <input type="text" id="txttotcgst" alt="" class="form-control" style="width:90px;text-align:right;font-weight:bold;border-color:gray;background-color:lightgray;" disabled="disabled" />
        </div>
        <label class="col-sm-1 control-label" style="padding-top:4px;padding-left:0px;padding-right:0px;width:7.33%;">Inv.Amount:</label>
        <div class="col-sm-1">
            <input type="text" id="txtinvamt" alt="" class="form-control" style="width:130px;border-color:black;background-color:gray;color:white;text-align:right;font-size:11pt;font-weight:bolder;" disabled="disabled" />
        </div>
    </div>
</div>

<footer id="fixedbottom" class="footer-section" style="height:33px;position:fixed;background-color:#4B4A4A;padding:3px;color:white;">
    <div class="row">
        <div class="col-sm-5">
            @*<button class="btn btn-info" id="btnAddNote" style="background-color: #b6dd1a;color: #0044cc;border-color: #b6dd1a;font-size: 13px;padding:3px 12px;" name="Command">Add Note</button>*@
            <button class="btn btn-warning" style="color:black;" id="btnAddDoc">Attachment</button>
        </div>
        <div class="col-sm-3" style="margin-top:4px;color:white;font-family:Verdana;font-size:11px;">
            T.FAT ERP-iX9, Suchan Software Private Limited
        </div>
        <div class="col-sm-4">
            <div class="pull-right">
                @if (Model.Mode != "Add")
                {
                    @*<button class="btn btn-success" style="font-size: 13px;padding:3px 12px;" id="btnPrintOnly" data-toggle="tooltip" data-placement="top" title="Print Only">Print Only</button>*@
                }
                @if (Model.Mode == "Edit" || Model.Mode == "Add")
                {
                    @*<button class="btn btn-success" style="color:black;font-size:13px;padding:3px 12px;" id="SavePrint">Save and Print</button>*@
                    <button class="btn btn-success" style="color:black;font-size:13px;padding:3px 12px;" id="SaveData">Save</button>
                }

                @if (Model.Mode == "Delete")
                {
                    <button class="btn btn-success" style="color:black;font-size:13px;padding:3px 12px;" id="DeleteData">Delete</button>
                }
                @if (Model.LedgerThrough)
                {
                    <a href="" onclick="window.top.close();" class="btn btn-danger" style="color:black;margin-right:10px;font-size:13px;padding:3px 12px;" id="Cancel">Cancel</a>
                }
                else
                {
                    <a href="~/Accounts/MasterGrid?Type=@Model.Type&Module=@Model.Module&ViewDataId=@Model.ViewDataId&TableName=@Model.TableName&Header=@Model.Header&optiontype=@Model.OptionType&OptionCode=@Model.OptionCode&MainType=@Model.MainType&SubType=@Model.SubType&Controller2=@Model.Controller2" class="btn btn-danger" style="color:black;margin-right:10px;font-size:13px;padding:3px 12px;" id="Cancel">Cancel</a>
                }
            </div>
        </div>
    </div>
</footer>


<div class="example-modal">
    <div id="ledpostmodel" class="modal modal-primary" style="margin-top:1%!important;">
        <div class="modal-dialog" style="width:700px;">
            <div id="ledpostingmodel">
                @Html.Partial("LedgerPosting")
            </div>
        </div>
    </div>
</div>

@*Suchan Attachment*@
<div class="example-modal">
    @*<div id="attachdoc" class="modal modal-primary" style="z-index:2500;">*@
    <div id="attachdoc" class="modal modal-primary" style="margin-top:3%;width: 100%;display: block;" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="false">
        <div class="modal-dialog" style="width:100%;">
            <div id="AttachDoc">
            </div>
        </div>
    </div>
</div>

@*Print Option*@
<div class="example-modal">
    <div id="printpostmodel" class="modal modal-primary" style="margin-top:1%;">
        <div class="modal-dialog" style="width:700px;">
            <div id="Printmodel">
                @Html.Partial("ReportPrintOptions")
            </div>
        </div>
    </div>
</div>

<!--Only Alert Note Modal -->
<div class="example-modal">
    <div id="AlertNoteModal" class="modal modal-primary" style="z-index:2500;">
        <div class="modal-dialog" style="width:100%;">
            <div class="modal-body">
                <div class="modal-content">
                    <div class="modal-header" style="background-color:#cccccc;padding-top:5px;">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                        <h4 class="modal-title"><b>Alert Note System</b></h4>
                    </div>
                    <div class="modal-body">
                        <div class="form-group" id="OnlyAlertNoteDiv" style="min-height:430px;max-height:430px;overflow:auto;">

                        </div>
                    </div>
                    <div class="modal-footer" style="background-color:#cccccc;height:42px;padding-bottom:5px;padding-top:5px;border-radius: 0px 0px 5px 5px;">
                        <button data-dismiss="modal" class="btn btn-danger" type="button">Close</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!--Alert/Note Modal -->
<div class="example-modal">
    <div id="addnotemodel" class="modal modal-primary" style="z-index:2500;">
        <div class="modal-dialog" style="width:100%;">
            <div class="modal-body">
                <div class="modal-content">
                    <div class="modal-header" style="background-color:#cccccc;padding-top:5px;">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                        <h4 class="modal-title"><b>Alert Note System</b></h4>
                    </div>
                    <div class="modal-body">
                        <div class="form-group" id="AlertAlertNoteDiv" style="min-height:430px;max-height:430px;overflow:auto;">

                        </div>
                        <div class="form-group hidden" id="AddAlertNoteDiv" style="min-height:430px;max-height:430px;overflow:auto;">

                        </div>
                    </div>
                    <div class="modal-footer" style="background-color:#cccccc;height:42px;padding-bottom:5px;padding-top:5px;border-radius: 0px 0px 5px 5px;">
                        <button class="btn btn-success" type="button" id="btnAddNarr">Add Narration</button>
                        <button class="btn btn-info hidden" type="button" id="btnNarrList">Show List</button>
                        <button class="btn btn-success hidden" type="button" id="btnNarrSave">Save</button>
                        <button data-dismiss="modal" class="btn btn-danger" type="button">Close</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


@Html.HiddenFor(x => x.MainType, new { @id = "hdnMainType" })
@Html.HiddenFor(x => x.SubType, new { @id = "hdnSubType" })
@Html.HiddenFor(x => x.Type, new { @id = "hdnType" })
@Html.HiddenFor(x => x.Document, new { @id = "hdnDocument" })
@Html.HiddenFor(x => x.ParentKey, new { @id = "hdnParentKey" })
@Html.HiddenFor(x => x.Prefix, new { @id = "hdnPrefix" })
@Html.HiddenFor(x => x.Srl, new { @id = "EdithdnSrl" })
@Html.HiddenFor(x => x.Mode, new { @id = "hdnMode" })
@Html.HiddenFor(x => x.ShowLedgerPost, new { @id = "hdnShowLedgerPost" })
@*@Html.HiddenFor(x => x.CCAmtMatch, new { @id = "hdnCCAmtMatch" })*@
@Html.HiddenFor(x => x.BackDays, new { @id = "hdnBackDays" })
@Html.HiddenFor(x => x.BackDated, new { @id = "hdnBackDated" })
@Html.HiddenFor(x => x.DuplExpLRFMConfirm, new { @id = "hdnDuplExpLRFMConfirm" })
@Html.HiddenFor(x => x.NoDuplExpLRFM, new { @id = "hdnNoDuplExpLRFM" })
@Html.HiddenFor(x => x.OTGenerate, new { @id = "hdnOTGenerate" })
@Html.HiddenFor(x => x.BillAuto, new { @id = "hdnBillAuto" })
@Html.HiddenFor(x => x.BillBoth, new { @id = "hdnBillBoth" })
@Html.HiddenFor(x => x.ForwardDated, new { @id = "hdnForwardDated" })
@Html.HiddenFor(x => x.ForwardDays, new { @id = "hdnForwardDays" })
@Html.HiddenFor(x => x.StartDate, new { @id = "hdnStartDate" })
@Html.HiddenFor(x => x.EndDate, new { @id = "hdnEndDate" })
@Html.HiddenFor(x => x.AllowZeroAmt, new { @id = "hdnAllowZeroAmt" })
@Html.HiddenFor(x => x.ShowDocSerial, new { @id = "hdnShowDocSerial" })

@Html.HiddenFor(x => x.NoDuplExpDt, new { @id = "hdnNoDuplExpDt" })
@Html.HiddenFor(x => x.DuplExpDtConfirm, new { @id = "hdnDuplExpDtConfirm" })
@Html.HiddenFor(x => x.Branch, new { @id = "hdnBranch" })
@Html.HiddenFor(x => x.BTNNO, new { @id = "hdnBTNNO" })
@Html.HiddenFor(x => x.BTNNOCombo, new { @id = "hdnBTNNOCombo" })
@Html.HiddenFor(x => x.BTNBalAmt, new { @id = "hdnBTNBalAmt" })
@Html.HiddenFor(x => x.BTNTotalAmt, new { @id = "hdnBTNTotalAmt" })
@Html.HiddenFor(x => x.ConsignmentKey)
@Html.HiddenFor(x => x.FreightMemoKey)

<!--Consignment Multi Document Modal -->
<div class="example-modal">
    <div id="ConsignmentModels" class="modal modal-primary" style="z-index:2500;">
        <div class="modal-dialog" style="width:100%;">
            <div id="consignmentmodels">
            </div>
        </div>
    </div>
</div>
<!--Freight Memo Multi Document Modal -->
<div class="example-modal">
    <div id="FreightMemoModels" class="modal modal-primary" style="z-index:2500;">
        <div class="modal-dialog" style="width:100%;">
            <div id="freightmemomodels">
            </div>
        </div>
    </div>
</div>