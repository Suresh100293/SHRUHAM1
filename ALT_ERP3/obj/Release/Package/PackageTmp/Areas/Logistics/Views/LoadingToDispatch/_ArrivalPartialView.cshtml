@model ALT_ERP3.Areas.Logistics.Models.LoadingToDispatchVM
@{
    Layout = null;
}
<style>
    td, th {
        padding: 4px !important;
    }

    .Ordertable {
        display: table;
    }

    .Ordertable-row {
        display: table-row;
        color: black;
    }

    .Ordertable-cell {
        display: table-cell;
        border: 1px solid black;
        padding: 5px;
        /*text-align: center;*/
    }


    .otherBranch {
        background-color: #d690aa;
    }

    .ClickrowColor {
        background-color: #71a1af !important;
        color: black;
    }

    /*.inputColor{
        color:black;
    }*/
    input[type=text] {
        color: black !important;
    }

    .span6 {
        display: none !important;
    }
</style>
<script src="@Url.Content("~/Content/js/jquery.validate.min.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Content/js/jquery.constrain.js")" type="text/javascript"></script>
<script type="text/javascript">
    $(document).ready(function () {
        //var Table = $('#tblArrival').DataTable();
        //Table.order([0, 'asc']).draw();

        $('tblArrival').dataTable({
            // display everything
            "iDisplayLength": -1
        });

        //$('#tblArrival').DataTable({
        //    "aoColumns": [
        //        null,
        //        null,
        //        null,
        //        null,
        //        null,
        //        null,
        //        null,
        //        null,
        //        { "orderSequence": ["asc"] }
        //    ]
        //});
        $('.ArrivalDate').datepicker({
            format: 'dd/mm/yyyy',
            changeMonth: true,
            changeYear: true,
            yearRange: "-60:+0",
            autoclose: true,
        });

        var date = "", time = "", km = "", remark = "";
        $('.addbtn').click(function () {
            
            var Row = $(this).closest('tr');
            Row.find(".addbtn").prop("disabled", true);
            Row.find(".editrow").addClass("hidden");
            Row.find(".Cancelrow").removeClass("hidden");
            Row.find(".btnSave").prop("disabled", false);

            date = Row.find(".ArrivalDate").val();
            time = Row.find(".ArrivalTime").val();
            km = Row.find(".ArrivalKM").val();
            remark = Row.find("#item_ArrivalRemark").val();

            //$(".addbtn").prop("disabled", true);
            //$(".editrow").addClass("hidden");
            //$(".Cancelrow").removeClass("hidden");
            //$("#btnFMArrival").prop("disabled", false);

            Row.find(".ArrivalDate").prop("disabled", false);
            Row.find(".ArrivalDate").val('@DateTime.Now.ToShortDateString()');
            Row.find(".ArrivalDate").datepicker("setDate", Row.find(".ArrivalDate").val());
            //$("#ArrivalDate").prop("disabled", false);
            //$("#ArrivalDate").val('@DateTime.Now.ToShortDateString()');
            //$("#ArrivalDate").datepicker("setDate", $("#ArrivalDate").val());
            Row.find(".ArrivalTime").prop("disabled", false);
            Row.find(".ArrivalTime").val('@DateTime.Now.ToString("HH:mm")');
            //$("#ArrivalTime").prop("disabled", false);
            //$("#ArrivalTime").val('@DateTime.Now.ToString("HH:mm")');
            Row.find(".ArrivalKM").prop("disabled", false);
            //$("#ArrivalKM").prop("disabled", false);
            Row.find("#item_ArrivalRemark").prop("disabled", false);
            //$("#ArrivalRemark").prop("disabled", false);

        });

        $('.Cancelrow').click(function () {
            $("#ErrorMessageLC").hide();
            var Row = $(this).closest('tr');
            if (Row.find('.addbtn').length > 0)
            {
                Row.find(".addbtn").prop("disabled", false);
                //$(".addbtn").prop("disabled", false);
            } else
            {
                Row.find("#item_btnFMArrivalDelete").prop("disabled", false);
                //$("#btnFMArrivalDelete").prop("disabled", false);
            }
            Row.find(".editrow").removeClass("hidden");
            //$(".editrow").removeClass("hidden");
            Row.find(".Cancelrow").addClass("hidden");
            //$(".Cancelrow").addClass("hidden");
            Row.find(".btnSave").prop("disabled", true);
            //$("#btnFMArrival").prop("disabled", true);

            Row.find(".ArrivalDate").prop("disabled", true);
            Row.find(".ArrivalDate").val(date);
            //$("#ArrivalDate").prop("disabled", true);
            //$("#ArrivalDate").val('');
            Row.find(".ArrivalTime").prop("disabled", true);
            Row.find(".ArrivalTime").val(time);
            //$("#ArrivalTime").prop("disabled", true);
            //$("#ArrivalTime").val('');
            Row.find(".ArrivalKM").prop("disabled", true);
            Row.find(".ArrivalKM").val(km);
            //$("#ArrivalKM").prop("disabled", true);
            //$("#ArrivalKM").val('');
            Row.find("#item_ArrivalRemark").prop("disabled", true);
            Row.find("#item_ArrivalRemark").val(remark);
            //$("#ArrivalRemark").prop("disabled", true);
            //$("#ArrivalRemark").val('');
        });

        $('.editrow').click(function () {
            var Row = $(this).closest('tr');

            date = Row.find(".ArrivalDate").val();
            time = Row.find(".ArrivalTime").val();
            km = Row.find(".ArrivalKM").val();
            remark = Row.find("#item_ArrivalRemark").val();

            Row.find(".editrow").addClass("hidden");
            //$(".editrow").addClass("hidden");
            Row.find(".Cancelrow").removeClass("hidden");
            //$(".Cancelrow").removeClass("hidden");
            Row.find("#item_btnFMArrivalDelete").prop("disabled", true);
            //$("#btnFMArrivalDelete").prop("disabled", true);
            Row.find(".btnSave").prop("disabled", false);
            //$("#btnFMArrival").prop("disabled", false);

            Row.find(".ArrivalDate").prop("disabled", false);
            Row.find(".ArrivalDate").datepicker("setDate", Row.find(".ArrivalDate").val());
            //$("#ArrivalDate").prop("disabled", false);
            Row.find(".ArrivalTime").prop("disabled", false);
            //$("#ArrivalTime").prop("disabled", false);
            Row.find(".ArrivalKM").prop("disabled", false);
            //$("#ArrivalKM").prop("disabled", false);
            Row.find("#item_ArrivalRemark").prop("disabled", false);
            //$("#ArrivalRemark").prop("disabled", false);
        });
        $('.btnSave').click(function (event) {
            debugger;
            event.preventDefault();
            var Row = $(this).closest('tr');
            debugger;
            $("#ErrorMessageLC").hide();

            if (Row.find(".ArrivalDate").val() == '') {
                $("#ErrorMessageLC").show();
                $("#ErrorMessageLC").text('Date Required..');
                return;
            }
            if (Row.find(".ArrivalTime").val() == '') {
                $("#ErrorMessageLC").show();
                $("#ErrorMessageLC").text('Time Required..');
                return;
            }
            if (Row.find(".ArrivalKM").val() == '' || Row.find(".ArrivalKM").val() == '0') {
                $("#ErrorMessageLC").show();
                $("#ErrorMessageLC").text('KM Required..');
                return;
            }

            var url = '/Logistics/Arrival/SaveData';
            @* iX9: Data from individual field is passed on to the Model and then to Controller for Saving *@
            var ModelData = {};
            ModelData["Document"] = Row.find(".FmRouteArrivalReco").text();
            ModelData["ArrivalDate"] = Row.find(".ArrivalDate").val();
            ModelData["ArrivalTime"] = Row.find(".ArrivalTime").val();
            ModelData["ArrivalKM"] = Row.find(".ArrivalKM").val();
            ModelData["ArrivalRemark"] = Row.find("#item_ArrivalRemark").val();

            var DTO = { mModel: ModelData };
            $.ajax({
                type: "POST",
                dataType: "json",
                data: JSON.stringify(DTO),
                cache: false,
                url: url,
                contentType: "application/json; charset=utf-8",
                beforeSend: function () {
                    $('.spinner').show();
                },
                success: function (data) {
                    if (data.Status == 'Success') {
                        $('.spinner').hide();
                        //$("#NotificationMsg").text("Arrived Sucessfully");
                        //$("#myProgress").show();
                        //move();
                        $("#ErrorMessageLC").hide();
                        ArrivalPartial();
                    }
                    else {
                        $('.spinner').hide();
                        alert(data.Message);
                        $('.spinner').hide();

                    }
                },
            });
        });

        $('.btnFMArrivalDelete').click(function (event) {
            event.preventDefault();
            var Row = $(this).closest('tr');
            $("#ErrorMessageLC").hide();
            var url = '/Logistics/Arrival/DeleteData';
            @* iX9: Data from individual field is passed on to the Model and then to Controller for Saving *@
            var ModelData = {};
            ModelData["Document"] = Row.find(".FmRouteArrivalReco").text();
            var DTO = { mModel: ModelData };

            var result = confirm("R U Sure You Want To Delete?");
            if (result) {
                $.ajax({
                    type: "POST",
                    dataType: "json",
                    data: JSON.stringify(DTO),
                    cache: false,
                    url: url,
                    contentType: "application/json; charset=utf-8",
                    beforeSend: function () {
                        $('.spinner').show();
                    },
                    success: function (data) {
                        if (data.Status == 'Success') {
                            $('.spinner').hide();
                            $("#ErrorMessageLC").hide();
                            //location.reload();
                            ArrivalPartial();
                        }
                        else {
                            $('.spinner').hide();
                            alert(data.Message);
                        }
                    },
                });
            }
        });
    });
</script>

@if (Model.ArrivalList.Count > 0)
{
    <div class="container-fluid" style="margin-top:8px;padding-left:0px;">
        <table id="tblArrival" class="table-bordered example" style="width:100%!important;">
            <thead>
                <tr>
                    <th style="width: 10px;">Area</th>
                    <th style="width: 10px;">Add</th>
                    <th style="width: 10px;">Edit</th>
                    <th style="width: 10px;">Save</th>
                    <th style="width: 75px;">Date</th>
                    <th style="width: 75px;">Time</th>
                    <th style="width: 75px;">Km </th>
                    <th>Remark</th>
                    <th class="hidden">Recordkey</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in Model.ArrivalList.OrderBy(x=>x.RecordKey))
                {
                    <tr>
                        <td class="ArrivalArea">@item.AreaNameOf_A_D</td>
                        
                        @if (String.IsNullOrEmpty(item.ArrivalDate))
                        {
                            <td style="width: 10px;">
                                <center>
                                    <button class="btn btn-primary addbtn" id="" style="font-size: 10px;padding:3px 13px;"><i class="glyphicon glyphicon-plus" style="font-size: 1.2em;"></i></button>
                                </center>
                            </td>
                            <td style="width: 10px;">
                                <center>
                                    <button class="btn btn-primary editrow" disabled style="font-size: 10px;padding:3px 13px;"><i class="glyphicon glyphicon-edit" style="font-size: 1.2em;"></i></button>
                                    <button class="btn btn-danger Cancelrow hidden" style="font-size: 10px;padding:3px 13px;"><i class="glyphicon glyphicon-remove" style="font-size: 1.2em;"></i></button>
                                </center>
                            </td>
                            <td style="width: 10px;">
                                <button class="btn btn-primary btnSave" disabled id="" style="font-size: 10px;padding:3px 13px;"><i class="glyphicon glyphicon-floppy-saved" style="font-size: 1.2em;"></i></button>
                            </td>
                        }
                        else
                        {
                            <td style="width: 10px;">
                                <center>
                                    <button class="btn btn-danger btnFMArrivalDelete " id="" style="font-size: 10px;padding:3px 13px;"><i class="glyphicon glyphicon-trash" style="font-size: 1.2em;"></i></button>
                                </center>
                            </td>
                            <td style="width: 10px;">
                                <center>
                                    <button class="btn btn-primary editrow" style="font-size: 10px;padding:3px 13px;"><i class="glyphicon glyphicon-edit" style="font-size: 1.2em;"></i></button>
                                    <button class="btn btn-danger Cancelrow hidden" style="font-size: 10px;padding:3px 13px;"><i class="glyphicon glyphicon-remove" style="font-size: 1.2em;"></i></button>
                                </center>
                            </td>
                            <td style="width: 10px;">
                                <button class="btn btn-primary btnSave" disabled id="" style="font-size: 10px;padding:3px 13px;"><i class="glyphicon glyphicon-floppy-saved" style="font-size: 1.2em;"></i></button>
                            </td>
                        }

                        <td>
                            <input type="text" class="form-control ArrivalDate" style="width:100px;" value="@item.ArrivalDate" disabled />
                            @*@Html.TextBoxFor(x => item.ArrivalDate, new { @class = "form-control", @Value = item.ArrivalDate, @style = "width:100px;", @disabled = "disabled" })*@
                        </td>
                        <td>
                            <input type="time" class="form-control ArrivalTime" style="width:100px;" value="@item.ArrivalTime" disabled />
                            @*@Html.TextBoxFor(x => item.ArrivalTime, new { @class = "form-control", @type = "time", @style = "width:100px;", @Value = item.ArrivalTime, @disabled = "disabled" })*@
                        </td>
                        <td>
                            <input type="text" class="form-control ArrivalKM" style="width:100px;" value="@item.ArrivalKM" disabled />
                            @*@Html.TextBoxFor(x => item.ArrivalKM, new { @class = "form-control", @style = "width:100px;", @Value = item.ArrivalKM, @disabled = "disabled" })*@
                        </td>
                        <td>
                            @*<textarea type="text" class="form-control ArrivalRemark" style="width:100%;" value="@item.ArrivalRemark" rows="1" maxlength="100" disabled />*@
                            @Html.TextAreaFor(x => item.ArrivalRemark, new { @class = "form-control", @style = "width:100%;", @rows = "1", @maxlength = "100", @Value = item.ArrivalRemark, @disabled = "disabled" })
                        </td>
                        <td class=" FmRouteArrivalReco hidden">@item.RecordKey</td>
                    </tr>
                }

            </tbody>
        </table>
    </div>
}
