@model ALT_ERP3.Areas.Logistics.Models.EwayBillVM
@using Common;
@{
    ViewBag.Title = "LRSetupVM";
    Layout = null;
}
<script src="@Url.Content("~/Content/js/jquery.validate.min.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Content/js/jquery.constrain.js")" type="text/javascript"></script>
<style>
    textarea {
        resize: none;
    }
</style>
<script type="text/javascript">
    $(document).ready(function () {
        $("#EXT_Distance,#EXT_ConsignorPincode").constrain({ allow: { regex: "[0-9]" } });

        if ('@Model.EWB_VehicleNoTxt'!='') {
            $("#EXT_rdbtnVehicle").prop("checked", true);
            $(".EXT_MasterVehicle").addClass("hidden");
            $(".EXT_ManualVehicle").removeClass("hidden");
        }
        $('#EXT_DocDate').datepicker({
            format: 'dd/mm/yyyy',
            changeMonth: true,
            changeYear: true,
            yearRange: "-60:+0",
            autoclose: true,
        });
        $("#EXT_rdbtnVehicle").change(function () {
            if (this.checked) {
                $(".EXT_MasterVehicle").addClass("hidden");
                $(".EXT_ManualVehicle").removeClass("hidden");
            }
            else {
                $(".EXT_MasterVehicle").removeClass("hidden");
                $(".EXT_ManualVehicle").addClass("hidden");
            }

        });
        $("#EXT_FromPlace").change(function () {
            var url = '@Url.Action("FetBranchState")';
            $.ajax({
                type: "POST",
                traditional: true,
                url: url,
                data: { Branch: $("#EXT_FromPlace").val() },
                success: function (result) {
                    $('#EXT_ConsignorState').select2('data', { id: result.StateCode, text: result.StateName });
                    if (result.Pin != "") {
                        $("#EXT_ConsignorPincode").val(result.Pin);
                    }

                }
            });
        });
        EXTLoadVehicle();
        EXTLoadFromPlace();
        EXTLoadConsignorState();
        EXTloadConsignmentCode();
        EXTloadTRNType();
        EXTloadTRNModeGEN();
        EXTloadExtendReasonCode();

        $("#btnExtEway").click(function (event) {
            event.preventDefault();

            if ($("#EXT_DocDate").val() == '' || $("#EXT_DocDate").val() == null) {
                alert('Doc Date is required...!');
                return;
            }
            if ($("#EXT_EWBDocument").val() == '' || $("#EXT_EWBDocument").val() == null) {
                alert('EWB Document is required...!');
                return;
            }

            if ($("#EXT_TRNMode").val() == '' || $("#EXT_TRNMode").val() == null) {
                alert('Tran Mode is required...!');
                return;
            }
            else
            {
                if ($("#EXT_TRNMode").val() == '1')
                {
                    if ($("#EXT_rdbtnVehicle").is(':checked'))
                    {
                        if ($("#EXT_VehicleNoTxt").val() == '' || $("#EXT_VehicleNoTxt").val() == null) {
                            alert('VehicleNo is required...!');
                            return;
                        }
                    }
                    else
                    {
                        if ($("#EXT_VehicleNo").val() == '' || $("#EXT_VehicleNo").val() == null) {
                            alert('VehicleNo is required...!');
                            return;
                        }
                    }
                }
            }

            if ($("#EXT_Distance").val() == '' || $("#EXT_Distance").val() == null) {
                alert('Remain KM is required...!');
                return;
            }
            else {
                if (parseInt($("#EXT_Distance").val()) == 0) {
                    alert('Remain KM is required...!');
                    return;
                }
                else
                {
                    if (parseInt($("#EXT_Distance").val()) > 4000) {
                        alert('Remain KM Not Allow More Than 4000...!');
                        return;
                    }
                }
            }
            if ($("#EXT_FromPlace").val() == '' || $("#EXT_FromPlace").val() == null) {
                alert('From Place is required...!');
                return;
            }
            if ($("#EXT_ConsignorState").val() == '' || $("#EXT_ConsignorState").val() == null) {
                alert('From State is required...!');
                return;
            }
            if ($("#EXT_ConsignorPincode").val() == '' || $("#EXT_ConsignorPincode").val() == null) {
                alert('PinCode is required...!');
                return;
            }

            if ($("#EXT_ConsignmentCode").val() == '' || $("#EXT_ConsignmentCode").val() == null) {
                alert('Consign Is : is required...!');
                return;
            }

            if ($("#EXT_TRNType").val() == '' || $("#EXT_TRNType").val() == null) {
                alert('Tran Type is required...!');
                return;
            }
            if ($("#EXT_TRNMode").val() == '' || $("#EXT_TRNMode").val() == null) {
                alert('Tran Mode is required...!');
                return;
            }
            if ($("#EXT_ExtendReasonCode").val() == '' || $("#EXT_ExtendReasonCode").val() == null) {
                alert('Exten Code is required...!');
                return;
            }

            var url = '@Url.Action("ExtendEWayBill")';
            var ModelData = {};
            ModelData["Document"] = $("#ConsignmentKey").val();
            ModelData["SearchEway"] = $("#EXTSearchEway").val();
            ModelData["DocDate"] = $("#EXT_DocDate").val();
            ModelData["EWBDocument"] = $("#EXT_EWBDocument").val();

            ModelData["EWB_EwayNo"] = $("#EXT_EwayNo").val();
            if ($("#EXT_rdbtnVehicle").is(':checked')) {
                ModelData["EWB_VehicleNo"] = $("#EXT_VehicleNoTxt").val();
            } else {
                ModelData["EWB_VehicleNo"] = $("#EXT_VehicleNo").val();
            }
            ModelData["EWB_Distance"] = $("#EXT_Distance").val();
            ModelData["EWB_FromPlace"] = $("#EXT_FromPlace").val();
            ModelData["EWB_ConsignorState"] = $("#EXT_ConsignorState").val();
            ModelData["EWB_ConsignorPincode"] = $("#EXT_ConsignorPincode").val();
            ModelData["EWB_ConsignmentCode"] = $("#EXT_ConsignmentCode").val();
            ModelData["EWB_TRNType"] = $("#EXT_TRNType").val();
            ModelData["EWB_TRNMode"] = $("#EXT_TRNMode").val();
            ModelData["EWB_ExtendReasonCode"] = $("#EXT_ExtendReasonCode").val();
            ModelData["EWB_ReasonRemark"] = $("#EXT_ReasonRemark").val();

            var DTO = { Model: ModelData };
            $.ajax({
                type: "POST",
                dataType: "json",
                data: JSON.stringify(DTO),
                cache: false,
                url: url,
                contentType: "application/json; charset=utf-8",
                beforeSend: function () {
                    $('.spinner').show();
                },
                success: function (data) {
                    $('.spinner').hide();
                    if (data.Status == 'Success') {
                        alert(data.errormsg);
                        location.reload();
                    }
                    else {
                        alert(data.errormsg);
                    }
                },
            });
        });

    });
    function EXTLoadVehicle() {

        var url = '@Url.Action("GetVehicle")'
        $('#EXT_VehicleNo').select2({
            minimumInputLength: 0,
            placeholder: 'Search',
            ajax: {
                url: url,
                dataType: 'json',
                quietMillis: 100,
                enableFiltering: true,
                allowClear: true,
                minimumInputLength: 0,
                multiple: true,
                width: 300,
                data: function (term, page) {
                    return {
                        types: ["exercise"],
                        limit: -1,
                        term: term,
                    };
                },
                results: function (data, page) {
                    clientObj = JSON.stringify(data);
                    return {
                        results: $.map(data, function (item) {
                            return {
                                text: item.Name,
                                id: item.Code
                            }
                        })
                    };
                }
            },

            initSelection: function (element, callback) {
                var data = { id: '@Model.EWB_VehicleNo', text: '@Model.EWB_VehicleName' };
                callback(data);
            },

            formatResult: function (exercise) {
                return "<div class='row-fluid'><div class=''><span class='span1'><div style='color:" + exercise.alias + "'>" + exercise.text +
                    "</div></span></div></div>";
            },

            formatSelection: function (exercise) {
                return "<div class='row-fluid'><div class=''><span class='span1'><div style='color:" + exercise.alias + "'>" + exercise.text +
                    "</div></span></div></div>";
            },
        });
    };
    function EXTLoadFromPlace() {

        var url = '@Url.Action("FromPlace")'
        $('#EXT_FromPlace').select2({
            minimumInputLength: 0,
            placeholder: 'Search',
            ajax: {
                url: url,
                dataType: 'json',
                quietMillis: 100,
                enableFiltering: true,
                allowClear: true,
                minimumInputLength: 0,
                multiple: true,
                width: 300,
                data: function (term, page) {
                    return {
                        types: ["exercise"],
                        limit: -1,
                        term: term,
                    };
                },
                results: function (data, page) {
                    clientObj = JSON.stringify(data);
                    return {
                        results: $.map(data, function (item) {
                            return {
                                text: item.Name,
                                id: item.Code
                            }
                        })
                    };
                }
            },

            initSelection: function (element, callback) {
                var data = { id: '@Model.EWB_FromPlace', text: '@Model.EWB_FromPlaceName' };
                callback(data);
            },

            formatResult: function (exercise) {
                return "<div class='row-fluid'><div class=''><span class='span1'><div style='color:" + exercise.alias + "'>" + exercise.text +
                    "</div></span></div></div>";
            },

            formatSelection: function (exercise) {
                return "<div class='row-fluid'><div class=''><span class='span1'><div style='color:" + exercise.alias + "'>" + exercise.text +
                    "</div></span></div></div>";
            },
        });
    };
    function EXTLoadConsignorState() {
        var url = '@Url.Action("LoadState")'
        $('#EXT_ConsignorState').select2({
            minimumInputLength: 0,
            placeholder: 'Search',
            ajax: {
                url: url,
                dataType: 'json',
                quietMillis: 100,
                enableFiltering: true,
                allowClear: true,
                minimumInputLength: 0,
                multiple: true,
                width: 300,
                data: function (term, page) {
                    return {
                        types: ["exercise"],
                        limit: -1,
                        term: term
                    };
                },
                results: function (data, page) {
                    clientObj = JSON.stringify(data);
                    return {
                        results: $.map(data, function (item) {
                            return {
                                text: item.Name,
                                id: item.Code
                            }
                        })
                    };
                }
            },

            initSelection: function (element, callback) {
                var data = { id: '@Model.EWB_ConsignorState', text: '@Model.EWB_ConsignorStateName' };
                callback(data);
            },

            formatResult: function (exercise) {
                return "<div class='row-fluid'><div class=''><span class='span1'><div style='color:" + exercise.alias + "'>" + exercise.text +
                    "</div></span></div></div>";
            },

            formatSelection: function (exercise) {
                return "<div class='row-fluid'><div class=''><span class='span1'><div style='color:" + exercise.alias + "'>" + exercise.text +
                    "</div></span></div></div>";
            },
        })
    };
    function EXTloadConsignmentCode() {
        event.preventDefault();
        var url = '@Url.Action("GetConsignmentStatus")';
        $.ajax({
            type: 'POST',
            url: url,
            dataType: 'json',
            data: {  },
            success: function (result) {
                $("#EXT_ConsignmentCode").empty();
                $.each(result, function (i, item) {
                    $("#EXT_ConsignmentCode").append("<option value='" + item.Value + "'>" + item.Text + "</option>");
                });
                $('#EXT_ConsignmentCode').val('@Model.EWB_ConsignmentCode').attr("selected", "selected");
                $('.spinner').hide();
            },
            error: function (ex) {
                alert("Error occured while processing your request." + ex);
            }
        });
        return false;
    };
    function EXTloadTRNType() {
        event.preventDefault();
        var url = '@Url.Action("GetTrasactType")';
        $.ajax({
            type: 'POST',
            url: url,
            dataType: 'json',
            data: {  },
            success: function (result) {
                $("#EXT_TRNType").empty();
                $.each(result, function (i, item) {
                    $("#EXT_TRNType").append("<option value='" + item.Value + "'>" + item.Text + "</option>");
                });
                $('#EXT_TRNType').val('@Model.EWB_TRNType').attr("selected", "selected");
                $('.spinner').hide();
            },
            error: function (ex) {
                alert("Error occured while processing your request." + ex);
            }
        });
        return false;
    };
    function EXTloadTRNModeGEN() {
        event.preventDefault();
        var url = '@Url.Action("GetTrasactMode")';
        $.ajax({
            type: 'POST',
            url: url,
            dataType: 'json',
            data: {  },
            success: function (result) {
                $("#EXT_TRNMode").empty();
                $.each(result, function (i, item) {
                    $("#EXT_TRNMode").append("<option value='" + item.Value + "'>" + item.Text + "</option>");
                });
                $('#EXT_TRNMode').val('@Model.EWB_TRNMode').attr("selected", "selected");
                $('.spinner').hide();
            },
            error: function (ex) {
                alert("Error occured while processing your request." + ex);
            }
        });
        return false;
    };
    function EXTloadExtendReasonCode() {
        event.preventDefault();
        var url = '@Url.Action("GetExtendReasonCode")';
        $.ajax({
            type: 'POST',
            url: url,
            dataType: 'json',
            data: {  },
            success: function (result) {
                $("#EXT_ExtendReasonCode").empty();
                $.each(result, function (i, item) {
                    $("#EXT_ExtendReasonCode").append("<option value='" + item.Value + "'>" + item.Text + "</option>");
                });
                $('#EXT_ExtendReasonCode').val('@Model.EWB_ExtendReasonCode').attr("selected", "selected");
                $('.spinner').hide();
            },
            error: function (ex) {
                alert("Error occured while processing your request." + ex);
            }
        });
        return false;
    };
</script>
<div class="col-sm-12">
    <hr style="margin-top:5px!important;margin-bottom:8px!important;border:1px solid #ad2783" />
    <div class="col-sm-12" style="padding-bottom: 5px!important;">
        <label class="col-sm-1 control-label" style="color:black;font-weight:bold;">Doc Date:<span style="color:red;">*</span></label>
        <div class="col-sm-2">
            @Html.TextBoxFor(x => x.DocDate, new { @class = "form-control", @style = "width:100%;", @Value = Model.DocDate, @Name = "EXT_DocDate", @Id = "EXT_DocDate" })
        </div>
        <label class="col-sm-1 control-label" style="color:black;font-weight:bold;">EWB Document:<span style="color:red;">*</span></label>
        <div class="col-sm-2">
            @Html.TextBoxFor(x => x.EWBDocument, new { @class = "form-control", @style = "width:100%;", @Value = Model.EWBDocument, @Name = "EXT_EWBDocument", @Id = "EXT_EWBDocument" })
        </div>
    </div>
    <div class="col-sm-12" style="padding-bottom: 5px!important;">
        <label class="col-sm-1 control-label" style="color:black;font-weight:bold;">EwayBill No:<span style="color:red;">*</span></label>
        <div class="col-sm-2">
            @Html.TextBoxFor(x => x.EWB_EwayNo, new { @disabled = "disabled", @class = "form-control", @style = "width:100%;", @Value = Model.EWB_EwayNo, @Name = "EXT_EwayNo", @Id = "EXT_EwayNo" })
        </div>
        <label class="col-sm-1 control-label" style="color:black;font-weight:bold;">Manual Vehi:</label>
        <div class="col-sm-5">
            <div class="col-sm-1" style="margin:0px!important;padding:0px!important;">
                <input type="checkbox" title="Allow To Enter Manual VehicleNO" style="width:20px;height:20px;" id="EXT_rdbtnVehicle" />
            </div>
            <label class="col-sm-3 control-label" style="color:black;font-weight:bold;">Vehicle No:<span style="color:red;">*</span></label>
            <div class="col-sm-4 EXT_MasterVehicle" style="margin:0px!important;padding:0px!important;">
                @Html.TextBoxFor(x => x.EWB_VehicleNo, new {  @class = "input-large-query", @style = "width:100%;", @Value = Model.EWB_VehicleNo, @Name = "EXT_VehicleNo", @Id = "EXT_VehicleNo" })
            </div>
            <div class="col-sm-4 EXT_ManualVehicle hidden">
                @Html.TextBoxFor(x => x.EWB_VehicleNoTxt, new {  @class = "form-control", @style = "width:100%;", @Value = Model.EWB_VehicleNoTxt, @Name = "EXT_VehicleNoTxt", @Id = "EXT_VehicleNoTxt" })
            </div>
        </div>
        <label class="col-sm-1 control-label" style="color:black;font-weight:bold;">Remain KM:<span style="color:red;">*</span></label>
        <div class="col-sm-2">
            @Html.TextBoxFor(x => x.EWB_Distance, new { @class = "form-control", @style = "width:100%;", @Value = Model.EWB_Distance, @Name = "EXT_Distance", @Id = "EXT_Distance" })
        </div>
    </div>
    <div class="col-sm-12" style="padding-bottom: 5px!important;">
        <label class="col-sm-1 control-label" style="color:black;font-weight:bold;">From Place:<span style="color:red;">*</span></label>
        <div class="col-sm-2">
            @Html.TextBoxFor(x => x.EWB_FromPlace, new { @class = "input-large-query", @style = "width:100%;", @Value = Model.EWB_FromPlace, @Name = "EXT_FromPlace", @Id = "EXT_FromPlace" })
        </div>
        <label class="col-sm-1 control-label" style="color:black;font-weight:bold;">From State:<span style="color:red;">*</span></label>
        <div class="col-sm-2">
            @Html.TextBoxFor(x => x.EWB_ConsignorState, new { @class = "input-large-query", @style = "width:100%;", @Value = Model.EWB_ConsignorState, @Name = "EXT_ConsignorState", @Id = "EXT_ConsignorState" })
        </div>
        <label class="col-sm-1 control-label" style="color:black;font-weight:bold;">PinCode:<span style="color:red;">*</span></label>
        <div class="col-sm-2">
            @Html.TextAreaFor(x => x.EWB_ConsignorPincode, new { @class = "form-control", @Value = Model.EWB_ConsignorPincode, @rows = "1", @maxlength = 6, @Name = "EXT_ConsignorPincode", @Id = "EXT_ConsignorPincode" })
        </div>
    </div>
    <div class="col-sm-12" style="padding-bottom: 5px!important;">
        <label class="col-sm-1 control-label" style="color:black;font-weight:bold;">Consign Is:<span style="color:red;">*</span></label>
        <div class="col-sm-2">
            @Html.DropDownListFor(m => m.EWB_ConsignmentCode, DropdownHelper.EmptyList(), new { @class = "form-control", @Name = "EXT_ConsignmentCode", @Id = "EXT_ConsignmentCode" })
        </div>
        <label class="col-sm-1 control-label" style="color:black;font-weight:bold;">Tran Type:<span style="color:red;">*</span></label>
        <div class="col-sm-2">
            @Html.DropDownListFor(m => m.EWB_TRNType, DropdownHelper.EmptyList(), new { @class = "form-control", @Name = "EXT_TRNType", @Id = "EXT_TRNType" })
        </div>
        <label class="col-sm-1 control-label" style="color:black;font-weight:bold;">Tran Mode:<span style="color:red;">*</span></label>
        <div class="col-sm-2">
            @Html.DropDownListFor(m => m.EWB_TRNMode, DropdownHelper.EmptyList(), new { @class = "form-control", @Name = "EXT_TRNMode", @Id = "EXT_TRNMode" })
        </div>
        <label class="col-sm-1 control-label" style="color:black;font-weight:bold;">Exten Code:<span style="color:red;">*</span></label>
        <div class="col-sm-2">
            @Html.DropDownListFor(m => m.EWB_ExtendReasonCode, DropdownHelper.EmptyList(), new { @class = "form-control", @Name = "EXT_ExtendReasonCode", @Id = "EXT_ExtendReasonCode" })
        </div>
    </div>
    <div class="col-sm-12" style="padding-bottom: 5px!important;">
        <label class="col-sm-1 control-label" style="color:black;font-weight:bold;">Reason:</label>
        <div class="col-sm-11">
            @Html.TextAreaFor(x => x.EWB_ReasonRemark, new { @class = "form-control", @Value = Model.EWB_ReasonRemark, @rows = "1", @maxlength = 100, @Name = "EXT_ReasonRemark", @Id = "EXT_ReasonRemark" })
        </div>
    </div>
    <div class="col-sm-12" style="padding-bottom: 5px!important;">
        <div class="col-sm-2">
            <button class="btn btn-success" style="color:black;font-size: 13px;padding:3px 12px;" id="btnExtEway" title="Camera">Extend EwayBill</button>
        </div>
    </div>
</div>