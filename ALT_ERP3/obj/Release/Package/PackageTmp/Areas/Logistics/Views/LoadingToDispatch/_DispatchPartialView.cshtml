@model ALT_ERP3.Areas.Logistics.Models.LoadingToDispatchVM
@{
    Layout = null;
}
<style>
    td, th {
        padding: 4px !important;
    }

    .Ordertable {
        display: table;
    }

    .Ordertable-row {
        display: table-row;
        color: black;
    }

    .Ordertable-cell {
        display: table-cell;
        border: 1px solid black;
        padding: 5px;
        /*text-align: center;*/
    }


    .otherBranch {
        background-color: #d690aa;
    }

    .ClickrowColor {
        background-color: #71a1af !important;
        color: black;
    }

    /*.inputColor{
        color:black;
    }*/
    input[type=text] {
        color: black !important;
    }

    .span6 {
        display: none !important;
    }
</style>
<script src="@Url.Content("~/Content/js/jquery.validate.min.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Content/js/jquery.constrain.js")" type="text/javascript"></script>
<script type="text/javascript">
    $(document).ready(function () {
       // $('#tblDispatch').DataTable();
        $('tblDispatch').dataTable({
            // display everything
            "iDisplayLength": -1
        });
        $('.DispatchDate').datepicker({
            format: 'dd/mm/yyyy',
            changeMonth: true,
            changeYear: true,
            yearRange: "-60:+0",
            autoclose: true,
        });
        var date = "", time = "", km = "", remark = "";
        $('.daddbtn').click(function () {

            var Row = $(this).closest('tr');
            Row.find(".daddbtn").prop("disabled", true);
            Row.find(".deditrow").addClass("hidden");
            Row.find(".dCancelrow").removeClass("hidden");
            Row.find(".dbtnSave").prop("disabled", false);

            date = Row.find(".DispatchDate").val();
            time = Row.find(".DispatchTime").val();
            km = Row.find(".DispachKM").val();
            remark = Row.find("#item_DispachRemark").val();


            //$(".daddbtn").prop("disabled", true);
            //$(".deditrow").addClass("hidden");
            //$(".dCancelrow").removeClass("hidden");
            //$("#btnFMDispatch").prop("disabled", false);
            Row.find(".DispatchDate").prop("disabled", false);
            Row.find(".DispatchDate").val('@DateTime.Now.ToShortDateString()');
            Row.find(".DispatchDate").datepicker("setDate", Row.find(".DispatchDate").val());
            @*$("#DispatchDate").prop("disabled", false);
            $("#DispatchDate").val('@DateTime.Now.ToShortDateString()');
            $("#DispatchDate").datepicker("setDate", $("#DispatchDate").val());*@
            Row.find(".DispatchTime").prop("disabled", false);
            Row.find(".DispatchTime").val('@DateTime.Now.ToString("HH:mm")');
            @*$("#DispatchTime").prop("disabled", false);
            $("#DispatchTime").val('@DateTime.Now.ToString("HH:mm")');*@
            Row.find(".DispachKM").prop("disabled", false);
            //$("#DispachKM").prop("disabled", false);
            Row.find("#item_DispachRemark").prop("disabled", false);
            //$("#DispachRemark").prop("disabled", false);

        });

        $('.dCancelrow').click(function () {
            $("#ErrorMessageLC").hide();
            var Row = $(this).closest('tr');
            if (Row.find('.daddbtn').length > 0) {
                Row.find(".daddbtn").prop("disabled", false);
            } else {
                Row.find("#item_btnFMDispatchDelete").prop("disabled", false);
            }
            Row.find(".deditrow").removeClass("hidden");
            //$(".deditrow").removeClass("hidden");
            Row.find(".dCancelrow").addClass("hidden");
            //$(".dCancelrow").addClass("hidden");
            Row.find(".dbtnSave").prop("disabled", true);
            //$("#btnFMDispatch").prop("disabled", true);

            Row.find(".DispatchDate").prop("disabled", true);
            Row.find(".DispatchDate").val(date);
            //$("#DispatchDate").prop("disabled", true);
            //$("#DispatchDate").val('');
            Row.find(".DispatchTime").prop("disabled", true);
            Row.find(".DispatchTime").val(time);
            //$("#DispatchTime").prop("disabled", true);
            //$("#DispatchTime").val('');
            Row.find(".DispachKM").prop("disabled", true);
            Row.find(".DispachKM").val(km);
            //$("#DispachKM").prop("disabled", true);
            //$("#DispachKM").val('');
            Row.find("#item_DispachRemark").prop("disabled", true);
            Row.find("#item_DispachRemark").val(remark);
            //$("#DispachRemark").prop("disabled", true);
            //$("#DispachRemark").val('');
        });




        $('.deditrow').click(function () {

            var Row = $(this).closest('tr');

            date = Row.find(".DispatchDate").val();
            time = Row.find(".DispatchTime").val();
            km = Row.find(".DispachKM").val();
            remark = Row.find("#item_DispachRemark").val();

            Row.find(".deditrow").addClass("hidden");
            //$(".deditrow").addClass("hidden");
            Row.find(".dCancelrow").removeClass("hidden");
            //$(".dCancelrow").removeClass("hidden");
            Row.find("#item_btnFMDispatchDelete").prop("disabled", true);
            //$("#btnFMDispatchDelete").prop("disabled", true);
            Row.find(".dbtnSave").prop("disabled", false);
            //$("#btnFMDispatch").prop("disabled", false);

            Row.find(".DispatchDate").prop("disabled", false);
            //$("#DispatchDate").prop("disabled", false);
            Row.find(".DispatchTime").prop("disabled", false);
            //$("#DispatchTime").prop("disabled", false);
            Row.find(".DispachKM").prop("disabled", false);
            //$("#DispachKM").prop("disabled", false);
            Row.find("#item_DispachRemark").prop("disabled", false);
            //$("#DispachRemark").prop("disabled", false);
        });

        $('.dbtnSave').click(function (event) {
            event.preventDefault();
            var Row = $(this).closest('tr');
            $("#ErrorMessageLC").hide();
            if (Row.find(".DispatchDate").val() == '') {
                $("#ErrorMessageLC").show();
                $("#ErrorMessageLC").text('Dispatch Date Required..');
                return;
            }
            if (Row.find(".DispatchTime").val()== '') {
                $("#ErrorMessageLC").show();
                $("#ErrorMessageLC").text('Dispatch Time Required..');
                return;
            }
            if (Row.find(".DispachKM").val() == '' || Row.find(".DispachKM").val()== '0') {
                $("#ErrorMessageLC").show();
                $("#ErrorMessageLC").text('Dispatch KM Required..');
                return;
            }
            var url = '/Logistics/Dispatch/SaveData';
            @* iX9: Data from individual field is passed on to the Model and then to Controller for Saving *@
            var ModelData = {};
            ModelData["Document"] = Row.find(".FmRouteDispatchReco").text();
            ModelData["UpdateFmStatus"] = true;
            ModelData["DispatchTime"] = Row.find(".DispatchTime").val();
            ModelData["DispatchDate"] = Row.find(".DispatchDate").val();
            ModelData["DispachKM"] = Row.find(".DispachKM").val();
            ModelData["DispachRemark"] = Row.find("#item_DispachRemark").val();

            var DTO = { mModel: ModelData };
            $.ajax({
                type: "POST",
                dataType: "json",
                data: JSON.stringify(DTO),
                cache: false,
                url: url,
                contentType: "application/json; charset=utf-8",
                beforeSend: function () {
                    $('.spinner').show();
                },
                success: function (data) {
                    if (data.Status == 'Success') {
                        $('.spinner').hide();
                        $("#ErrorMessageLC").hide();
                        DispatchPartial();
                    }
                    else {
                        $('.spinner').hide();
                        alert(data.Message);
                    }
                },
            });
        });
        $('#btnFMDispatchDelete').click(function (event) {
            debugger;
            event.preventDefault();
            $("#ErrorMessageLC").hide();
            var Row = $(this).closest('tr');
            var url = '/Logistics/Dispatch/DeleteData';

            @* iX9: Data from individual field is passed on to the Model and then to Controller for Saving *@
            var ModelData = {};
            ModelData["Document"] = Row.find(".FmRouteDispatchReco").text();

            var DTO = { mModel: ModelData };
            var result = confirm("R U Sure You Want To Delete?");
            if (result) {
                $.ajax({
                    type: "POST",
                    dataType: "json",
                    data: JSON.stringify(DTO),
                    cache: false,
                    url: url,
                    contentType: "application/json; charset=utf-8",
                    beforeSend: function () {
                        $('.spinner').show();
                    },
                    success: function (data) {
                        if (data.Status == 'Success') {
                            $('.spinner').hide();
                            $("#ErrorMessageLC").hide();
                            //location.reload();
                            DispatchPartial();
                        }
                        else {
                            $('.spinner').hide();
                            alert(data.Message);
                            $('.spinner').hide();
                        }
                    },
                });
            }
        });

    });
</script>

@if (Model.DispatchList.Count > 0)
{
    <div class="container-fluid" style="margin-top:8px;padding-left:0px;">
        <table id="tblDispatch" class="table-bordered example" style="width:100%!important;">
            <thead>
                <tr>
                    <th style="width: 1px;">Area</th>
                    <th style="width: 10px;">Add</th>
                    <th style="width: 10px;">Edit</th>
                    <th style="width: 10px;">Save</th>
                    <th style="width: 75px;">Date</th>
                    <th style="width: 75px;">Time</th>
                    <th style="width: 75px;">Km </th>
                    <th>Remark</th>
                    <th class="hidden">Recordkey</th>

                </tr>
            </thead>
            <tbody>
                @foreach (var item in Model.DispatchList)
                {
                    <tr>
                        <td class="DispatchArea" style="width: 10px;">@item.AreaNameOf_A_D</td>
                        @if (String.IsNullOrEmpty(item.DispatchDate))
                        {
                            <td style="width: 10px;">
                                <center>
                                    <button class="btn btn-primary daddbtn" id="" style="font-size: 10px;padding:3px 13px;"><i class="glyphicon glyphicon-plus" style="font-size: 1.2em;"></i></button>
                                </center>
                            </td>
                            <td style="width: 10px;">
                                <center>
                                    <button class="btn btn-primary deditrow" disabled style="font-size: 10px;padding:3px 13px;"><i class="glyphicon glyphicon-edit" style="font-size: 1.2em;"></i></button>
                                    <button class="btn btn-danger dCancelrow hidden" style="font-size: 10px;padding:3px 13px;"><i class="glyphicon glyphicon-remove" style="font-size: 1.2em;"></i></button>
                                </center>
                            </td>
                            <td style="width: 10px;">
                                <button class="btn btn-primary dbtnSave" disabled id="" style="font-size: 10px;padding:3px 13px;"><i class="glyphicon glyphicon-floppy-saved" style="font-size: 1.2em;"></i></button>
                            </td>
                        }
                        else
                        {
                            <td style="width: 10px;">
                                <center>
                                    <button class="btn btn-danger " id="btnFMDispatchDelete" style="font-size: 10px;padding:3px 13px;"><i class="glyphicon glyphicon-trash" style="font-size: 1.2em;"></i></button>
                                </center>
                            </td>
                            <td style="width: 10px;">
                                <center>
                                    <button class="btn btn-primary deditrow" style="font-size: 10px;padding:3px 13px;"><i class="glyphicon glyphicon-edit" style="font-size: 1.2em;"></i></button>
                                    <button class="btn btn-danger dCancelrow hidden" style="font-size: 10px;padding:3px 13px;"><i class="glyphicon glyphicon-remove" style="font-size: 1.2em;"></i></button>
                                </center>
                            </td>
                            <td style="width: 10px;">
                                <button class="btn btn-primary dbtnSave" disabled id="" style="font-size: 10px;padding:3px 13px;"><i class="glyphicon glyphicon-floppy-saved" style="font-size: 1.2em;"></i></button>
                            </td>
                        }

                            <td>
                                <input type="text" class="form-control DispatchDate" style="width:100px;" value="@item.DispatchDate" disabled />
                                @*@Html.TextBoxFor(x => item.DispatchDate, new { @class = "form-control", @Value = item.DispatchDate, @style = "width:100px;", @disabled = "disabled" })*@
                            </td>
                            <td>
                                <input type="time" class="form-control DispatchTime" style="width:100px;" value="@item.DispatchTime" disabled />
                                @*@Html.TextBoxFor(x => item.DispatchTime, new { @class = "form-control", @type = "time", @style = "width:100px;", @Value = item.DispatchTime, @disabled = "disabled" })*@
                            </td>
                            <td>
                                <input type="text" class="form-control DispachKM" style="width:100px;" value="@item.DispachKM" disabled />
                                @*@Html.TextBoxFor(x => item.DispachKM, new { @class = "form-control", @style = "width:100px;", @Value = item.DispachKM, @disabled = "disabled" })*@
                            </td>
                        <td>
                            @Html.TextAreaFor(x => item.DispachRemark, new { @class = "form-control", @style = "width:100%;", @rows = "1", @maxlength = "100", @Value = item.DispachRemark, @disabled = "disabled" })
                        </td>
                        <td class=" FmRouteDispatchReco hidden">@item.RecordKey</td>
                    </tr>
                }

            </tbody>
        </table>
    </div>
}

