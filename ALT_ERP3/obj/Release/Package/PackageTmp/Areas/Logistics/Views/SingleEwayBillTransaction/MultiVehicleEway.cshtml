@model ALT_ERP3.Areas.Logistics.Models.EwayBillVM
@using Common;
@{
    /**/

    ViewBag.Title = "LRSetupVM";
    Layout = null;
}
<script src="@Url.Content("~/Content/js/jquery.validate.min.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Content/js/jquery.constrain.js")" type="text/javascript"></script>
<style>
    textarea {
        resize: none;
    }
</style>
<script type="text/javascript">
    $(document).ready(function () {
        $("#MUL_VehicleQty").constrain({ allow: { regex: "[0-9]" } });

        $("#MUL_rdbtnVehicle").change(function () {
            if (this.checked) {
                $(".MUL_MasterVehicle").addClass("hidden");
                $(".MUL_ManualVehicle").removeClass("hidden");
            }
            else {
                $(".MUL_MasterVehicle").removeClass("hidden");
                $(".MUL_ManualVehicle").addClass("hidden");
            }

        });
        $('#MUL_DocDate').datepicker({
            format: 'dd/mm/yyyy',
            changeMonth: true,
            changeYear: true,
            yearRange: "-60:+0",
            autoclose: true,
        });
        MULloadReasonCode();
        MULloadTRNMode();
        MULLoadVehicle();
        MULLoadConsignorState();
        MULLoadConsigneeState();
        MULLoadFromPlace();
        MULLoadTOPlace();
        MULLoadUnitCode()
        $("#btnMultiVehicleEway").click(function (event) {
            event.preventDefault();
            if ($("#MUL_DocDate").val() == '' || $("#MUL_DocDate").val() == null) {
                alert('Doc Date is required...!');
                return;
            }
            if ($("#MUL_EWBDocument").val() == '' || $("#MUL_EWBDocument").val() == null) {
                alert('EWBDocument is required...!');
                return;
            }
            if ($("#MUL_EwayNo").val() == '' || $("#MUL_EwayNo").val() == null) {
                alert('EwayBill No is required...!');
                return;
            }
            if ($("#MUL_ReasonCode").val() == '' || $("#MUL_ReasonCode").val() == null) {
                alert('Reason Code is required...!');
                return;
            }
            if ($("#MUL_TotalQty").val() == '' || $("#MUL_TotalQty").val() == null|| $("#MUL_TotalQty").val() == '0') {
                alert('Total Qty is required...!');
                return;
            }

            if ($("#MUL_TRNMode").val() == '' || $("#MUL_TRNMode").val() == null) {
                alert('Tran Mode is required...!');
                return;
            }
            else
            {
                if ($("#MUL_TRNMode").val() == '1')
                {
                    if ($("#MUL_rdbtnVehicle").is(':checked'))
                    {
                        if ($("#MUL_VehicleNoTxt").val() == '' || $("#MUL_VehicleNoTxt").val() == null) {
                            alert('VehicleNo is required...!');
                            return;
                        }
                    }
                    else
                    {
                        if ($("#MUL_VehicleNo").val() == '' || $("#MUL_VehicleNo").val() == null) {
                            alert('VehicleNo is required...!');
                            return;
                        }
                    }
                }
            }

            if ($("#MUL_VehicleQty").val() == '' || $("#MUL_VehicleQty").val() == null) {
                alert('Qty is required...!');
                return;
            }
            else
            {
                if (parseInt($("#MUL_VehicleQty").val()) == 0) {
                    alert('Qty is required...!');
                    return;
                }
            }
            if ($("#MUL_UnitCode").val() == '' || $("#MUL_UnitCode").val() == null) {
                alert('Unit is required...!');
                return;
            }
            if ($("#MUL_FromPlace").val() == '' || $("#MUL_FromPlace").val() == null) {
                alert('From Place is required...!');
                return;
            }
            if ($("#MUL_ConsignorState").val() == '' || $("#MUL_ConsignorState").val() == null) {
                alert('From State is required...!');
                return;
            }
            if ($("#MUL_ToPlace").val() == '' || $("#MUL_ToPlace").val() == null) {
                alert('To  Place is required...!');
                return;
            }
            if ($("#MUL_ConsigneeState").val() == '' || $("#MUL_ConsigneeState").val() == null) {
                alert('To State is required...!');
                return;
            }



            var url = '@Url.Action("GenerateMultiVehicleEWayBill")';
            var ModelData = {};
            ModelData["Document"] = $("#ConsignmentKey").val();
            ModelData["SearchEway"] = $("#MultiSearchEway").val();
            ModelData["DocDate"] = $("#MUL_DocDate").val();
            ModelData["EWBDocument"] = $("#MUL_EWBDocument").val();

            ModelData["EWB_EwayNo"] = $("#MUL_EwayNo").val();
            ModelData["EWB_ReasonCode"] = $("#MUL_ReasonCode").val();
            ModelData["EWB_TotalQty"] = $("#MUL_TotalQty").val();
            ModelData["EWB_TRNMode"] = $("#MUL_TRNMode").val();

            

            if ($("#MUL_rdbtnVehicle").is(':checked')) {
                ModelData["EWB_VehicleNo"] = $("#MUL_VehicleNoTxt").val();
            } else {
                ModelData["EWB_VehicleNo"] = $("#MUL_VehicleNo").val();
            }

            ModelData["EWB_VehicleQty"] = $("#MUL_VehicleQty").val();
            ModelData["UnitCode"] = $("#MUL_UnitCode").val();

            ModelData["EWB_FromPlace"] = $("#MUL_FromPlace").val();
            ModelData["EWB_ConsignorState"] = $("#MUL_ConsignorState").val();
            ModelData["EWB_ToPlace"] = $("#MUL_ToPlace").val();
            ModelData["EWB_ConsigneeState"] = $("#MUL_ConsigneeState").val();
            ModelData["EWB_ReasonRemark"] = $("#MUL_ReasonRemark").val();

            var DTO = { Model: ModelData };
            $.ajax({
                type: "POST",
                dataType: "json",
                data: JSON.stringify(DTO),
                cache: false,
                url: url,
                contentType: "application/json; charset=utf-8",
                beforeSend: function () {
                    $('.spinner').show();
                },
                success: function (data) {
                    $('.spinner').hide();
                    if (data.Status == 'Success') {
                        alert(data.errormsg);
                        location.reload();
                    }
                    else {
                        alert(data.errormsg);
                    }
                },
            });
        });

    });
    function MULloadReasonCode() {
        event.preventDefault();
        var url = '@Url.Action("GetReasonCode")';
        $.ajax({
            type: 'POST',
            url: url,
            dataType: 'json',
            data: {  },
            success: function (result) {
                $("#MUL_ReasonCode").empty();
                $.each(result, function (i, item) {
                    $("#MUL_ReasonCode").append("<option value='" + item.Value + "'>" + item.Text + "</option>");
                });
                $('#MUL_ReasonCode').val('@Model.EWB_ReasonCode').attr("selected", "selected");
                $('.spinner').hide();
            },
            error: function (ex) {
                alert("Error occured while processing your request." + ex);
            }
        });
        return false;
    };
    function MULloadTRNMode() {
        event.preventDefault();
        var url = '@Url.Action("GetTrasactMode")';
        $.ajax({
            type: 'POST',
            url: url,
            dataType: 'json',
            data: {  },
            success: function (result) {
                $("#MUL_TRNMode").empty();
                $.each(result, function (i, item) {
                    $("#MUL_TRNMode").append("<option value='" + item.Value + "'>" + item.Text + "</option>");
                });
                $('#MUL_TRNMode').val('@Model.EWB_TRNMode').attr("selected", "selected");
                $('.spinner').hide();
            },
            error: function (ex) {
                alert("Error occured while processing your request." + ex);
            }
        });
        return false;
    };
    function MULLoadVehicle() {

        var url = '@Url.Action("GetVehicle")'
        $('#MUL_VehicleNo').select2({
            minimumInputLength: 0,
            placeholder: 'Search',
            ajax: {
                url: url,
                dataType: 'json',
                quietMillis: 100,
                enableFiltering: true,
                allowClear: true,
                minimumInputLength: 0,
                multiple: true,
                width: 300,
                data: function (term, page) {
                    return {
                        types: ["exercise"],
                        limit: -1,
                        term: term,
                    };
                },
                results: function (data, page) {
                    clientObj = JSON.stringify(data);
                    return {
                        results: $.map(data, function (item) {
                            return {
                                text: item.Name,
                                id: item.Code
                            }
                        })
                    };
                }
            },

            initSelection: function (element, callback) {
                var data = { id: '@Model.EWB_VehicleNo', text: '@Model.EWB_VehicleName' };
                callback(data);
            },

            formatResult: function (exercise) {
                return "<div class='row-fluid'><div class=''><span class='span1'><div style='color:" + exercise.alias + "'>" + exercise.text +
                    "</div></span></div></div>";
            },

            formatSelection: function (exercise) {
                return "<div class='row-fluid'><div class=''><span class='span1'><div style='color:" + exercise.alias + "'>" + exercise.text +
                    "</div></span></div></div>";
            },
        })
    };
    function MULLoadConsignorState() {

        var url = '@Url.Action("LoadState")'
        $('#MUL_ConsignorState').select2({
            minimumInputLength: 0,
            placeholder: 'Search',
            ajax: {
                url: url,
                dataType: 'json',
                quietMillis: 100,
                enableFiltering: true,
                allowClear: true,
                minimumInputLength: 0,
                multiple: true,
                width: 300,
                data: function (term, page) {
                    return {
                        types: ["exercise"],
                        limit: -1,
                        term: term
                    };
                },
                results: function (data, page) {
                    clientObj = JSON.stringify(data);
                    return {
                        results: $.map(data, function (item) {
                            return {
                                text: item.Name,
                                id: item.Code
                            }
                        })
                    };
                }
            },

            initSelection: function (element, callback) {
                var data = { id: '@Model.EWB_ConsignorState', text: '@Model.EWB_ConsignorStateName' };
                callback(data);
            },

            formatResult: function (exercise) {
                return "<div class='row-fluid'><div class=''><span class='span1'><div style='color:" + exercise.alias + "'>" + exercise.text +
                    "</div></span></div></div>";
            },

            formatSelection: function (exercise) {
                return "<div class='row-fluid'><div class=''><span class='span1'><div style='color:" + exercise.alias + "'>" + exercise.text +
                    "</div></span></div></div>";
            },
        })
    };
    function MULLoadConsigneeState() {

        var url = '@Url.Action("LoadState")'
        $('#MUL_ConsigneeState').select2({
            minimumInputLength: 0,
            placeholder: 'Search',
            ajax: {
                url: url,
                dataType: 'json',
                quietMillis: 100,
                enableFiltering: true,
                allowClear: true,
                minimumInputLength: 0,
                multiple: true,
                width: 300,
                data: function (term, page) {
                    return {
                        types: ["exercise"],
                        limit: -1,
                        term: term
                    };
                },
                results: function (data, page) {
                    clientObj = JSON.stringify(data);
                    return {
                        results: $.map(data, function (item) {
                            return {
                                text: item.Name,
                                id: item.Code
                            }
                        })
                    };
                }
            },

            initSelection: function (element, callback) {
                var data = { id: '@Model.EWB_ConsigneeState', text: '@Model.EWB_ConsigneeStateName' };
                callback(data);
            },

            formatResult: function (exercise) {
                return "<div class='row-fluid'><div class=''><span class='span1'><div style='color:" + exercise.alias + "'>" + exercise.text +
                    "</div></span></div></div>";
            },

            formatSelection: function (exercise) {
                return "<div class='row-fluid'><div class=''><span class='span1'><div style='color:" + exercise.alias + "'>" + exercise.text +
                    "</div></span></div></div>";
            },
        })
    };
    function MULLoadFromPlace() {
        var url = '@Url.Action("FromPlace")'
        $('#MUL_FromPlace').select2({
            minimumInputLength: 0,
            placeholder: 'Search',
            ajax: {
                url: url,
                dataType: 'json',
                quietMillis: 100,
                enableFiltering: true,
                allowClear: true,
                minimumInputLength: 0,
                multiple: true,
                width: 300,
                data: function (term, page) {
                    return {
                        types: ["exercise"],
                        limit: -1,
                        term: term,
                    };
                },
                results: function (data, page) {
                    clientObj = JSON.stringify(data);
                    return {
                        results: $.map(data, function (item) {
                            return {
                                text: item.Name,
                                id: item.Code
                            }
                        })
                    };
                }
            },

            initSelection: function (element, callback) {
                var data = { id: '@Model.EWB_FromPlace', text: '@Model.EWB_FromPlaceName' };
                callback(data);
            },

            formatResult: function (exercise) {
                return "<div class='row-fluid'><div class=''><span class='span1'><div style='color:" + exercise.alias + "'>" + exercise.text +
                    "</div></span></div></div>";
            },

            formatSelection: function (exercise) {
                return "<div class='row-fluid'><div class=''><span class='span1'><div style='color:" + exercise.alias + "'>" + exercise.text +
                    "</div></span></div></div>";
            },
        })
    };
    function MULLoadTOPlace() {
        var url = '@Url.Action("FromPlace")'
        $('#MUL_ToPlace').select2({
            minimumInputLength: 0,
            placeholder: 'Search',
            ajax: {
                url: url,
                dataType: 'json',
                quietMillis: 100,
                enableFiltering: true,
                allowClear: true,
                minimumInputLength: 0,
                multiple: true,
                width: 300,
                data: function (term, page) {
                    return {
                        types: ["exercise"],
                        limit: -1,
                        term: term,
                    };
                },
                results: function (data, page) {
                    clientObj = JSON.stringify(data);
                    return {
                        results: $.map(data, function (item) {
                            return {
                                text: item.Name,
                                id: item.Code
                            }
                        })
                    };
                }
            },

            initSelection: function (element, callback) {
                var data = { id: '@Model.EWB_ToPlace', text: '@Model.EWB_ToPlaceName' };
                callback(data);
            },

            formatResult: function (exercise) {
                return "<div class='row-fluid'><div class=''><span class='span1'><div style='color:" + exercise.alias + "'>" + exercise.text +
                    "</div></span></div></div>";
            },

            formatSelection: function (exercise) {
                return "<div class='row-fluid'><div class=''><span class='span1'><div style='color:" + exercise.alias + "'>" + exercise.text +
                    "</div></span></div></div>";
            },
        })
    };
    function MULLoadUnitCode() {

        var url = '@Url.Action("GetUnit")'
        $('#MUL_UnitCode').select2({
            minimumInputLength: 0,
            placeholder: 'Search',
            ajax: {
                url: url,
                dataType: 'json',
                quietMillis: 100,
                enableFiltering: true,
                allowClear: true,
                minimumInputLength: 0,
                multiple: true,
                width: 300,
                data: function (term, page) {
                    return {
                        types: ["exercise"],
                        limit: -1,
                        term: term
                    };
                },
                results: function (data, page) {
                    clientObj = JSON.stringify(data);
                    return {
                        results: $.map(data, function (item) {
                            return {
                                text: item.Name,
                                id: item.Code
                            }
                        })
                    };
                }
            },

            initSelection: function (element, callback) {
                var data = { id: '@Model.UnitCode', text: '@Model.UnitName' };
                callback(data);
            },

            formatResult: function (exercise) {
                return "<div class='row-fluid'><div class=''><span class='span1'><div style='color:" + exercise.alias + "'>" + exercise.text +
                    "</div></span></div></div>";
            },

            formatSelection: function (exercise) {
                return "<div class='row-fluid'><div class=''><span class='span1'><div style='color:" + exercise.alias + "'>" + exercise.text +
                    "</div></span></div></div>";
            },
        })
    };
</script>
<div class="col-sm-12">
    <hr style="margin-top:5px!important;margin-bottom:8px!important;border:1px solid #ad2783" />
    <div class="col-sm-12" style="padding-bottom: 5px!important;">
        <label class="col-sm-1 control-label" style="color:black;font-weight:bold;">Doc Date:<span style="color:red;">*</span></label>
        <div class="col-sm-2">
            @Html.TextBoxFor(x => x.DocDate, new { @class = "form-control", @style = "width:100%;", @Value = Model.DocDate, @Name = "MUL_DocDate", @Id = "MUL_DocDate" })
        </div>
        <label class="col-sm-1 control-label" style="color:black;font-weight:bold;">EWB Document:<span style="color:red;">*</span></label>
        <div class="col-sm-2">
            @Html.TextBoxFor(x => x.EWBDocument, new { @class = "form-control", @style = "width:100%;", @Value = Model.EWBDocument, @Name = "MUL_EWBDocument", @Id = "MUL_EWBDocument" })
        </div>
    </div>
    <div class="col-sm-12" style="padding-bottom: 5px!important;">
        <label class="col-sm-1 control-label" style="color:black;font-weight:bold;">EwayBill No:<span style="color:red;">*</span></label>
        <div class="col-sm-2">
            @Html.TextBoxFor(x => x.EWB_EwayNo, new {  @class = "form-control", @style = "width:100%;", @Value = Model.EWB_EwayNo, @Name = "MUL_EwayNo", @Id = "MUL_EwayNo" })
        </div>
        <label class="col-sm-1 control-label" style="color:black;font-weight:bold;">Reson Code:<span style="color:red;">*</span></label>
        <div class="col-sm-2">
            @Html.DropDownListFor(m => m.EWB_ReasonCode, DropdownHelper.EmptyList(), new { @class = "form-control", @Name = "MUL_ReasonCode", @Id = "MUL_ReasonCode" })
        </div>
        <label class="col-sm-1 control-label" style="color:black;font-weight:bold;">Total Qty:<span style="color:red;">*</span></label>
        <div class="col-sm-2">
            @Html.TextBoxFor(x => x.EWB_TotalQty, new {  @class = "form-control", @style = "width:100%;", @Value = Model.EWB_TotalQty, @Name = "MUL_TotalQty", @Id = "MUL_TotalQty" })
        </div>
        <label class="col-sm-1 control-label" style="color:black;font-weight:bold;">Tran Mode:<span style="color:red;">*</span></label>
        <div class="col-sm-2">
            @Html.DropDownListFor(m => m.EWB_TRNMode, DropdownHelper.EmptyList(), new { @class = "form-control", @Name = "MUL_TRNMode", @Id = "MUL_TRNMode" })
        </div>
    </div>
    <div class="col-sm-12" style="padding-bottom: 5px!important;">
        <label class="col-sm-1 control-label" style="color:black;font-weight:bold;">Manual Vehi:</label>
        <div class="col-sm-5">
            <div class="col-sm-1" style="margin:0px!important;padding:0px!important;">
                <input type="checkbox" title="Allow To Enter Manual VehicleNO" style="width:20px;height:20px;" id="MUL_rdbtnVehicle" />
            </div>
            <label class="col-sm-3 control-label" style="color:black;font-weight:bold;">Vehicle No:<span style="color:red;">*</span></label>
            <div class="col-sm-4 MUL_MasterVehicle" style="margin:0px!important;padding:0px!important;">
                @Html.TextBoxFor(x => x.EWB_VehicleNo, new { @class = "input-large-query", @style = "width:100%;", @Value = Model.EWB_VehicleNo, @Name = "MUL_VehicleNo", @Id = "MUL_VehicleNo" })
            </div>
            <div class="col-sm-4 MUL_ManualVehicle hidden">
                @Html.TextBoxFor(x => x.EWB_VehicleNoTxt, new { @class = "form-control", @style = "width:100%;", @Value = Model.EWB_VehicleNoTxt, @Name = "MUL_VehicleNoTxt", @Id = "MUL_VehicleNoTxt" })
            </div>
        </div>
        <label class="col-sm-1 control-label" style="color:black;font-weight:bold;">Qty:<span style="color:red;">*</span></label>
        <div class="col-sm-2">
            @Html.TextBoxFor(x => x.EWB_VehicleQty, new { @class = "form-control", @style = "width:100%;", @Value = Model.EWB_VehicleQty, @Name = "MUL_VehicleQty", @Id = "MUL_VehicleQty" })
        </div>
        <label class="col-sm-1 control-label" style="color:black;font-weight:bold;">Unit:<span style="color:red;">*</span></label>
        <div class="col-sm-2">
            @Html.TextBoxFor(x => x.UnitCode, new { @class = "input-large-query", @style = "width:100%;", @Value = Model.UnitCode, @Name = "MUL_UnitCode", @Id = "MUL_UnitCode" })
        </div>
    </div>
    <div class="col-sm-12" style="padding-bottom: 5px!important;">
        <label class="col-sm-1 control-label" style="color:black;font-weight:bold;">From Place:<span style="color:red;">*</span></label>
        <div class="col-sm-2">
            @Html.TextBoxFor(x => x.EWB_FromPlace, new {  @class = "input-large-query", @style = "width:100%;", @Value = Model.EWB_FromPlace, @Name = "MUL_FromPlace", @Id = "MUL_FromPlace" })
        </div>
        <label class="col-sm-1 control-label" style="color:black;font-weight:bold;">From State:<span style="color:red;">*</span></label>
        <div class="col-sm-2">
            @Html.TextBoxFor(x => x.EWB_ConsignorState, new { @class = "input-large-query", @style = "width:100%;", @Value = Model.EWB_ConsignorState, @Name = "MUL_ConsignorState", @Id = "MUL_ConsignorState" })
        </div>
        <label class="col-sm-1 control-label" style="color:black;font-weight:bold;">To Place:<span style="color:red;">*</span></label>
        <div class="col-sm-2">
            @Html.TextBoxFor(x => x.EWB_ToPlace, new {  @class = "input-large-query", @style = "width:100%;", @Value = Model.EWB_ToPlace, @Name = "MUL_ToPlace", @Id = "MUL_ToPlace" })
        </div>
        <label class="col-sm-1 control-label" style="color:black;font-weight:bold;">To State:<span style="color:red;">*</span></label>
        <div class="col-sm-2">
            @Html.TextBoxFor(x => x.EWB_ConsigneeState, new { @class = "input-large-query", @style = "width:100%;", @Value = Model.EWB_ConsigneeState, @Name = "MUL_ConsigneeState", @Id = "MUL_ConsigneeState" })
        </div>
    </div>
    <div class="col-sm-12" style="padding-bottom: 5px!important;">
        <label class="col-sm-1 control-label" style="color:black;font-weight:bold;">Reason:</label>
        <div class="col-sm-11">
            @Html.TextAreaFor(x => x.EWB_ReasonRemark, new { @class = "form-control", @Value = Model.EWB_ReasonRemark, @rows = "1", @maxlength = 100, @Name = "MUL_ReasonRemark", @Id = "MUL_ReasonRemark" })
        </div>
    </div>
    <div class="col-sm-12" style="padding-bottom: 5px!important;">
        <div class="col-sm-2">
            <button class="btn btn-success" style="color:black;font-size: 13px;padding:3px 12px;" id="btnMultiVehicleEway" title="Camera">Generate Multi-Vehicle EwayBill</button>
        </div>
    </div>
</div>
