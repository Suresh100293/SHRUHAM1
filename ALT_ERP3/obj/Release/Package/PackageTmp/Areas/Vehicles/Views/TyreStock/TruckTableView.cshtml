@model ALT_ERP3.Areas.Accounts.Models.OtherTransactModel
@using Common

<table id="truckrelatedtable" class="zui-table" style="width:100%;">
    <thead>
    </thead>
    <tbody>
        @if (Model.AddOnList != null)
        {
            foreach (var item in @Model.AddOnList.ToList())
            {


                <tr id="datacharge" style="font-family:Tahoma;font-size:9pt;border: solid 1px lightgray;background-color:@item.BackColor ">
                    <td style="width:10%;" hidden="hidden">@item.Fld</td>
                    <td style="width:20%;">@item.Head</td>

                    @if (item.FldType == "C")
                    {
                        <td style="width:40%;">
                            <select class="addontxtfvalue" id="txtf_@item.Fld" alt="@item.Fld" style="width:100%">
                                @{
                                    var Text = item.QueryText.Split('^');
                                    var Codes = item.QueryCode.Split('^');
                                    for (int i = 0; i < Text.Length; i++)
                                    {
                                        <option value="@Codes[i]" @(Codes[i] == item.ApplCode ? "selected" : "")>@Text[i]</option>
                                    }
                                }
                            </select>
                        </td>
                    }
                    else if (item.FldType == "M")
                    {
                        <td style="width:50%;"><textarea type="textarea" rows="5" cols="20" id="txtf_@item.Fld" alt="@item.Fld" class="addontxtfvalue" style="width:100%;">@item.ApplCode</textarea></td>
                    }
                    else if (item.FldType == "D")
                    {
                        <td style="width:50%;"><input type="date" id="txtf_@item.Fld" alt="@item.Fld" value="@item.ApplCode" class="addontxtfvalue" style="width:100%;" maxlength="250" /></td>
                    }
                    else if (item.FldType == "N")
                    {
                        <td style="width:50%;"><input type="number" id="txtf_@item.Fld" alt="@item.Fld" value="@item.ApplCode" class="addontxtfvalue" style="width:100%;" maxlength="250" /></td>
                    }
                    else if (item.FldType == "R")
                    {
                        <td style="width:50%;">
                            <div>
                                @foreach (var item2 in item.QueryText.Split('^').ToList())
                                {
                                    <div class="col-sm-2 control-label" style="padding-top:0px;width:auto;">
                                        @item2:  <input @(item2 == item.ApplCode ? "checked=checked" : "") class="addontxtfvalue" name="addontxtfvalue" style="padding-left:0px;width:20px;height:20px;" type="radio" value="@item2">
                                    </div>
                                }
                            </div>
                        </td>
                    }
                    else
                    {
                        <td style="width:50%;"><input type="text" id="txtf_@item.Fld" alt="@item.Fld" value="@item.ApplCode" class="addontxtfvalue" style="width:100%;" maxlength="250" /></td>
                    }
                    <td style="width:1%;" hidden="hidden">@item.FldType</td>
                    <td style="width:1%;" hidden="hidden">@item.TableKey</td>
                </tr>
            }
        }

    </tbody>
</table>

<script>
    $(document).ready(function ()
    {
        debugger;
        if ('@Model.Mode' == "Edit" )
        {
            if ($("input[name=addontxtfvalue]:checked").val() == "Stepnee")
            {
                $('#truckrelatedtable tbody tr').each(function () {
                    var tds = $(this).find('td');
                    if (tds.eq(0).text() == "F003") {
                        tds.eq(1).html('Stepnee No');
                    }
                });
                $("input[name=addontxtfvalue]").prop("disabled", true);
            }
            else
            {
                $('#truckrelatedtable tbody tr').each(function () {
                    var tds = $(this).find('td');
                    if (tds.eq(0).text() == "F003") {
                        tds.eq(1).html('Tyre Placed No');
                    }
                });
                $("input[name=addontxtfvalue]").prop("disabled", true);
            }
            $("#RelatedChoice").prop("disabled", true);
            $('#truckrelatedtable tbody tr').each(function () {
                var tds = $(this).find('td');
                if (tds.eq(0).text() == "F001") {
                    tds.find(".addontxtfvalue").prop("disabled", true);
                }
                else if (tds.eq(0).text() == "F002") {
                    tds.find(".addontxtfvalue").prop("disabled", true);
                }
                else if (tds.eq(0).text() == "F004") {
                    tds.find(".addontxtfvalue").prop("disabled", true);
                }
            });
        }
        $("#truckrelatedtable tbody").on('change', '.addontxtfvalue', function () {
            var currentRow = $(this).closest("tr");
            var tds = currentRow.find('td').eq(0).text();

            if (tds == "F002") {
                if ($("input[name=addontxtfvalue]:checked").val() == "Stepnee") {
                    $('#truckrelatedtable tbody tr').each(function () {
                        var tds = $(this).find('td');
                        if (tds.eq(0).text() == "F003") {
                            tds.eq(1).html('Stepnee No');
                        }
                    });
                }
                else {
                    $('#truckrelatedtable tbody tr').each(function () {
                        var tds = $(this).find('td');
                        if (tds.eq(0).text() == "F003") {
                            tds.eq(1).html('Tyre Placed No');
                        }
                    });
                }
            }
        });
        $("#truckrelatedtable tbody").on('focusout', '.addontxtfvalue', function ()
        {
            var currentRow = $(this).closest("tr");
            var tds = currentRow.find('td').eq(0).text();
            if (tds == "F003")
            {
                var mvehicle = '';
                var mNo = '';
                var mTyreStep = '';
                var mCode = '';
                mvehicle = $("#RelatedChoice").val();
                $('#truckrelatedtable tbody tr').each(function () {
                    var tds = $(this).find('td');
                    if (tds.eq(0).text() == "F003") {
                        mNo = tds.find(".addontxtfvalue").val();
                    }
                    if (tds.eq(0).text() == "F002") {
                        mCode = tds.find(".addontxtfvalue").val();
                    }
                    if (tds.eq(0).text() == "F002") {
                        mTyreStep = tds.find("input[name=addontxtfvalue]:checked").val();
                    }
                });
                $('#itemrelatedtable tbody tr').each(function () {
                    var tds = $(this).find('td');
                    if (tds.eq(0).text() == "F003") {
                        mCode = tds.find(".addontxtfvalue").val();
                    }
                });
                var ModelData = {};
                ModelData["VehicleNo"] = mvehicle;
                ModelData["TyreNo"] = mNo;
                ModelData["Fld"] = mTyreStep;
                ModelData["Type"] = mCode;
                ModelData["Document"] = $("#hdnDocument").val();
                ModelData["SessionFlag"] = $("#hdnSessionFlag").val();
                ModelData["TableKey"] = $("#hdnAccTableKey").val();
                var DTO = { Model: ModelData };
                var url = '@Url.Action("GetTyreStockDetail")';
                $.ajax({
                    type: "POST",
                    dataType: "json",
                    data: JSON.stringify(DTO),
                    cache: false,
                    url: url,
                    contentType: "application/json;charset=utf-8",
                    beforeSend: function () {
                        $('.spinner').show();
                    },
                    success: function (data) {
                        $('.spinner').hide();
                        if (data.Status == "Valid") {
                            alert(data.Message);
                            $('#truckrelatedtable tbody tr').each(function () {
                                var tds = $(this).find('td');
                                if (tds.eq(0).text() == "F003") {
                                    tds.find(".addontxtfvalue").val("");
                                }
                            });
                            return;
                        }
                        else if (data.Status == "Success") {
                            $('#hdnDivTyreStkSrl').html(data.Html);
                            $('#hdnDivTyreStkSrl').show();
                        }
                    },
                    error: function () {
                        alert("Error occured while processing your request.");
                    }
                });
            }
        });
    });
</script>




